44da7acd43b3b0557538158afa8999e9
"use strict";
/**
 * @file Simple architecture validation tests
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the global context system to prevent initialization errors during tests
jest.mock('../app/core/service-registry', () => {
    const originalModule = jest.requireActual('../app/core/service-registry');
    // Create a mock store service
    const mockStore = {
        get: jest.fn().mockReturnValue('system'), // Default theme preference
        set: jest.fn(),
        getAll: jest.fn().mockReturnValue({}),
        delete: jest.fn(),
        clear: jest.fn(),
        has: jest.fn().mockReturnValue(false),
    };
    // Create a mock global context
    const mockGlobalContext = {
        getService: jest.fn((serviceName) => {
            if (serviceName === 'store') {
                return mockStore;
            }
            return {};
        }),
        isInitialized: true,
    };
    return {
        ...originalModule,
        getGlobalContext: jest.fn().mockReturnValue(mockGlobalContext),
        globalAppContext: mockGlobalContext,
    };
});
// Mock Electron modules before any imports
jest.mock('electron', () => ({
    app: {
        getPath: jest.fn(() => test_constants_1.TEST_CONSTANTS.PATHS.MOCK_PATH),
    },
    nativeTheme: {
        shouldUseDarkColors: false,
        themeSource: 'system',
        on: jest.fn(),
    },
    ipcMain: {
        handle: jest.fn(),
        on: jest.fn(),
    },
    BrowserWindow: {
        getAllWindows: jest.fn(() => []),
    },
}));
const test_constants_1 = require("./constants/test-constants");
// Mock console.warn to suppress deprecated function warnings during tests
const originalWarn = console.warn;
beforeAll(() => {
    console.warn = jest.fn();
});
afterAll(() => {
    console.warn = originalWarn;
});
describe('Modular Architecture', () => {
    describe('Module Imports', () => {
        it('should import UI modules', () => {
            expect(() => require('../app/ui/window-manager')).not.toThrow();
            expect(() => require('../app/ui/menu')).not.toThrow();
        });
        it('should import server modules', () => {
            expect(() => require('../app/server/eleventy')).not.toThrow();
            expect(() => require('../app/server/https-proxy')).not.toThrow();
        });
        it('should import utility modules', () => {
            expect(() => require('../app/utils/website-manager')).not.toThrow();
            expect(() => require('../app/dns/hosts-manager')).not.toThrow();
            expect(() => require('../app/certificates')).not.toThrow();
        });
        it('should import IPC handlers', () => {
            expect(() => require('../app/ipc/handlers')).not.toThrow();
        });
    });
    describe('Function Exports', () => {
        it('should export functions from window manager', () => {
            const windowManager = require('../app/ui/window-manager');
            expect(typeof windowManager.openWebsiteSelectionWindow).toBe('function');
            expect(typeof windowManager.openSettingsWindow).toBe('function');
            expect(typeof windowManager.getNativeInput).toBe('function');
        });
        it('should export functions from menu module', () => {
            const menu = require('../app/ui/menu');
            expect(typeof menu.createApplicationMenu).toBe('function');
        });
        it('should export functions from eleventy server', () => {
            const eleventy = require('../app/server/eleventy');
            expect(typeof eleventy.getHostnameFromTestDomain).toBe('function');
            expect(typeof eleventy.validateWebsiteName).toBe('undefined'); // Not in this module
        });
        it('should export functions from website manager', () => {
            const websiteManager = require('../app/utils/website-manager');
            expect(typeof websiteManager.validateWebsiteName).toBe('function');
        });
        it('should export functions from hosts manager', () => {
            const hostsManager = require('../app/dns/hosts-manager');
            expect(typeof hostsManager.addLocalDnsResolution).toBe('function');
            expect(typeof hostsManager.cleanupHostsFile).toBe('function');
            expect(typeof hostsManager.updateHostsFile).toBe('function');
            expect(typeof hostsManager.checkAndSuggestTouchIdSetup).toBe('function');
        });
    });
    describe('Pure Functions', () => {
        it('should extract hostnames from valid URLs', () => {
            const { getHostnameFromTestDomain } = require('../app/server/eleventy');
            expect(getHostnameFromTestDomain(`https://${test_constants_1.TEST_CONSTANTS.WEBSITES.MY_SITE}.${test_constants_1.TEST_CONSTANTS.DOMAINS.TEST_DOMAIN}:${test_constants_1.TEST_CONSTANTS.PORTS.DEFAULT_HTTPS}`)).toBe(`${test_constants_1.TEST_CONSTANTS.WEBSITES.MY_SITE}.${test_constants_1.TEST_CONSTANTS.DOMAINS.TEST_DOMAIN}`);
            expect(getHostnameFromTestDomain(`https://${test_constants_1.TEST_CONSTANTS.WEBSITES.EXAMPLE_SITE}.${test_constants_1.TEST_CONSTANTS.DOMAINS.TEST_DOMAIN}:${test_constants_1.TEST_CONSTANTS.PORTS.DEFAULT_HTTPS}`)).toBe(`${test_constants_1.TEST_CONSTANTS.WEBSITES.EXAMPLE_SITE}.${test_constants_1.TEST_CONSTANTS.DOMAINS.TEST_DOMAIN}`);
        });
        it('should validate website names', () => {
            const { validateWebsiteName } = require('../app/utils/website-manager');
            // Valid names (filesystem-safe characters)
            expect(validateWebsiteName('valid-name').valid).toBe(true);
            expect(validateWebsiteName('site123').valid).toBe(true);
            expect(validateWebsiteName('my_site').valid).toBe(true);
            expect(validateWebsiteName('My Website').valid).toBe(true); // Spaces allowed in middle
            expect(validateWebsiteName('site (v2)').valid).toBe(true); // Parentheses allowed
            expect(validateWebsiteName('site+more').valid).toBe(true); // Plus sign allowed
            // Invalid names
            expect(validateWebsiteName('').valid).toBe(false); // Empty
            expect(validateWebsiteName('  ').valid).toBe(false); // Only spaces
            expect(validateWebsiteName(' leading space').valid).toBe(false); // Leading space
            expect(validateWebsiteName('trailing space ').valid).toBe(false); // Trailing space
            expect(validateWebsiteName('.hidden').valid).toBe(false); // Leading dot
            expect(validateWebsiteName('site.').valid).toBe(false); // Trailing dot
            expect(validateWebsiteName('site/folder').valid).toBe(false); // Forward slash
            expect(validateWebsiteName('site\\folder').valid).toBe(false); // Backslash
            expect(validateWebsiteName('site:port').valid).toBe(false); // Colon
            expect(validateWebsiteName('site<tag>').valid).toBe(false); // Angle brackets
            expect(validateWebsiteName('site"quoted"').valid).toBe(false); // Quotes
            expect(validateWebsiteName('site|pipe').valid).toBe(false); // Pipe
            expect(validateWebsiteName('site?query').valid).toBe(false); // Question mark
            expect(validateWebsiteName('site*glob').valid).toBe(false); // Asterisk
            expect(validateWebsiteName('CON').valid).toBe(false); // Reserved Windows name
            expect(validateWebsiteName('prn').valid).toBe(false); // Reserved Windows name (case insensitive)
        });
        it('should prevent path traversal attacks in website names', () => {
            const { validateWebsiteName } = require('../app/utils/website-manager');
            // Path traversal attempts using double dots
            expect(validateWebsiteName('..').valid).toBe(false);
            expect(validateWebsiteName('../').valid).toBe(false);
            expect(validateWebsiteName('..\\').valid).toBe(false);
            expect(validateWebsiteName('../etc').valid).toBe(false);
            expect(validateWebsiteName('..\\..\\windows').valid).toBe(false);
            expect(validateWebsiteName('site/../etc').valid).toBe(false);
            expect(validateWebsiteName('site\\..\\windows').valid).toBe(false);
            expect(validateWebsiteName('....//').valid).toBe(false);
            expect(validateWebsiteName('site..parent').valid).toBe(false);
            expect(validateWebsiteName('normal..butbad').valid).toBe(false);
            // Ensure the error message indicates path traversal protection
            const result = validateWebsiteName('..');
            expect(result.valid).toBe(false);
            expect(result.error).toContain('directory traversal');
            // Valid names that contain dots (but not path traversal)
            expect(validateWebsiteName('site.com').valid).toBe(true); // Valid, dot in middle is allowed
            expect(validateWebsiteName('my-site-v2').valid).toBe(true); // Valid, no dots for traversal
        });
    });
    describe('Refactoring Success', () => {
        it('should have moved main.ts from monolith to modular', () => {
            const fs = require('fs');
            const path = require('path');
            const mainPath = path.join(__dirname, '..', 'app', 'main.ts');
            const mainContent = fs.readFileSync(mainPath, 'utf8');
            // Should be much shorter now (refactored)
            const lineCount = mainContent.split('\n').length;
            expect(lineCount).toBeLessThan(test_constants_1.TEST_CONSTANTS.SIZES.MAX_LINES); // Was over ${TEST_CONSTANTS.SIZES.COMPLEXITY_THRESHOLD} lines before
            // Should import from modules
            expect(mainContent).toContain('import { createApplicationMenu');
            expect(mainContent).toContain('import { setupIpcMainListeners');
            // Check that DNS management functions are imported (may be multi-line)
            expect(mainContent).toContain('cleanupHostsFile');
            expect(mainContent).toContain('checkAndSuggestTouchIdSetup');
        });
        it('should have separate module files', () => {
            const fs = require('fs');
            const path = require('path');
            // Check that modular files exist
            const modules = [
                'ui/window-manager.ts',
                'ui/menu.ts',
                'server/eleventy.ts',
                'server/https-proxy.ts',
                'ipc/handlers.ts',
                'utils/website-manager.ts',
                'dns/hosts-manager.ts',
                'certificates.ts',
            ];
            modules.forEach((modulePath) => {
                const fullPath = path.join(__dirname, '..', 'app', modulePath);
                expect(fs.existsSync(fullPath)).toBe(true);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L2FyY2hpdGVjdHVyZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCwrRUFBK0U7QUFDL0UsSUFBSSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7SUFDN0MsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBRTFFLDhCQUE4QjtJQUM5QixNQUFNLFNBQVMsR0FBRztRQUNoQixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsRUFBRSwyQkFBMkI7UUFDckUsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7UUFDckMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDaEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDO0tBQ3RDLENBQUM7SUFFRiwrQkFBK0I7SUFDL0IsTUFBTSxpQkFBaUIsR0FBRztRQUN4QixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQ2xDLElBQUksV0FBVyxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUM1QixPQUFPLFNBQVMsQ0FBQztZQUNuQixDQUFDO1lBQ0QsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUM7UUFDRixhQUFhLEVBQUUsSUFBSTtLQUNwQixDQUFDO0lBRUYsT0FBTztRQUNMLEdBQUcsY0FBYztRQUNqQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFD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QUFTLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7WUFDM0MsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3pCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUU3QixpQ0FBaUM7WUFDakMsTUFBTSxPQUFPLEdBQUc7Z0JBQ2Qsc0JBQXNCO2dCQUN0QixZQUFZO2dCQUNaLG9CQUFvQjtnQkFDcEIsdUJBQXVCO2dCQUN2QixpQkFBaUI7Z0JBQ2pCLDBCQUEwQjtnQkFDMUIsc0JBQXNCO2dCQUN0QixpQkFBaUI7YUFDbEIsQ0FBQztZQUVGLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtnQkFDN0IsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQztnQkFDL0QsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0MsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L2FyY2hpdGVjdHVyZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgU2ltcGxlIGFyY2hpdGVjdHVyZSB2YWxpZGF0aW9uIHRlc3RzXG4gKi9cblxuaW1wb3J0IHsgVEVTVF9DT05TVEFOVFMgfSBmcm9tICcuL2NvbnN0YW50cy90ZXN0LWNvbnN0YW50cyc7XG5cbi8vIE1vY2sgdGhlIGdsb2JhbCBjb250ZXh0IHN5c3RlbSB0byBwcmV2ZW50IGluaXRpYWxpemF0aW9uIGVycm9ycyBkdXJpbmcgdGVzdHNcbmplc3QubW9jaygnLi4vYXBwL2NvcmUvc2VydmljZS1yZWdpc3RyeScsICgpID0+IHtcbiAgY29uc3Qgb3JpZ2luYWxNb2R1bGUgPSBqZXN0LnJlcXVpcmVBY3R1YWwoJy4uL2FwcC9jb3JlL3NlcnZpY2UtcmVnaXN0cnknKTtcblxuICAvLyBDcmVhdGUgYSBtb2NrIHN0b3JlIHNlcnZpY2VcbiAgY29uc3QgbW9ja1N0b3JlID0ge1xuICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnc3lzdGVtJyksIC8vIERlZmF1bHQgdGhlbWUgcHJlZmVyZW5jZVxuICAgIHNldDogamVzdC5mbigpLFxuICAgIGdldEFsbDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7fSksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgY2xlYXI6IGplc3QuZm4oKSxcbiAgICBoYXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpLFxuICB9O1xuXG4gIC8vIENyZWF0ZSBhIG1vY2sgZ2xvYmFsIGNvbnRleHRcbiAgY29uc3QgbW9ja0dsb2JhbENvbnRleHQgPSB7XG4gICAgZ2V0U2VydmljZTogamVzdC5mbigoc2VydmljZU5hbWUpID0+IHtcbiAgICAgIGlmIChzZXJ2aWNlTmFtZSA9PT0gJ3N0b3JlJykge1xuICAgICAgICByZXR1cm4gbW9ja1N0b3JlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHt9O1xuICAgIH0pLFxuICAgIGlzSW5pdGlhbGl6ZWQ6IHRydWUsXG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5vcmlnaW5hbE1vZHVsZSxcbiAgICBnZXRHbG9iYWxDb250ZXh0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tHbG9iYWxDb250ZXh0KSxcbiAgICBnbG9iYWxBcHBDb250ZXh0OiBtb2NrR2xvYmFsQ29udGV4dCxcbiAgfTtcbn0pO1xuXG4vLyBNb2NrIEVsZWN0cm9uIG1vZHVsZXMgYmVmb3JlIGFueSBpbXBvcnRzXG5qZXN0Lm1vY2soJ2VsZWN0cm9uJywgKCkgPT4gKHtcbiAgYXBwOiB7XG4gICAgZ2V0UGF0aDogamVzdC5mbigoKSA9PiBURVNUX0NPTlNUQU5UUy5QQVRIUy5NT0NLX1BBVEgpLFxuICB9LFxuICBuYXRpdmVUaGVtZToge1xuICAgIHNob3VsZFVzZURhcmtDb2xvcnM6IGZhbHNlLFxuICAgIHRoZW1lU291cmNlOiAnc3lzdGVtJyxcbiAgICBvbjogamVzdC5mbigpLFxuICB9LFxuICBpcGNNYWluOiB7XG4gICAgaGFuZGxlOiBqZXN0LmZuKCksXG4gICAgb246IGplc3QuZm4oKSxcbiAgfSxcbiAgQnJvd3NlcldpbmRvdzoge1xuICAgIGdldEFsbFdpbmRvd3M6IGplc3QuZm4oKCkgPT4gW10pLFxuICB9LFxufSkpO1xuXG4vLyBNb2NrIGNvbnNvbGUud2FybiB0byBzdXBwcmVzcyBkZXByZWNhdGVkIGZ1bmN0aW9uIHdhcm5pbmdzIGR1cmluZyB0ZXN0c1xuY29uc3Qgb3JpZ2luYWxXYXJuID0gY29uc29sZS53YXJuO1xuYmVmb3JlQWxsKCgpID0+IHtcbiAgY29uc29sZS53YXJuID0gamVzdC5mbigpO1xufSk7XG5cbmFmdGVyQWxsKCgpID0+IHtcbiAgY29uc29sZS53YXJuID0gb3JpZ2luYWxXYXJuO1xufSk7XG5cbmRlc2NyaWJlKCdNb2R1bGFyIEFyY2hpdGVjdHVyZScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ01vZHVsZSBJbXBvcnRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW1wb3J0IFVJIG1vZHVsZXMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4gcmVxdWlyZSgnLi4vYXBwL3VpL3dpbmRvdy1tYW5hZ2VyJykpLm5vdC50b1Rocm93KCk7XG4gICAgICBleHBlY3QoKCkgPT4gcmVxdWlyZSgnLi4vYXBwL3VpL21lbnUnKSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW1wb3J0IHNlcnZlciBtb2R1bGVzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IHJlcXVpcmUoJy4uL2FwcC9zZXJ2ZXIvZWxldmVudHknKSkubm90LnRvVGhyb3coKTtcbiAgICAgIGV4cGVjdCgoKSA9PiByZXF1aXJlKCcuLi9hcHAvc2VydmVyL2h0dHBzLXByb3h5JykpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGltcG9ydCB1dGlsaXR5IG1vZHVsZXMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4gcmVxdWlyZSgnLi4vYXBwL3V0aWxzL3dlYnNpdGUtbWFuYWdlcicpKS5ub3QudG9UaHJvdygpO1xuICAgICAgZXhwZWN0KCgpID0+IHJlcXVpcmUoJy4uL2FwcC9kbnMvaG9zdHMtbWFuYWdlcicpKS5ub3QudG9UaHJvdygpO1xuICAgICAgZXhwZWN0KCgpID0+IHJlcXVpcmUoJy4uL2FwcC9jZXJ0aWZpY2F0ZXMnKSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW1wb3J0IElQQyBoYW5kbGVycycsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiByZXF1aXJlKCcuLi9hcHAvaXBjL2hhbmRsZXJzJykpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGdW5jdGlvbiBFeHBvcnRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhwb3J0IGZ1bmN0aW9ucyBmcm9tIHdpbmRvdyBtYW5hZ2VyJywgKCkgPT4ge1xuICAgICAgY29uc3Qgd2luZG93TWFuYWdlciA9IHJlcXVpcmUoJy4uL2FwcC91aS93aW5kb3ctbWFuYWdlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiB3aW5kb3dNYW5hZ2VyLm9wZW5XZWJzaXRlU2VsZWN0aW9uV2luZG93KS50b0JlKCdmdW5jdGlvbicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiB3aW5kb3dNYW5hZ2VyLm9wZW5TZXR0aW5nc1dpbmRvdykudG9CZSgnZnVuY3Rpb24nKTtcbiAgICAgIGV4cGVjdCh0eXBlb2Ygd2luZG93TWFuYWdlci5nZXROYXRpdmVJbnB1dCkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhwb3J0IGZ1bmN0aW9ucyBmcm9tIG1lbnUgbW9kdWxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVudSA9IHJlcXVpcmUoJy4uL2FwcC91aS9tZW51Jyk7XG4gICAgICBleHBlY3QodHlwZW9mIG1lbnUuY3JlYXRlQXBwbGljYXRpb25NZW51KS50b0JlKCdmdW5jdGlvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgZnVuY3Rpb25zIGZyb20gZWxldmVudHkgc2VydmVyJywgKCkgPT4ge1xuICAgICAgY29uc3QgZWxldmVudHkgPSByZXF1aXJlKCcuLi9hcHAvc2VydmVyL2VsZXZlbnR5Jyk7XG4gICAgICBleHBlY3QodHlwZW9mIGVsZXZlbnR5LmdldEhvc3RuYW1lRnJvbVRlc3REb21haW4pLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIGVsZXZlbnR5LnZhbGlkYXRlV2Vic2l0ZU5hbWUpLnRvQmUoJ3VuZGVmaW5lZCcpOyAvLyBOb3QgaW4gdGhpcyBtb2R1bGVcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhwb3J0IGZ1bmN0aW9ucyBmcm9tIHdlYnNpdGUgbWFuYWdlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHdlYnNpdGVNYW5hZ2VyID0gcmVxdWlyZSgnLi4vYXBwL3V0aWxzL3dlYnNpdGUtbWFuYWdlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiB3ZWJzaXRlTWFuYWdlci52YWxpZGF0ZVdlYnNpdGVOYW1lKS50b0JlKCdmdW5jdGlvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgZnVuY3Rpb25zIGZyb20gaG9zdHMgbWFuYWdlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGhvc3RzTWFuYWdlciA9IHJlcXVpcmUoJy4uL2FwcC9kbnMvaG9zdHMtbWFuYWdlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBob3N0c01hbmFnZXIuYWRkTG9jYWxEbnNSZXNvbHV0aW9uKS50b0JlKCdmdW5jdGlvbicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBob3N0c01hbmFnZXIuY2xlYW51cEhvc3RzRmlsZSkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgaG9zdHNNYW5hZ2VyLnVwZGF0ZUhvc3RzRmlsZSkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgaG9zdHNNYW5hZ2VyLmNoZWNrQW5kU3VnZ2VzdFRvdWNoSWRTZXR1cCkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1B1cmUgRnVuY3Rpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXh0cmFjdCBob3N0bmFtZXMgZnJvbSB2YWxpZCBVUkxzJywgKCkgPT4ge1xuICAgICAgY29uc3QgeyBnZXRIb3N0bmFtZUZyb21UZXN0RG9tYWluIH0gPSByZXF1aXJlKCcuLi9hcHAvc2VydmVyL2VsZXZlbnR5Jyk7XG5cbiAgICAgIGV4cGVjdChcbiAgICAgICAgZ2V0SG9zdG5hbWVGcm9tVGVzdERvbWFpbihcbiAgICAgICAgICBgaHR0cHM6Ly8ke1RFU1RfQ09OU1RBTlRTLldFQlNJVEVTLk1ZX1NJVEV9LiR7VEVTVF9DT05TVEFOVFMuRE9NQUlOUy5URVNUX0RPTUFJTn06JHtURVNUX0NPTlNUQU5UUy5QT1JUUy5ERUZBVUxUX0hUVFBTfWBcbiAgICAgICAgKVxuICAgICAgKS50b0JlKGAke1RFU1RfQ09OU1RBTlRTLldFQlNJVEVTLk1ZX1NJVEV9LiR7VEVTVF9DT05TVEFOVFMuRE9NQUlOUy5URVNUX0RPTUFJTn1gKTtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgZ2V0SG9zdG5hbWVGcm9tVGVzdERvbWFpbihcbiAgICAgICAgICBgaHR0cHM6Ly8ke1RFU1RfQ09OU1RBTlRTLldFQlNJVEVTLkVYQU1QTEVfU0lURX0uJHtURVNUX0NPTlNUQU5UUy5ET01BSU5TLlRFU1RfRE9NQUlOfToke1RFU1RfQ09OU1RBTlRTLlBPUlRTLkRFRkFVTFRfSFRUUFN9YFxuICAgICAgICApXG4gICAgICApLnRvQmUoYCR7VEVTVF9DT05TVEFOVFMuV0VCU0lURVMuRVhBTVBMRV9TSVRFfS4ke1RFU1RfQ09OU1RBTlRTLkRPTUFJTlMuVEVTVF9ET01BSU59YCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHdlYnNpdGUgbmFtZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB7IHZhbGlkYXRlV2Vic2l0ZU5hbWUgfSA9IHJlcXVpcmUoJy4uL2FwcC91dGlscy93ZWJzaXRlLW1hbmFnZXInKTtcblxuICAgICAgLy8gVmFsaWQgbmFtZXMgKGZpbGVzeXN0ZW0tc2FmZSBjaGFyYWN0ZXJzKVxuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ3ZhbGlkLW5hbWUnKS52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlMTIzJykudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnbXlfc2l0ZScpLnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ015IFdlYnNpdGUnKS52YWxpZCkudG9CZSh0cnVlKTsgLy8gU3BhY2VzIGFsbG93ZWQgaW4gbWlkZGxlXG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnc2l0ZSAodjIpJykudmFsaWQpLnRvQmUodHJ1ZSk7IC8vIFBhcmVudGhlc2VzIGFsbG93ZWRcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlK21vcmUnKS52YWxpZCkudG9CZSh0cnVlKTsgLy8gUGx1cyBzaWduIGFsbG93ZWRcblxuICAgICAgLy8gSW52YWxpZCBuYW1lc1xuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJycpLnZhbGlkKS50b0JlKGZhbHNlKTsgLy8gRW1wdHlcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCcgICcpLnZhbGlkKS50b0JlKGZhbHNlKTsgLy8gT25seSBzcGFjZXNcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCcgbGVhZGluZyBzcGFjZScpLnZhbGlkKS50b0JlKGZhbHNlKTsgLy8gTGVhZGluZyBzcGFjZVxuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ3RyYWlsaW5nIHNwYWNlICcpLnZhbGlkKS50b0JlKGZhbHNlKTsgLy8gVHJhaWxpbmcgc3BhY2VcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCcuaGlkZGVuJykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBMZWFkaW5nIGRvdFxuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ3NpdGUuJykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBUcmFpbGluZyBkb3RcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlL2ZvbGRlcicpLnZhbGlkKS50b0JlKGZhbHNlKTsgLy8gRm9yd2FyZCBzbGFzaFxuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ3NpdGVcXFxcZm9sZGVyJykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBCYWNrc2xhc2hcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlOnBvcnQnKS52YWxpZCkudG9CZShmYWxzZSk7IC8vIENvbG9uXG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnc2l0ZTx0YWc+JykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBBbmdsZSBicmFja2V0c1xuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ3NpdGVcInF1b3RlZFwiJykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBRdW90ZXNcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlfHBpcGUnKS52YWxpZCkudG9CZShmYWxzZSk7IC8vIFBpcGVcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlP3F1ZXJ5JykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBRdWVzdGlvbiBtYXJrXG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnc2l0ZSpnbG9iJykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBBc3Rlcmlza1xuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ0NPTicpLnZhbGlkKS50b0JlKGZhbHNlKTsgLy8gUmVzZXJ2ZWQgV2luZG93cyBuYW1lXG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgncHJuJykudmFsaWQpLnRvQmUoZmFsc2UpOyAvLyBSZXNlcnZlZCBXaW5kb3dzIG5hbWUgKGNhc2UgaW5zZW5zaXRpdmUpXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgcGF0aCB0cmF2ZXJzYWwgYXR0YWNrcyBpbiB3ZWJzaXRlIG5hbWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgeyB2YWxpZGF0ZVdlYnNpdGVOYW1lIH0gPSByZXF1aXJlKCcuLi9hcHAvdXRpbHMvd2Vic2l0ZS1tYW5hZ2VyJyk7XG5cbiAgICAgIC8vIFBhdGggdHJhdmVyc2FsIGF0dGVtcHRzIHVzaW5nIGRvdWJsZSBkb3RzXG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnLi4nKS52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnLi4vJykudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJy4uXFxcXCcpLnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCcuLi9ldGMnKS52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnLi5cXFxcLi5cXFxcd2luZG93cycpLnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlLy4uL2V0YycpLnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdzaXRlXFxcXC4uXFxcXHdpbmRvd3MnKS52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnLi4uLi8vJykudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ3NpdGUuLnBhcmVudCcpLnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVdlYnNpdGVOYW1lKCdub3JtYWwuLmJ1dGJhZCcpLnZhbGlkKS50b0JlKGZhbHNlKTtcblxuICAgICAgLy8gRW5zdXJlIHRoZSBlcnJvciBtZXNzYWdlIGluZGljYXRlcyBwYXRoIHRyYXZlcnNhbCBwcm90ZWN0aW9uXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZVdlYnNpdGVOYW1lKCcuLicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ2RpcmVjdG9yeSB0cmF2ZXJzYWwnKTtcblxuICAgICAgLy8gVmFsaWQgbmFtZXMgdGhhdCBjb250YWluIGRvdHMgKGJ1dCBub3QgcGF0aCB0cmF2ZXJzYWwpXG4gICAgICBleHBlY3QodmFsaWRhdGVXZWJzaXRlTmFtZSgnc2l0ZS5jb20nKS52YWxpZCkudG9CZSh0cnVlKTsgLy8gVmFsaWQsIGRvdCBpbiBtaWRkbGUgaXMgYWxsb3dlZFxuICAgICAgZXhwZWN0KHZhbGlkYXRlV2Vic2l0ZU5hbWUoJ215LXNpdGUtdjInKS52YWxpZCkudG9CZSh0cnVlKTsgLy8gVmFsaWQsIG5vIGRvdHMgZm9yIHRyYXZlcnNhbFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVmYWN0b3JpbmcgU3VjY2VzcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhdmUgbW92ZWQgbWFpbi50cyBmcm9tIG1vbm9saXRoIHRvIG1vZHVsYXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG4gICAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG4gICAgICBjb25zdCBtYWluUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICdhcHAnLCAnbWFpbi50cycpO1xuICAgICAgY29uc3QgbWFpbkNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMobWFpblBhdGgsICd1dGY4Jyk7XG5cbiAgICAgIC8vIFNob3VsZCBiZSBtdWNoIHNob3J0ZXIgbm93IChyZWZhY3RvcmVkKVxuICAgICAgY29uc3QgbGluZUNvdW50ID0gbWFpbkNvbnRlbnQuc3BsaXQoJ1xcbicpLmxlbmd0aDtcbiAgICAgIGV4cGVjdChsaW5lQ291bnQpLnRvQmVMZXNzVGhhbihURVNUX0NPTlNUQU5UUy5TSVpFUy5NQVhfTElORVMpOyAvLyBXYXMgb3ZlciAke1RFU1RfQ09OU1RBTlRTLlNJWkVTLkNPTVBMRVhJVFlfVEhSRVNIT0xEfSBsaW5lcyBiZWZvcmVcblxuICAgICAgLy8gU2hvdWxkIGltcG9ydCBmcm9tIG1vZHVsZXNcbiAgICAgIGV4cGVjdChtYWluQ29udGVudCkudG9Db250YWluKCdpbXBvcnQgeyBjcmVhdGVBcHBsaWNhdGlvbk1lbnUnKTtcbiAgICAgIGV4cGVjdChtYWluQ29udGVudCkudG9Db250YWluKCdpbXBvcnQgeyBzZXR1cElwY01haW5MaXN0ZW5lcnMnKTtcbiAgICAgIC8vIENoZWNrIHRoYXQgRE5TIG1hbmFnZW1lbnQgZnVuY3Rpb25zIGFyZSBpbXBvcnRlZCAobWF5IGJlIG11bHRpLWxpbmUpXG4gICAgICBleHBlY3QobWFpbkNvbnRlbnQpLnRvQ29udGFpbignY2xlYW51cEhvc3RzRmlsZScpO1xuICAgICAgZXhwZWN0KG1haW5Db250ZW50KS50b0NvbnRhaW4oJ2NoZWNrQW5kU3VnZ2VzdFRvdWNoSWRTZXR1cCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIHNlcGFyYXRlIG1vZHVsZSBmaWxlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbiAgICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbiAgICAgIC8vIENoZWNrIHRoYXQgbW9kdWxhciBmaWxlcyBleGlzdFxuICAgICAgY29uc3QgbW9kdWxlcyA9IFtcbiAgICAgICAgJ3VpL3dpbmRvdy1tYW5hZ2VyLnRzJyxcbiAgICAgICAgJ3VpL21lbnUudHMnLFxuICAgICAgICAnc2VydmVyL2VsZXZlbnR5LnRzJyxcbiAgICAgICAgJ3NlcnZlci9odHRwcy1wcm94eS50cycsXG4gICAgICAgICdpcGMvaGFuZGxlcnMudHMnLFxuICAgICAgICAndXRpbHMvd2Vic2l0ZS1tYW5hZ2VyLnRzJyxcbiAgICAgICAgJ2Rucy9ob3N0cy1tYW5hZ2VyLnRzJyxcbiAgICAgICAgJ2NlcnRpZmljYXRlcy50cycsXG4gICAgICBdO1xuXG4gICAgICBtb2R1bGVzLmZvckVhY2goKG1vZHVsZVBhdGgpID0+IHtcbiAgICAgICAgY29uc3QgZnVsbFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnYXBwJywgbW9kdWxlUGF0aCk7XG4gICAgICAgIGV4cGVjdChmcy5leGlzdHNTeW5jKGZ1bGxQYXRoKSkudG9CZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9