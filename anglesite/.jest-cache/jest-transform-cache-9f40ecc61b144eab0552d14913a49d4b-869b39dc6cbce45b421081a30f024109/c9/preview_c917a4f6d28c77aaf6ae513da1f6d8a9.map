{"version":3,"names":["exports","setupPreviewHandlers","electron_1","cov_2j9x9fxakk","s","require","child_process_1","multi_window_manager_1","eleventy_1","website_manager_1","f","ipcMain","on","exec","err","stdout","b","console","error","log","togglePreviewDevTools","event","showWebsitePreview","Promise","resolve","then","__importStar","window","BrowserWindow","fromWebContents","sender","websiteName","getWebsiteNameForWindow","hideWebsitePreview","websitePath","getWebsitePath","startWebsiteServerAndUpdateWindow","shell","openExternal","getCurrentLiveServerUrl","localhostUrl","replace","fallbackError","win","webContents","session","clearCache","websiteWindows","getAllWebsiteWindows","websiteWindow","Array","from"],"sources":["/Users/dwk/Developer/gitlab.com/davidwkeith/@dwk/anglesite/app/ipc/preview.ts"],"sourcesContent":["/**\n * @file IPC handlers for preview and development tools\n */\nimport { ipcMain, BrowserWindow, shell } from 'electron';\nimport { exec } from 'child_process';\nimport {\n  getAllWebsiteWindows,\n  togglePreviewDevTools,\n  startWebsiteServerAndUpdateWindow,\n} from '../ui/multi-window-manager';\nimport { getCurrentLiveServerUrl } from '../server/eleventy';\nimport { getWebsitePath } from '../utils/website-manager';\n\n/**\n * Setup preview and development tools IPC handlers.\n *\n * Registers handlers for preview controls, development tools, and browser operations.\n */\nexport function setupPreviewHandlers(): void {\n  // Build command handler\n  ipcMain.on('build', () => {\n    exec('npm run build', (err, stdout) => {\n      if (err) {\n        console.error(err);\n        return;\n      }\n      console.log(stdout);\n    });\n  });\n\n  ipcMain.on('toggle-devtools', () => {\n    togglePreviewDevTools();\n  });\n\n  // Website Editor mode switching handlers\n  ipcMain.on('website-editor-show-preview', async (event) => {\n    const { showWebsitePreview } = await import('../ui/multi-window-manager');\n    const window = BrowserWindow.fromWebContents(event.sender);\n    if (window) {\n      const websiteName = getWebsiteNameForWindow(window);\n      if (websiteName) {\n        showWebsitePreview(websiteName);\n      }\n    }\n  });\n\n  ipcMain.on('website-editor-show-edit', async (event) => {\n    const { hideWebsitePreview } = await import('../ui/multi-window-manager');\n    const window = BrowserWindow.fromWebContents(event.sender);\n    if (window) {\n      const websiteName = getWebsiteNameForWindow(window);\n      if (websiteName) {\n        hideWebsitePreview(websiteName);\n      }\n    }\n  });\n\n  // Reload preview handler\n  ipcMain.on('reload-preview', async (event) => {\n    const window = BrowserWindow.fromWebContents(event.sender);\n    if (window) {\n      const websiteName = getWebsiteNameForWindow(window);\n      if (websiteName) {\n        try {\n          const websitePath = getWebsitePath(websiteName);\n          if (websitePath) {\n            await startWebsiteServerAndUpdateWindow(websiteName, websitePath);\n          } else {\n            console.error(`Could not find path for website: ${websiteName}`);\n          }\n        } catch (error) {\n          console.error(`Failed to reload preview for ${websiteName}:`, error);\n        }\n      }\n    }\n  });\n\n  // Browser handlers\n  ipcMain.on('open-browser', async () => {\n    try {\n      await shell.openExternal(getCurrentLiveServerUrl());\n    } catch {\n      const localhostUrl = getCurrentLiveServerUrl().replace(/https:\\/\\/[^.]+\\.test:/, 'https://localhost:');\n      try {\n        await shell.openExternal(localhostUrl);\n      } catch (fallbackError) {\n        console.error('Failed to open in browser:', fallbackError);\n      }\n    }\n  });\n\n  // Development tools\n  ipcMain.on('clear-cache', (event) => {\n    const win = BrowserWindow.fromWebContents(event.sender);\n    if (win) {\n      win.webContents.session.clearCache();\n    }\n  });\n}\n\n/**\n * Helper function to get website name from a BrowserWindow.\n */\nfunction getWebsiteNameForWindow(window: BrowserWindow): string | null {\n  const websiteWindows = getAllWebsiteWindows();\n  for (const [websiteName, websiteWindow] of Array.from(websiteWindows)) {\n    if (websiteWindow.window === window) {\n      return websiteName;\n    }\n  }\n  return null;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}