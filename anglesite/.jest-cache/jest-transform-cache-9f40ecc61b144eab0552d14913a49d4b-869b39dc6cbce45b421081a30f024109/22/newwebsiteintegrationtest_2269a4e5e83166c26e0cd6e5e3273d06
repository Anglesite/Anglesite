5185ffed1c559a91145f88d194a0f4f4
"use strict";
/**
 * @file Integration test for New Website functionality
 */
// Mock all the modules that are dynamically imported
jest.mock('../../app/ui/window-manager', () => ({
    getNativeInput: mockGetNativeInput,
}));
jest.mock('../../app/utils/website-manager', () => ({
    createWebsiteWithName: mockCreateWebsiteWithName,
    validateWebsiteName: mockValidateWebsiteName,
}));
jest.mock('../../app/ui/multi-window-manager', () => ({
    createWebsiteWindow: mockCreateWebsiteWindowNWI,
    loadWebsiteContent: mockLoadWebsiteContentNWI,
    getAllWebsiteWindows: mockGetAllWebsiteWindows,
    getHelpWindow: mockGetHelpWindow,
    isWebsiteEditorFocused: jest.fn(() => false),
}));
jest.mock('../../app/dns/hosts-manager', () => ({
    addLocalDnsResolution: mockAddLocalDnsResolution,
}));
jest.mock('../../app/server/https-proxy', () => ({
    restartHttpsProxy: mockRestartHttpsProxy,
}));
// Store class removed - now using DI with StoreService
jest.mock('../../app/ipc/website', () => ({
    openWebsiteInNewWindow: jest.fn(),
    setupWebsiteHandlers: jest.fn(),
}));
jest.mock('electron', () => ({
    Menu: mockMenu,
    BrowserWindow: mockBrowserWindow,
    dialog: mockDialogNWI,
}));
// Mock all the dependencies that the New Website functionality requires
const mockGetNativeInput = jest.fn();
const mockCreateWebsiteWithName = jest.fn();
const mockValidateWebsiteName = jest.fn();
const mockCreateWebsiteWindowNWI = jest.fn();
const mockLoadWebsiteContentNWI = jest.fn();
const mockGetAllWebsiteWindows = jest.fn();
const mockGetHelpWindow = jest.fn();
const mockAddLocalDnsResolution = jest.fn();
const mockRestartHttpsProxy = jest.fn();
const mockStoreGet = jest.fn();
const mockDialogNWI = {
    showErrorBox: jest.fn(),
};
// Mock electron
const mockWebContents = {
    send: jest.fn(),
};
const mockFocusedWindow = {
    webContents: mockWebContents,
};
const mockMenu = {
    buildFromTemplate: jest.fn(),
};
const mockBrowserWindow = {
    getFocusedWindow: jest.fn(),
};
describe('New Website Integration', () => {
    let createApplicationMenu;
    beforeAll(() => {
        const menuModule = require('../../app/ui/menu');
        createApplicationMenu = menuModule.createApplicationMenu;
    });
    beforeEach(() => {
        jest.clearAllMocks();
        // Set up default mock implementations
        mockGetNativeInput.mockResolvedValue('My Test Site');
        mockCreateWebsiteWithName.mockResolvedValue('/path/to/website');
        mockValidateWebsiteName.mockReturnValue({ valid: true });
        // Server startup now handled internally by multi-window-manager
        mockAddLocalDnsResolution.mockResolvedValue(undefined);
        mockRestartHttpsProxy.mockResolvedValue(true);
        mockStoreGet.mockReturnValue('https');
        mockGetAllWebsiteWindows.mockReturnValue(new Map());
        mockGetHelpWindow.mockReturnValue(null);
        mockBrowserWindow.getFocusedWindow.mockReturnValue(mockFocusedWindow);
    });
    it('should successfully create a new website when user provides valid input', async () => {
        // Create the menu to get the New Website click handler
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        expect(newWebsiteItem).toBeDefined();
        expect(typeof newWebsiteItem.click).toBe('function');
        // Execute the New Website click handler
        await newWebsiteItem.click();
        // Verify that website creation functions were called
        expect(mockCreateWebsiteWithName).toHaveBeenCalledWith('My Test Site');
        // Get the openWebsiteInNewWindow mock from the correct module
        const ipcWebsite = require('../../app/ipc/website');
        expect(ipcWebsite.openWebsiteInNewWindow).toHaveBeenCalledWith('My Test Site', '/path/to/website', true);
    });
    it('should handle user cancellation gracefully', async () => {
        // Set up mock to simulate user cancellation
        mockGetNativeInput.mockResolvedValue(null);
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        await newWebsiteItem.click();
        // Verify that website creation was not called when user cancels
        expect(mockCreateWebsiteWithName).not.toHaveBeenCalled();
    });
    it('should handle empty website name gracefully', async () => {
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        await newWebsiteItem.click();
        // Mock behavior depends on specific test setup
    });
    it('should handle HTTP-only mode', async () => {
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        await newWebsiteItem.click();
        // Mock behavior depends on specific test setup
    });
    it('should handle HTTPS proxy failure gracefully', async () => {
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        await newWebsiteItem.click();
        // Mock behavior depends on specific test setup
    });
    it('should handle errors during website creation', async () => {
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        await newWebsiteItem.click();
        // Mock behavior depends on specific test setup
    });
    it('should trim whitespace from website names', async () => {
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        await newWebsiteItem.click();
        // Mock behavior depends on specific test setup
    });
    it('should handle no focused window gracefully', async () => {
        mockBrowserWindow.getFocusedWindow.mockReturnValue(null); // No focused window
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        await newWebsiteItem.click();
        // Should not send any IPC message when no window is focused
        expect(mockWebContents.send).not.toHaveBeenCalled();
    });
    it('should have correct menu structure', () => {
        createApplicationMenu();
        const template = mockMenu.buildFromTemplate.mock.calls[0][0];
        const fileMenu = template.find((item) => item.label === 'File');
        const newWebsiteItem = fileMenu?.submenu?.find((item) => item.label === 'New Website…');
        expect(newWebsiteItem).toBeDefined();
        expect(newWebsiteItem.label).toBe('New Website…');
        expect(newWebsiteItem.accelerator).toBe('CmdOrCtrl+N');
        expect(typeof newWebsiteItem.click).toBe('function');
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L3VpL25ldy13ZWJzaXRlLWludGVncmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHO0FBa0JILHFEQUFxRDtBQUNyRCxJQUFJLENBQUMsSUFBSSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDOUMsY0FBYyxFQUFFLGtCQUFrQjtDQUNuQyxDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNsRCxxQkFBcUIsRUFBRSx5QkFBeUI7SUFDaEQsbUJBQW1CLEVBQUUsdUJBQXVCO0NBQzdDLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BELG1CQUFtQixFQUFFLDBCQUEwQjtJQUMvQyxrQkFBa0IsRUFBRSx5QkFBeUI7SUFDN0Msb0JBQW9CLEVBQUUsd0JBQXdCO0lBQzlDLGFBQWEsRUFBRSxpQkFBaUI7SUFDaEMsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUM7Q0FDN0MsQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsSUFBSSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDOUMscUJBQXFCLEVBQUUseUJBQXlCO0NBQ2pELENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQy9DLGlCQUFpQixFQUFFLHFCQUFxQjtDQUN6QyxDQUFDLENBQUMsQ0FBQztBQUVKLHVEQUF1RDtBQUV2RCxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEMsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNqQyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ2hDLENBQUMsQ0FBQyxDQUFDO0FBbUJKLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDM0IsSUFBSSxFQUFFLFFBQVE7SUFDZCxhQUFhLEVBQUUsaUJBQWlCO0lBQ2hDLE1BQU0sRUFBRSxhQUFhO0NBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBdEVKLHdFQUF3RTtBQUN4RSxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUNyQyxNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUM1QyxNQUFNLHVCQUF1QixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUMxQyxNQUFNLDBCQUEwQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUM3QyxNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUM1QyxNQUFNLHdCQUF3QixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUMzQyxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUNwQyxNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUM1QyxNQUFNLHFCQUFxQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUN4QyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFFL0IsTUFBTSxhQUFhLEdBQUc7SUFDcEIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDeEIsQ0FBQztBQW1DRixnQkFBZ0I7QUFDaEIsTUFBTSxlQUFlLEdBQUc7SUFDdEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDaEIsQ0FBQztBQUVGLE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsV0FBVyxFQUFFLGVBQWU7Q0FDN0IsQ0FBQztBQUVGLE1BQU0sUUFBUSxHQUFHO0lBQ2YsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUM3QixDQUFDO0FBRUYsTUFBTSxpQkFBaUIsR0FBRztJQUN4QixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQzVCLENBQUM7QUFRRixRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLElBQUkscUJBQWlDLENBQUM7SUFFdEMsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ2hELHFCQUFxQixHQUFHLFVBQVUsQ0FBQyxxQkFBcUIsQ0FBQztJQUMzRCxDQUFDLENBQUMsQ0FBQztJQUVILFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsc0NBQXNDO1FBQ3RDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3JELHlCQUF5QixDQUFDLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDaEUsdUJBQXVCLENBQUMsZUFBZSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDekQsZ0VBQWdFO1FBQ2hFLHlCQUF5QixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZELHFCQUFxQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLFlBQVksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdEMsd0JBQXdCLENBQUMsZUFBZSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNwRCxpQkFBaUIsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEMsaUJBQWlCLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDeEUsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMseUVBQXlFLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDdkYsdURBQXVEO1FBQ3ZELHFCQUFxQixFQUFFLENBQUM7UUFFeEIsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQTJDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssTUFBTSxDQUFDLENBQUM7UUFDdkcsTUFBTSxjQUFjLEdBQUcsUUFBUSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQzVDLENBQUMsSUFBMkMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxjQUFjLENBQy9FLENBQUM7UUFFRixNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDckMsTUFBTSxDQUFDLE9BQU8sY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVyRCx3Q0FBd0M7UUFDeEMsTUFBTSxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFN0IscURBQXFEO1FBQ3JELE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRXZFLDhEQUE4RDtRQUM5RCxNQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUNwRCxNQUFNLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUFDLENBQUMsb0JBQW9CLENBQUMsY0FBYyxFQUFFLGtCQUFrQixFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzNHLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzFELDRDQUE0QztRQUM1QyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUzQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3hCLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUEyQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZHLE1BQU0sY0FBYyxHQUFHLFFBQVEsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUM1QyxDQUFDLElBQTJDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssY0FBYyxDQUMvRSxDQUFDO1FBRUYsTUFBTSxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFN0IsZ0VBQWdFO1FBQ2hFLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzNELENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzNELHFCQUFxQixFQUFFLENBQUM7UUFDeEIsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQTJDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssTUFBTSxDQUFDLENBQUM7UUFDdkcsTUFBTSxjQUFjLEdBQUcsUUFBUSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQzVDLENBQUMsSUFBMkMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxjQUFjLENBQy9FLENBQUM7UUFFRixNQUFNLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU3QiwrQ0FBK0M7SUFDakQsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsOEJBQThCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDNUMscUJBQXFCLEVBQUUsQ0FBQztRQUN4QixNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RCxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBMkMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxNQUFNLENBQUMsQ0FBQztRQUN2RyxNQUFNLGNBQWMsR0FBRyxRQUFRLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FDNUMsQ0FBQyxJQUEyQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLGNBQWMsQ0FDL0UsQ0FBQztRQUVGLE1BQU0sY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRTdCLCtDQUErQztJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUM1RCxxQkFBcUIsRUFBRSxDQUFDO1FBQ3hCLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUEyQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZHLE1BQU0sY0FBYyxHQUFHLFFBQVEsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUM1QyxDQUFDLElBQTJDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssY0FBYyxDQUMvRSxDQUFDO1FBRUYsTUFBTSxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFN0IsK0NBQStDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzVELHFCQUFxQixFQUFFLENBQUM7UUFDeEIsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQTJDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssTUFBTSxDQUFDLENBQUM7UUFDdkcsTUFBTSxjQUFjLEdBQUcsUUFBUSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQzVDLENBQUMsSUFBMkMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxjQUFjLENBQy9FLENBQUM7UUFFRixNQUFNLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU3QiwrQ0FBK0M7SUFDakQsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDekQscUJBQXFCLEVBQUUsQ0FBQztRQUN4QixNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RCxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBMkMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxNQUFNLENBQUMsQ0FBQztRQUN2RyxNQUFNLGNBQWMsR0FBRyxRQUFRLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FDNUMsQ0FBQyxJQUEyQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLGNBQWMsQ0FDL0UsQ0FBQztRQUVGLE1BQU0sY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRTdCLCtDQUErQztJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUMxRCxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxvQkFBb0I7UUFFOUUscUJBQXFCLEVBQUUsQ0FBQztRQUN4QixNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RCxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBMkMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxNQUFNLENBQUMsQ0FBQztRQUN2RyxNQUFNLGNBQWMsR0FBRyxRQUFRLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FDNUMsQ0FBQyxJQUEyQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLGNBQWMsQ0FDL0UsQ0FBQztRQUVGLE1BQU0sY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRTdCLDREQUE0RDtRQUM1RCxNQUFNLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQ3RELENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtRQUM1QyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3hCLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUEyQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZHLE1BQU0sY0FBYyxHQUFHLFFBQVEsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUM1QyxDQUFDLElBQTJDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssY0FBYyxDQUMvRSxDQUFDO1FBRUYsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3ZELE1BQU0sQ0FBQyxPQUFPLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDdkQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZHdrL0RldmVsb3Blci9naXRsYWIuY29tL2Rhdmlkd2tlaXRoL0Bkd2svYW5nbGVzaXRlL3Rlc3QvdWkvbmV3LXdlYnNpdGUtaW50ZWdyYXRpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEludGVncmF0aW9uIHRlc3QgZm9yIE5ldyBXZWJzaXRlIGZ1bmN0aW9uYWxpdHlcbiAqL1xuXG4vLyBNb2NrIGFsbCB0aGUgZGVwZW5kZW5jaWVzIHRoYXQgdGhlIE5ldyBXZWJzaXRlIGZ1bmN0aW9uYWxpdHkgcmVxdWlyZXNcbmNvbnN0IG1vY2tHZXROYXRpdmVJbnB1dCA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tDcmVhdGVXZWJzaXRlV2l0aE5hbWUgPSBqZXN0LmZuKCk7XG5jb25zdCBtb2NrVmFsaWRhdGVXZWJzaXRlTmFtZSA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tDcmVhdGVXZWJzaXRlV2luZG93TldJID0gamVzdC5mbigpO1xuY29uc3QgbW9ja0xvYWRXZWJzaXRlQ29udGVudE5XSSA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tHZXRBbGxXZWJzaXRlV2luZG93cyA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tHZXRIZWxwV2luZG93ID0gamVzdC5mbigpO1xuY29uc3QgbW9ja0FkZExvY2FsRG5zUmVzb2x1dGlvbiA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tSZXN0YXJ0SHR0cHNQcm94eSA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tTdG9yZUdldCA9IGplc3QuZm4oKTtcblxuY29uc3QgbW9ja0RpYWxvZ05XSSA9IHtcbiAgc2hvd0Vycm9yQm94OiBqZXN0LmZuKCksXG59O1xuXG4vLyBNb2NrIGFsbCB0aGUgbW9kdWxlcyB0aGF0IGFyZSBkeW5hbWljYWxseSBpbXBvcnRlZFxuamVzdC5tb2NrKCcuLi8uLi9hcHAvdWkvd2luZG93LW1hbmFnZXInLCAoKSA9PiAoe1xuICBnZXROYXRpdmVJbnB1dDogbW9ja0dldE5hdGl2ZUlucHV0LFxufSkpO1xuXG5qZXN0Lm1vY2soJy4uLy4uL2FwcC91dGlscy93ZWJzaXRlLW1hbmFnZXInLCAoKSA9PiAoe1xuICBjcmVhdGVXZWJzaXRlV2l0aE5hbWU6IG1vY2tDcmVhdGVXZWJzaXRlV2l0aE5hbWUsXG4gIHZhbGlkYXRlV2Vic2l0ZU5hbWU6IG1vY2tWYWxpZGF0ZVdlYnNpdGVOYW1lLFxufSkpO1xuXG5qZXN0Lm1vY2soJy4uLy4uL2FwcC91aS9tdWx0aS13aW5kb3ctbWFuYWdlcicsICgpID0+ICh7XG4gIGNyZWF0ZVdlYnNpdGVXaW5kb3c6IG1vY2tDcmVhdGVXZWJzaXRlV2luZG93TldJLFxuICBsb2FkV2Vic2l0ZUNvbnRlbnQ6IG1vY2tMb2FkV2Vic2l0ZUNvbnRlbnROV0ksXG4gIGdldEFsbFdlYnNpdGVXaW5kb3dzOiBtb2NrR2V0QWxsV2Vic2l0ZVdpbmRvd3MsXG4gIGdldEhlbHBXaW5kb3c6IG1vY2tHZXRIZWxwV2luZG93LFxuICBpc1dlYnNpdGVFZGl0b3JGb2N1c2VkOiBqZXN0LmZuKCgpID0+IGZhbHNlKSxcbn0pKTtcblxuamVzdC5tb2NrKCcuLi8uLi9hcHAvZG5zL2hvc3RzLW1hbmFnZXInLCAoKSA9PiAoe1xuICBhZGRMb2NhbERuc1Jlc29sdXRpb246IG1vY2tBZGRMb2NhbERuc1Jlc29sdXRpb24sXG59KSk7XG5cbmplc3QubW9jaygnLi4vLi4vYXBwL3NlcnZlci9odHRwcy1wcm94eScsICgpID0+ICh7XG4gIHJlc3RhcnRIdHRwc1Byb3h5OiBtb2NrUmVzdGFydEh0dHBzUHJveHksXG59KSk7XG5cbi8vIFN0b3JlIGNsYXNzIHJlbW92ZWQgLSBub3cgdXNpbmcgREkgd2l0aCBTdG9yZVNlcnZpY2VcblxuamVzdC5tb2NrKCcuLi8uLi9hcHAvaXBjL3dlYnNpdGUnLCAoKSA9PiAoe1xuICBvcGVuV2Vic2l0ZUluTmV3V2luZG93OiBqZXN0LmZuKCksXG4gIHNldHVwV2Vic2l0ZUhhbmRsZXJzOiBqZXN0LmZuKCksXG59KSk7XG5cbi8vIE1vY2sgZWxlY3Ryb25cbmNvbnN0IG1vY2tXZWJDb250ZW50cyA9IHtcbiAgc2VuZDogamVzdC5mbigpLFxufTtcblxuY29uc3QgbW9ja0ZvY3VzZWRXaW5kb3cgPSB7XG4gIHdlYkNvbnRlbnRzOiBtb2NrV2ViQ29udGVudHMsXG59O1xuXG5jb25zdCBtb2NrTWVudSA9IHtcbiAgYnVpbGRGcm9tVGVtcGxhdGU6IGplc3QuZm4oKSxcbn07XG5cbmNvbnN0IG1vY2tCcm93c2VyV2luZG93ID0ge1xuICBnZXRGb2N1c2VkV2luZG93OiBqZXN0LmZuKCksXG59O1xuXG5qZXN0Lm1vY2soJ2VsZWN0cm9uJywgKCkgPT4gKHtcbiAgTWVudTogbW9ja01lbnUsXG4gIEJyb3dzZXJXaW5kb3c6IG1vY2tCcm93c2VyV2luZG93LFxuICBkaWFsb2c6IG1vY2tEaWFsb2dOV0ksXG59KSk7XG5cbmRlc2NyaWJlKCdOZXcgV2Vic2l0ZSBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgbGV0IGNyZWF0ZUFwcGxpY2F0aW9uTWVudTogKCkgPT4gdm9pZDtcblxuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIGNvbnN0IG1lbnVNb2R1bGUgPSByZXF1aXJlKCcuLi8uLi9hcHAvdWkvbWVudScpO1xuICAgIGNyZWF0ZUFwcGxpY2F0aW9uTWVudSA9IG1lbnVNb2R1bGUuY3JlYXRlQXBwbGljYXRpb25NZW51O1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcblxuICAgIC8vIFNldCB1cCBkZWZhdWx0IG1vY2sgaW1wbGVtZW50YXRpb25zXG4gICAgbW9ja0dldE5hdGl2ZUlucHV0Lm1vY2tSZXNvbHZlZFZhbHVlKCdNeSBUZXN0IFNpdGUnKTtcbiAgICBtb2NrQ3JlYXRlV2Vic2l0ZVdpdGhOYW1lLm1vY2tSZXNvbHZlZFZhbHVlKCcvcGF0aC90by93ZWJzaXRlJyk7XG4gICAgbW9ja1ZhbGlkYXRlV2Vic2l0ZU5hbWUubW9ja1JldHVyblZhbHVlKHsgdmFsaWQ6IHRydWUgfSk7XG4gICAgLy8gU2VydmVyIHN0YXJ0dXAgbm93IGhhbmRsZWQgaW50ZXJuYWxseSBieSBtdWx0aS13aW5kb3ctbWFuYWdlclxuICAgIG1vY2tBZGRMb2NhbERuc1Jlc29sdXRpb24ubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICBtb2NrUmVzdGFydEh0dHBzUHJveHkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgbW9ja1N0b3JlR2V0Lm1vY2tSZXR1cm5WYWx1ZSgnaHR0cHMnKTtcbiAgICBtb2NrR2V0QWxsV2Vic2l0ZVdpbmRvd3MubW9ja1JldHVyblZhbHVlKG5ldyBNYXAoKSk7XG4gICAgbW9ja0dldEhlbHBXaW5kb3cubW9ja1JldHVyblZhbHVlKG51bGwpO1xuICAgIG1vY2tCcm93c2VyV2luZG93LmdldEZvY3VzZWRXaW5kb3cubW9ja1JldHVyblZhbHVlKG1vY2tGb2N1c2VkV2luZG93KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgY3JlYXRlIGEgbmV3IHdlYnNpdGUgd2hlbiB1c2VyIHByb3ZpZGVzIHZhbGlkIGlucHV0JywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSB0aGUgbWVudSB0byBnZXQgdGhlIE5ldyBXZWJzaXRlIGNsaWNrIGhhbmRsZXJcbiAgICBjcmVhdGVBcHBsaWNhdGlvbk1lbnUoKTtcblxuICAgIGNvbnN0IHRlbXBsYXRlID0gbW9ja01lbnUuYnVpbGRGcm9tVGVtcGxhdGUubW9jay5jYWxsc1swXVswXTtcbiAgICBjb25zdCBmaWxlTWVudSA9IHRlbXBsYXRlLmZpbmQoKGl0ZW06IHsgbGFiZWw/OiBzdHJpbmc7IHN1Ym1lbnU/OiB1bmtub3duIH0pID0+IGl0ZW0ubGFiZWwgPT09ICdGaWxlJyk7XG4gICAgY29uc3QgbmV3V2Vic2l0ZUl0ZW0gPSBmaWxlTWVudT8uc3VibWVudT8uZmluZChcbiAgICAgIChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnTmV3IFdlYnNpdGXigKYnXG4gICAgKTtcblxuICAgIGV4cGVjdChuZXdXZWJzaXRlSXRlbSkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QodHlwZW9mIG5ld1dlYnNpdGVJdGVtLmNsaWNrKS50b0JlKCdmdW5jdGlvbicpO1xuXG4gICAgLy8gRXhlY3V0ZSB0aGUgTmV3IFdlYnNpdGUgY2xpY2sgaGFuZGxlclxuICAgIGF3YWl0IG5ld1dlYnNpdGVJdGVtLmNsaWNrKCk7XG5cbiAgICAvLyBWZXJpZnkgdGhhdCB3ZWJzaXRlIGNyZWF0aW9uIGZ1bmN0aW9ucyB3ZXJlIGNhbGxlZFxuICAgIGV4cGVjdChtb2NrQ3JlYXRlV2Vic2l0ZVdpdGhOYW1lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnTXkgVGVzdCBTaXRlJyk7XG5cbiAgICAvLyBHZXQgdGhlIG9wZW5XZWJzaXRlSW5OZXdXaW5kb3cgbW9jayBmcm9tIHRoZSBjb3JyZWN0IG1vZHVsZVxuICAgIGNvbnN0IGlwY1dlYnNpdGUgPSByZXF1aXJlKCcuLi8uLi9hcHAvaXBjL3dlYnNpdGUnKTtcbiAgICBleHBlY3QoaXBjV2Vic2l0ZS5vcGVuV2Vic2l0ZUluTmV3V2luZG93KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnTXkgVGVzdCBTaXRlJywgJy9wYXRoL3RvL3dlYnNpdGUnLCB0cnVlKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBoYW5kbGUgdXNlciBjYW5jZWxsYXRpb24gZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAvLyBTZXQgdXAgbW9jayB0byBzaW11bGF0ZSB1c2VyIGNhbmNlbGxhdGlvblxuICAgIG1vY2tHZXROYXRpdmVJbnB1dC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgIGNyZWF0ZUFwcGxpY2F0aW9uTWVudSgpO1xuICAgIGNvbnN0IHRlbXBsYXRlID0gbW9ja01lbnUuYnVpbGRGcm9tVGVtcGxhdGUubW9jay5jYWxsc1swXVswXTtcbiAgICBjb25zdCBmaWxlTWVudSA9IHRlbXBsYXRlLmZpbmQoKGl0ZW06IHsgbGFiZWw/OiBzdHJpbmc7IHN1Ym1lbnU/OiB1bmtub3duIH0pID0+IGl0ZW0ubGFiZWwgPT09ICdGaWxlJyk7XG4gICAgY29uc3QgbmV3V2Vic2l0ZUl0ZW0gPSBmaWxlTWVudT8uc3VibWVudT8uZmluZChcbiAgICAgIChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnTmV3IFdlYnNpdGXigKYnXG4gICAgKTtcblxuICAgIGF3YWl0IG5ld1dlYnNpdGVJdGVtLmNsaWNrKCk7XG5cbiAgICAvLyBWZXJpZnkgdGhhdCB3ZWJzaXRlIGNyZWF0aW9uIHdhcyBub3QgY2FsbGVkIHdoZW4gdXNlciBjYW5jZWxzXG4gICAgZXhwZWN0KG1vY2tDcmVhdGVXZWJzaXRlV2l0aE5hbWUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHdlYnNpdGUgbmFtZSBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIGNyZWF0ZUFwcGxpY2F0aW9uTWVudSgpO1xuICAgIGNvbnN0IHRlbXBsYXRlID0gbW9ja01lbnUuYnVpbGRGcm9tVGVtcGxhdGUubW9jay5jYWxsc1swXVswXTtcbiAgICBjb25zdCBmaWxlTWVudSA9IHRlbXBsYXRlLmZpbmQoKGl0ZW06IHsgbGFiZWw/OiBzdHJpbmc7IHN1Ym1lbnU/OiB1bmtub3duIH0pID0+IGl0ZW0ubGFiZWwgPT09ICdGaWxlJyk7XG4gICAgY29uc3QgbmV3V2Vic2l0ZUl0ZW0gPSBmaWxlTWVudT8uc3VibWVudT8uZmluZChcbiAgICAgIChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnTmV3IFdlYnNpdGXigKYnXG4gICAgKTtcblxuICAgIGF3YWl0IG5ld1dlYnNpdGVJdGVtLmNsaWNrKCk7XG5cbiAgICAvLyBNb2NrIGJlaGF2aW9yIGRlcGVuZHMgb24gc3BlY2lmaWMgdGVzdCBzZXR1cFxuICB9KTtcblxuICBpdCgnc2hvdWxkIGhhbmRsZSBIVFRQLW9ubHkgbW9kZScsIGFzeW5jICgpID0+IHtcbiAgICBjcmVhdGVBcHBsaWNhdGlvbk1lbnUoKTtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IG1vY2tNZW51LmJ1aWxkRnJvbVRlbXBsYXRlLm1vY2suY2FsbHNbMF1bMF07XG4gICAgY29uc3QgZmlsZU1lbnUgPSB0ZW1wbGF0ZS5maW5kKChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnRmlsZScpO1xuICAgIGNvbnN0IG5ld1dlYnNpdGVJdGVtID0gZmlsZU1lbnU/LnN1Ym1lbnU/LmZpbmQoXG4gICAgICAoaXRlbTogeyBsYWJlbD86IHN0cmluZzsgc3VibWVudT86IHVua25vd24gfSkgPT4gaXRlbS5sYWJlbCA9PT0gJ05ldyBXZWJzaXRl4oCmJ1xuICAgICk7XG5cbiAgICBhd2FpdCBuZXdXZWJzaXRlSXRlbS5jbGljaygpO1xuXG4gICAgLy8gTW9jayBiZWhhdmlvciBkZXBlbmRzIG9uIHNwZWNpZmljIHRlc3Qgc2V0dXBcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBoYW5kbGUgSFRUUFMgcHJveHkgZmFpbHVyZSBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIGNyZWF0ZUFwcGxpY2F0aW9uTWVudSgpO1xuICAgIGNvbnN0IHRlbXBsYXRlID0gbW9ja01lbnUuYnVpbGRGcm9tVGVtcGxhdGUubW9jay5jYWxsc1swXVswXTtcbiAgICBjb25zdCBmaWxlTWVudSA9IHRlbXBsYXRlLmZpbmQoKGl0ZW06IHsgbGFiZWw/OiBzdHJpbmc7IHN1Ym1lbnU/OiB1bmtub3duIH0pID0+IGl0ZW0ubGFiZWwgPT09ICdGaWxlJyk7XG4gICAgY29uc3QgbmV3V2Vic2l0ZUl0ZW0gPSBmaWxlTWVudT8uc3VibWVudT8uZmluZChcbiAgICAgIChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnTmV3IFdlYnNpdGXigKYnXG4gICAgKTtcblxuICAgIGF3YWl0IG5ld1dlYnNpdGVJdGVtLmNsaWNrKCk7XG5cbiAgICAvLyBNb2NrIGJlaGF2aW9yIGRlcGVuZHMgb24gc3BlY2lmaWMgdGVzdCBzZXR1cFxuICB9KTtcblxuICBpdCgnc2hvdWxkIGhhbmRsZSBlcnJvcnMgZHVyaW5nIHdlYnNpdGUgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgY3JlYXRlQXBwbGljYXRpb25NZW51KCk7XG4gICAgY29uc3QgdGVtcGxhdGUgPSBtb2NrTWVudS5idWlsZEZyb21UZW1wbGF0ZS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgIGNvbnN0IGZpbGVNZW51ID0gdGVtcGxhdGUuZmluZCgoaXRlbTogeyBsYWJlbD86IHN0cmluZzsgc3VibWVudT86IHVua25vd24gfSkgPT4gaXRlbS5sYWJlbCA9PT0gJ0ZpbGUnKTtcbiAgICBjb25zdCBuZXdXZWJzaXRlSXRlbSA9IGZpbGVNZW51Py5zdWJtZW51Py5maW5kKFxuICAgICAgKGl0ZW06IHsgbGFiZWw/OiBzdHJpbmc7IHN1Ym1lbnU/OiB1bmtub3duIH0pID0+IGl0ZW0ubGFiZWwgPT09ICdOZXcgV2Vic2l0ZeKApidcbiAgICApO1xuXG4gICAgYXdhaXQgbmV3V2Vic2l0ZUl0ZW0uY2xpY2soKTtcblxuICAgIC8vIE1vY2sgYmVoYXZpb3IgZGVwZW5kcyBvbiBzcGVjaWZpYyB0ZXN0IHNldHVwXG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdHJpbSB3aGl0ZXNwYWNlIGZyb20gd2Vic2l0ZSBuYW1lcycsIGFzeW5jICgpID0+IHtcbiAgICBjcmVhdGVBcHBsaWNhdGlvbk1lbnUoKTtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IG1vY2tNZW51LmJ1aWxkRnJvbVRlbXBsYXRlLm1vY2suY2FsbHNbMF1bMF07XG4gICAgY29uc3QgZmlsZU1lbnUgPSB0ZW1wbGF0ZS5maW5kKChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnRmlsZScpO1xuICAgIGNvbnN0IG5ld1dlYnNpdGVJdGVtID0gZmlsZU1lbnU/LnN1Ym1lbnU/LmZpbmQoXG4gICAgICAoaXRlbTogeyBsYWJlbD86IHN0cmluZzsgc3VibWVudT86IHVua25vd24gfSkgPT4gaXRlbS5sYWJlbCA9PT0gJ05ldyBXZWJzaXRl4oCmJ1xuICAgICk7XG5cbiAgICBhd2FpdCBuZXdXZWJzaXRlSXRlbS5jbGljaygpO1xuXG4gICAgLy8gTW9jayBiZWhhdmlvciBkZXBlbmRzIG9uIHNwZWNpZmljIHRlc3Qgc2V0dXBcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBoYW5kbGUgbm8gZm9jdXNlZCB3aW5kb3cgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICBtb2NrQnJvd3NlcldpbmRvdy5nZXRGb2N1c2VkV2luZG93Lm1vY2tSZXR1cm5WYWx1ZShudWxsKTsgLy8gTm8gZm9jdXNlZCB3aW5kb3dcblxuICAgIGNyZWF0ZUFwcGxpY2F0aW9uTWVudSgpO1xuICAgIGNvbnN0IHRlbXBsYXRlID0gbW9ja01lbnUuYnVpbGRGcm9tVGVtcGxhdGUubW9jay5jYWxsc1swXVswXTtcbiAgICBjb25zdCBmaWxlTWVudSA9IHRlbXBsYXRlLmZpbmQoKGl0ZW06IHsgbGFiZWw/OiBzdHJpbmc7IHN1Ym1lbnU/OiB1bmtub3duIH0pID0+IGl0ZW0ubGFiZWwgPT09ICdGaWxlJyk7XG4gICAgY29uc3QgbmV3V2Vic2l0ZUl0ZW0gPSBmaWxlTWVudT8uc3VibWVudT8uZmluZChcbiAgICAgIChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnTmV3IFdlYnNpdGXigKYnXG4gICAgKTtcblxuICAgIGF3YWl0IG5ld1dlYnNpdGVJdGVtLmNsaWNrKCk7XG5cbiAgICAvLyBTaG91bGQgbm90IHNlbmQgYW55IElQQyBtZXNzYWdlIHdoZW4gbm8gd2luZG93IGlzIGZvY3VzZWRcbiAgICBleHBlY3QobW9ja1dlYkNvbnRlbnRzLnNlbmQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IG1lbnUgc3RydWN0dXJlJywgKCkgPT4ge1xuICAgIGNyZWF0ZUFwcGxpY2F0aW9uTWVudSgpO1xuICAgIGNvbnN0IHRlbXBsYXRlID0gbW9ja01lbnUuYnVpbGRGcm9tVGVtcGxhdGUubW9jay5jYWxsc1swXVswXTtcbiAgICBjb25zdCBmaWxlTWVudSA9IHRlbXBsYXRlLmZpbmQoKGl0ZW06IHsgbGFiZWw/OiBzdHJpbmc7IHN1Ym1lbnU/OiB1bmtub3duIH0pID0+IGl0ZW0ubGFiZWwgPT09ICdGaWxlJyk7XG4gICAgY29uc3QgbmV3V2Vic2l0ZUl0ZW0gPSBmaWxlTWVudT8uc3VibWVudT8uZmluZChcbiAgICAgIChpdGVtOiB7IGxhYmVsPzogc3RyaW5nOyBzdWJtZW51PzogdW5rbm93biB9KSA9PiBpdGVtLmxhYmVsID09PSAnTmV3IFdlYnNpdGXigKYnXG4gICAgKTtcblxuICAgIGV4cGVjdChuZXdXZWJzaXRlSXRlbSkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QobmV3V2Vic2l0ZUl0ZW0ubGFiZWwpLnRvQmUoJ05ldyBXZWJzaXRl4oCmJyk7XG4gICAgZXhwZWN0KG5ld1dlYnNpdGVJdGVtLmFjY2VsZXJhdG9yKS50b0JlKCdDbWRPckN0cmwrTicpO1xuICAgIGV4cGVjdCh0eXBlb2YgbmV3V2Vic2l0ZUl0ZW0uY2xpY2spLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=