be50a77a1d816cdb2b5631c6602f188c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the per-website-server module
jest.mock('../../app/server/per-website-server', () => ({
    startWebsiteServer: jest.fn(),
    stopWebsiteServer: jest.fn(),
}));
/**
 * @file Unit tests for WebsiteServerManager
 */
const website_server_manager_1 = require("../../app/server/website-server-manager");
const mockStartWebsiteServer = require('../../app/server/per-website-server').startWebsiteServer;
const mockStopWebsiteServer = require('../../app/server/per-website-server').stopWebsiteServer;
describe('WebsiteServerManager', () => {
    let serverManager;
    let mockWebsiteServer;
    let mockLogger;
    let mockFileSystem;
    beforeEach(() => {
        // Create mock dependencies
        mockLogger = {
            child: jest.fn().mockReturnThis(),
            debug: jest.fn(),
            info: jest.fn(),
            warn: jest.fn(),
            error: jest.fn(),
        };
        mockFileSystem = {
            exists: jest.fn().mockReturnValue(true),
            readFile: jest.fn(),
            writeFile: jest.fn(),
            mkdir: jest.fn(),
            readdir: jest.fn(),
            rmdir: jest.fn(),
            copyFile: jest.fn(),
            rename: jest.fn(),
            stat: jest.fn(),
        };
        // Create a new server manager instance for each test
        serverManager = new website_server_manager_1.WebsiteServerManager(mockLogger, mockFileSystem, {
            startPort: 9000,
            maxRetries: 2,
            startupTimeout: 5000,
            shutdownTimeout: 3000,
            enableLogging: false, // Disable logging for tests
        });
        // Mock website server object
        mockWebsiteServer = {
            devServer: { watcher: { close: jest.fn() }, close: jest.fn() },
            inputDir: '/test/path/src',
            outputDir: '/test/path/_site',
            port: 9000,
            actualUrl: 'http://localhost:9000',
            urlResolver: {},
            restoreConsole: jest.fn(),
        };
        // Reset mocks
        mockStartWebsiteServer.mockClear();
        mockStopWebsiteServer.mockClear();
        mockStartWebsiteServer.mockResolvedValue(mockWebsiteServer);
        mockStopWebsiteServer.mockResolvedValue(undefined);
        // Reset file system mock
        mockFileSystem.exists.mockClear().mockReturnValue(true);
    });
    afterEach(() => {
        // Clean up server manager
        return serverManager.stopAllServers();
    });
    describe('startServer', () => {
        it('should start a server successfully', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            const serverInfo = await serverManager.startServer(websiteName, websitePath);
            expect(serverInfo.name).toBe(websiteName);
            expect(serverInfo.status).toBe('running');
            expect(serverInfo.port).toBe(9000);
            expect(serverInfo.url).toBe('http://localhost:9000');
            expect(mockStartWebsiteServer).toHaveBeenCalledWith(websitePath, websiteName, 9000);
        });
        it('should return existing running server', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            // Start server first time
            const managedServer1 = await serverManager.startServer(websiteName, websitePath);
            // Try to start again
            const managedServer2 = await serverManager.startServer(websiteName, websitePath);
            expect(managedServer1).toStrictEqual(managedServer2);
            expect(mockStartWebsiteServer).toHaveBeenCalledTimes(1);
        });
        it('should handle server start failure with retries', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            const error = new Error('Server start failed');
            // Mock consecutive failures for initial + retries
            mockStartWebsiteServer.mockRejectedValueOnce(error).mockRejectedValueOnce(error).mockRejectedValueOnce(error);
            await expect(serverManager.startServer(websiteName, websitePath)).rejects.toThrow('Server start failed');
            // Should have tried maxRetries + 1 times (initial + retries)
            expect(mockStartWebsiteServer).toHaveBeenCalledTimes(3);
            const managedServer = serverManager.getServer(websiteName);
            expect(managedServer?.state).toBe(website_server_manager_1.ServerState.ERROR);
            expect(managedServer?.lastError?.message).toBe('Server start failed');
        }, 15000); // Increase timeout for retries
        it('should validate website path before starting', async () => {
            const websiteName = 'test-site';
            const websitePath = '/invalid/path';
            // Mock file system to return false for path validation
            mockFileSystem.exists.mockReturnValue(false);
            await expect(serverManager.startServer(websiteName, websitePath)).rejects.toThrow('Invalid website path');
            expect(mockStartWebsiteServer).not.toHaveBeenCalled();
        });
    });
    describe('stopServer', () => {
        it('should stop a running server successfully', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            // Start server first
            await serverManager.startServer(websiteName, websitePath);
            // Stop the server
            await serverManager.stopServer(websiteName);
            const managedServer = serverManager.getServer(websiteName);
            expect(managedServer?.state).toBe(website_server_manager_1.ServerState.STOPPED);
            expect(managedServer?.server).toBeUndefined();
            expect(mockStopWebsiteServer).toHaveBeenCalledWith(mockWebsiteServer);
        });
        it('should handle stopping non-existent server', async () => {
            // Should not throw error
            await expect(serverManager.stopServer('non-existent')).resolves.toBeUndefined();
        });
        it('should handle server stop failure', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            const error = new Error('Server stop failed');
            mockStopWebsiteServer.mockRejectedValue(error);
            // Start server first
            await serverManager.startServer(websiteName, websitePath);
            // Stop should not throw but server should be in error state
            await serverManager.stopServer(websiteName);
            const managedServer = serverManager.getServer(websiteName);
            expect(managedServer?.state).toBe(website_server_manager_1.ServerState.ERROR);
            expect(managedServer?.lastError?.message).toBe('Server stop failed');
        });
    });
    describe('restartServer', () => {
        it('should restart a server successfully', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            // Start server first
            await serverManager.startServer(websiteName, websitePath);
            // Restart the server
            const restartedServer = await serverManager.restartServer(websiteName);
            expect(restartedServer.status).toBe('running');
            expect(mockStopWebsiteServer).toHaveBeenCalled();
            expect(mockStartWebsiteServer).toHaveBeenCalledTimes(2); // Initial start + restart
        });
        it('should fail to restart non-existent server', async () => {
            await expect(serverManager.restartServer('non-existent')).rejects.toThrow('No server found');
        });
    });
    describe('server state management', () => {
        it('should track server states correctly', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            // Initially no servers
            expect(serverManager.getRunningServersCount()).toBe(0);
            expect(serverManager.isServerRunning(websiteName)).toBe(false);
            // Start server
            await serverManager.startServer(websiteName, websitePath);
            expect(serverManager.getRunningServersCount()).toBe(1);
            expect(serverManager.isServerRunning(websiteName)).toBe(true);
            // Stop server
            await serverManager.stopServer(websiteName);
            expect(serverManager.getRunningServersCount()).toBe(0);
            expect(serverManager.isServerRunning(websiteName)).toBe(false);
        });
        it('should get servers by state', async () => {
            const websiteName1 = 'test-site-1';
            const websiteName2 = 'test-site-2';
            const websitePath = '/test/path';
            // Start first server successfully
            mockStartWebsiteServer.mockResolvedValueOnce(mockWebsiteServer);
            await serverManager.startServer(websiteName1, websitePath);
            // Make second server fail all retry attempts
            const error = new Error('Failed');
            mockStartWebsiteServer.mockRejectedValueOnce(error).mockRejectedValueOnce(error).mockRejectedValueOnce(error);
            try {
                await serverManager.startServer(websiteName2, websitePath);
            }
            catch {
                // Expected to fail
            }
            const runningServers = serverManager.getServersByState(website_server_manager_1.ServerState.RUNNING);
            const errorServers = serverManager.getServersByState(website_server_manager_1.ServerState.ERROR);
            expect(runningServers).toHaveLength(1);
            expect(runningServers[0].websiteName).toBe(websiteName1);
            expect(errorServers).toHaveLength(1);
            expect(errorServers[0].websiteName).toBe(websiteName2);
        }, 10000); // Increase timeout
    });
    describe('stopAllServers', () => {
        it('should stop all running servers', async () => {
            const websiteName1 = 'test-site-1';
            const websiteName2 = 'test-site-2';
            const websitePath = '/test/path';
            // Start multiple servers
            await serverManager.startServer(websiteName1, websitePath);
            await serverManager.startServer(websiteName2, websitePath);
            expect(serverManager.getRunningServersCount()).toBe(2);
            // Stop all servers
            await serverManager.stopAllServers();
            expect(serverManager.getRunningServersCount()).toBe(0);
            expect(serverManager.getAllServers().size).toBe(0);
        });
    });
    describe('statistics', () => {
        it('should provide accurate statistics', async () => {
            const websiteName1 = 'test-site-1';
            const websiteName2 = 'test-site-2';
            const websitePath = '/test/path';
            // Start servers
            await serverManager.startServer(websiteName1, websitePath);
            await serverManager.startServer(websiteName2, websitePath);
            const stats = serverManager.getStatistics();
            expect(stats.totalServers).toBe(2);
            expect(stats.runningServers).toBe(2);
            expect(stats.stoppedServers).toBe(0);
            expect(stats.errorServers).toBe(0);
            expect(stats.allocatedPorts).toEqual([9000, 9001]);
            expect(Object.keys(stats.uptime)).toHaveLength(2);
        });
    });
    describe('event emission', () => {
        it('should emit server lifecycle events', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            const events = [];
            serverManager.on('server-starting', () => events.push('starting'));
            serverManager.on('server-started', () => events.push('started'));
            serverManager.on('server-stopping', () => events.push('stopping'));
            serverManager.on('server-stopped', () => events.push('stopped'));
            // Start and stop server
            await serverManager.startServer(websiteName, websitePath);
            await serverManager.stopServer(websiteName);
            expect(events).toEqual(['starting', 'started', 'stopping', 'stopped']);
        });
        it('should emit error events on failure', async () => {
            const websiteName = 'test-site';
            const websitePath = '/test/path';
            const error = new Error('Server start failed');
            let emittedError = null;
            // Mock all retry attempts to fail
            mockStartWebsiteServer.mockRejectedValueOnce(error).mockRejectedValueOnce(error).mockRejectedValueOnce(error);
            serverManager.on('server-error', (name, err) => {
                emittedError = err;
            });
            try {
                await serverManager.startServer(websiteName, websitePath);
            }
            catch {
                // Expected to fail
            }
            expect(emittedError).toBeTruthy();
            expect(emittedError.message).toBe('Server start failed');
        }, 15000); // Increase timeout for retries
    });
    describe('deprecated singleton instance', () => {
        it('should export a deprecated singleton that throws errors', () => {
            expect(website_server_manager_1.websiteServerManager).toBeInstanceOf(Object);
            expect(() => website_server_manager_1.websiteServerManager.startServer()).toThrow('websiteServerManager is deprecated. Use DI container instead.');
            expect(() => website_server_manager_1.websiteServerManager.stopServer()).toThrow('websiteServerManager is deprecated. Use DI container instead.');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L3NlcnZlci93ZWJzaXRlLXNlcnZlci1tYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFNQSxxQ0FBcUM7QUFDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDN0IsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUM3QixDQUFDLENBQUMsQ0FBQztBQVZKOztHQUVHO0FBQ0gsb0ZBQWtIO0FBU2xILE1BQU0sc0JBQXNCLEdBQUcsT0FBTyxDQUFDLHFDQUFxQyxDQUFDLENBQUMsa0JBQWtCLENBQUM7QUFDakcsTUFBTSxxQkFBcUIsR0FBRyxPQUFPLENBQUMscUNBQXFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQztBQVkvRixRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBQ3BDLElBQUksYUFBbUMsQ0FBQztJQUN4QyxJQUFJLGlCQUFvQyxDQUFDO0lBQ3pDLElBQUksVUFBbUIsQ0FBQztJQUN4QixJQUFJLGNBQTJCLENBQUM7SUFFaEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLDJCQUEyQjtRQUMzQixVQUFVLEdBQUc7WUFDWCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGNBQWMsRUFBRTtZQUNqQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNmLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDakIsQ0FBQztRQUVGLGNBQWMsR0FBRztZQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQztZ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QixFQUFFLEdBQUcsRUFBRTtRQUM3QyxFQUFFLENBQUMseURBQXlELEVBQUUsR0FBRyxFQUFFO1lBQ2pFLE1BQU0sQ0FBQyw2Q0FBb0IsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwRCxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsNkNBQW9CLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQ3RELCtEQUErRCxDQUNoRSxDQUFDO1lBQ0YsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLDZDQUFvQixDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUNyRCwrREFBK0QsQ0FDaEUsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZHdrL0RldmVsb3Blci9naXRsYWIuY29tL2Rhdmlkd2tlaXRoL0Bkd2svYW5nbGVzaXRlL3Rlc3Qvc2VydmVyL3dlYnNpdGUtc2VydmVyLW1hbmFnZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIFVuaXQgdGVzdHMgZm9yIFdlYnNpdGVTZXJ2ZXJNYW5hZ2VyXG4gKi9cbmltcG9ydCB7IFdlYnNpdGVTZXJ2ZXJNYW5hZ2VyLCBTZXJ2ZXJTdGF0ZSwgd2Vic2l0ZVNlcnZlck1hbmFnZXIgfSBmcm9tICcuLi8uLi9hcHAvc2VydmVyL3dlYnNpdGUtc2VydmVyLW1hbmFnZXInO1xuaW1wb3J0IHsgSUxvZ2dlciwgSUZpbGVTeXN0ZW0gfSBmcm9tICcuLi8uLi9hcHAvY29yZS9pbnRlcmZhY2VzJztcblxuLy8gTW9jayB0aGUgcGVyLXdlYnNpdGUtc2VydmVyIG1vZHVsZVxuamVzdC5tb2NrKCcuLi8uLi9hcHAvc2VydmVyL3Blci13ZWJzaXRlLXNlcnZlcicsICgpID0+ICh7XG4gIHN0YXJ0V2Vic2l0ZVNlcnZlcjogamVzdC5mbigpLFxuICBzdG9wV2Vic2l0ZVNlcnZlcjogamVzdC5mbigpLFxufSkpO1xuXG5jb25zdCBtb2NrU3RhcnRXZWJzaXRlU2VydmVyID0gcmVxdWlyZSgnLi4vLi4vYXBwL3NlcnZlci9wZXItd2Vic2l0ZS1zZXJ2ZXInKS5zdGFydFdlYnNpdGVTZXJ2ZXI7XG5jb25zdCBtb2NrU3RvcFdlYnNpdGVTZXJ2ZXIgPSByZXF1aXJlKCcuLi8uLi9hcHAvc2VydmVyL3Blci13ZWJzaXRlLXNlcnZlcicpLnN0b3BXZWJzaXRlU2VydmVyO1xuXG5pbnRlcmZhY2UgTW9ja1dlYnNpdGVTZXJ2ZXIge1xuICBkZXZTZXJ2ZXI6IHsgd2F0Y2hlcjogeyBjbG9zZTogamVzdC5Nb2NrIH07IGNsb3NlOiBqZXN0Lk1vY2sgfTtcbiAgaW5wdXREaXI6IHN0cmluZztcbiAgb3V0cHV0RGlyOiBzdHJpbmc7XG4gIHBvcnQ6IG51bWJlcjtcbiAgYWN0dWFsVXJsPzogc3RyaW5nO1xuICB1cmxSZXNvbHZlcjogdW5rbm93bjtcbiAgcmVzdG9yZUNvbnNvbGU/OiAoKSA9PiB2b2lkO1xufVxuXG5kZXNjcmliZSgnV2Vic2l0ZVNlcnZlck1hbmFnZXInLCAoKSA9PiB7XG4gIGxldCBzZXJ2ZXJNYW5hZ2VyOiBXZWJzaXRlU2VydmVyTWFuYWdlcjtcbiAgbGV0IG1vY2tXZWJzaXRlU2VydmVyOiBNb2NrV2Vic2l0ZVNlcnZlcjtcbiAgbGV0IG1vY2tMb2dnZXI6IElMb2dnZXI7XG4gIGxldCBtb2NrRmlsZVN5c3RlbTogSUZpbGVTeXN0ZW07XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIG1vY2sgZGVwZW5kZW5jaWVzXG4gICAgbW9ja0xvZ2dlciA9IHtcbiAgICAgIGNoaWxkOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGRlYnVnOiBqZXN0LmZuKCksXG4gICAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgICB3YXJuOiBqZXN0LmZuKCksXG4gICAgICBlcnJvcjogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBtb2NrRmlsZVN5c3RlbSA9IHtcbiAgICAgIGV4aXN0czogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgICAgIHJlYWRGaWxlOiBqZXN0LmZuKCksXG4gICAgICB3cml0ZUZpbGU6IGplc3QuZm4oKSxcbiAgICAgIG1rZGlyOiBqZXN0LmZuKCksXG4gICAgICByZWFkZGlyOiBqZXN0LmZuKCksXG4gICAgICBybWRpcjogamVzdC5mbigpLFxuICAgICAgY29weUZpbGU6IGplc3QuZm4oKSxcbiAgICAgIHJlbmFtZTogamVzdC5mbigpLFxuICAgICAgc3RhdDogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICAvLyBDcmVhdGUgYSBuZXcgc2VydmVyIG1hbmFnZXIgaW5zdGFuY2UgZm9yIGVhY2ggdGVzdFxuICAgIHNlcnZlck1hbmFnZXIgPSBuZXcgV2Vic2l0ZVNlcnZlck1hbmFnZXIobW9ja0xvZ2dlciwgbW9ja0ZpbGVTeXN0ZW0sIHtcbiAgICAgIHN0YXJ0UG9ydDogOTAwMCxcbiAgICAgIG1heFJldHJpZXM6IDIsXG4gICAgICBzdGFydHVwVGltZW91dDogNTAwMCxcbiAgICAgIHNodXRkb3duVGltZW91dDogMzAwMCxcbiAgICAgIGVuYWJsZUxvZ2dpbmc6IGZhbHNlLCAvLyBEaXNhYmxlIGxvZ2dpbmcgZm9yIHRlc3RzXG4gICAgfSk7XG5cbiAgICAvLyBNb2NrIHdlYnNpdGUgc2VydmVyIG9iamVjdFxuICAgIG1vY2tXZWJzaXRlU2VydmVyID0ge1xuICAgICAgZGV2U2VydmVyOiB7IHdhdGNoZXI6IHsgY2xvc2U6IGplc3QuZm4oKSB9LCBjbG9zZTogamVzdC5mbigpIH0sXG4gICAgICBpbnB1dERpcjogJy90ZXN0L3BhdGgvc3JjJyxcbiAgICAgIG91dHB1dERpcjogJy90ZXN0L3BhdGgvX3NpdGUnLFxuICAgICAgcG9ydDogOTAwMCxcbiAgICAgIGFjdHVhbFVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6OTAwMCcsXG4gICAgICB1cmxSZXNvbHZlcjoge30sXG4gICAgICByZXN0b3JlQ29uc29sZTogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICAvLyBSZXNldCBtb2Nrc1xuICAgIG1vY2tTdGFydFdlYnNpdGVTZXJ2ZXIubW9ja0NsZWFyKCk7XG4gICAgbW9ja1N0b3BXZWJzaXRlU2VydmVyLm1vY2tDbGVhcigpO1xuICAgIG1vY2tTdGFydFdlYnNpdGVTZXJ2ZXIubW9ja1Jlc29sdmVkVmFsdWUobW9ja1dlYnNpdGVTZXJ2ZXIpO1xuICAgIG1vY2tTdG9wV2Vic2l0ZVNlcnZlci5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgLy8gUmVzZXQgZmlsZSBzeXN0ZW0gbW9ja1xuICAgIChtb2NrRmlsZVN5c3RlbS5leGlzdHMgYXMgamVzdC5Nb2NrKS5tb2NrQ2xlYXIoKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgc2VydmVyIG1hbmFnZXJcbiAgICByZXR1cm4gc2VydmVyTWFuYWdlci5zdG9wQWxsU2VydmVycygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RhcnRTZXJ2ZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzdGFydCBhIHNlcnZlciBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJzaXRlTmFtZSA9ICd0ZXN0LXNpdGUnO1xuICAgICAgY29uc3Qgd2Vic2l0ZVBhdGggPSAnL3Rlc3QvcGF0aCc7XG5cbiAgICAgIGNvbnN0IHNlcnZlckluZm8gPSBhd2FpdCBzZXJ2ZXJNYW5hZ2VyLnN0YXJ0U2VydmVyKHdlYnNpdGVOYW1lLCB3ZWJzaXRlUGF0aCk7XG5cbiAgICAgIGV4cGVjdChzZXJ2ZXJJbmZvLm5hbWUpLnRvQmUod2Vic2l0ZU5hbWUpO1xuICAgICAgZXhwZWN0KHNlcnZlckluZm8uc3RhdHVzKS50b0JlKCdydW5uaW5nJyk7XG4gICAgICBleHBlY3Qoc2VydmVySW5mby5wb3J0KS50b0JlKDkwMDApO1xuICAgICAgZXhwZWN0KHNlcnZlckluZm8udXJsKS50b0JlKCdodHRwOi8vbG9jYWxob3N0OjkwMDAnKTtcbiAgICAgIGV4cGVjdChtb2NrU3RhcnRXZWJzaXRlU2VydmVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh3ZWJzaXRlUGF0aCwgd2Vic2l0ZU5hbWUsIDkwMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZXhpc3RpbmcgcnVubmluZyBzZXJ2ZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJzaXRlTmFtZSA9ICd0ZXN0LXNpdGUnO1xuICAgICAgY29uc3Qgd2Vic2l0ZVBhdGggPSAnL3Rlc3QvcGF0aCc7XG5cbiAgICAgIC8vIFN0YXJ0IHNlcnZlciBmaXJzdCB0aW1lXG4gICAgICBjb25zdCBtYW5hZ2VkU2VydmVyMSA9IGF3YWl0IHNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIod2Vic2l0ZU5hbWUsIHdlYnNpdGVQYXRoKTtcblxuICAgICAgLy8gVHJ5IHRvIHN0YXJ0IGFnYWluXG4gICAgICBjb25zdCBtYW5hZ2VkU2VydmVyMiA9IGF3YWl0IHNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIod2Vic2l0ZU5hbWUsIHdlYnNpdGVQYXRoKTtcblxuICAgICAgZXhwZWN0KG1hbmFnZWRTZXJ2ZXIxKS50b1N0cmljdEVxdWFsKG1hbmFnZWRTZXJ2ZXIyKTtcbiAgICAgIGV4cGVjdChtb2NrU3RhcnRXZWJzaXRlU2VydmVyKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2ZXIgc3RhcnQgZmFpbHVyZSB3aXRoIHJldHJpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJzaXRlTmFtZSA9ICd0ZXN0LXNpdGUnO1xuICAgICAgY29uc3Qgd2Vic2l0ZVBhdGggPSAnL3Rlc3QvcGF0aCc7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignU2VydmVyIHN0YXJ0IGZhaWxlZCcpO1xuXG4gICAgICAvLyBNb2NrIGNvbnNlY3V0aXZlIGZhaWx1cmVzIGZvciBpbml0aWFsICsgcmV0cmllc1xuICAgICAgbW9ja1N0YXJ0V2Vic2l0ZVNlcnZlci5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UoZXJyb3IpLm1vY2tSZWplY3RlZFZhbHVlT25jZShlcnJvcikubW9ja1JlamVjdGVkVmFsdWVPbmNlKGVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIod2Vic2l0ZU5hbWUsIHdlYnNpdGVQYXRoKSkucmVqZWN0cy50b1Rocm93KCdTZXJ2ZXIgc3RhcnQgZmFpbGVkJyk7XG5cbiAgICAgIC8vIFNob3VsZCBoYXZlIHRyaWVkIG1heFJldHJpZXMgKyAxIHRpbWVzIChpbml0aWFsICsgcmV0cmllcylcbiAgICAgIGV4cGVjdChtb2NrU3RhcnRXZWJzaXRlU2VydmVyKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XG5cbiAgICAgIGNvbnN0IG1hbmFnZWRTZXJ2ZXIgPSBzZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcih3ZWJzaXRlTmFtZSk7XG4gICAgICBleHBlY3QobWFuYWdlZFNlcnZlcj8uc3RhdGUpLnRvQmUoU2VydmVyU3RhdGUuRVJST1IpO1xuICAgICAgZXhwZWN0KG1hbmFnZWRTZXJ2ZXI/Lmxhc3RFcnJvcj8ubWVzc2FnZSkudG9CZSgnU2VydmVyIHN0YXJ0IGZhaWxlZCcpO1xuICAgIH0sIDE1MDAwKTsgLy8gSW5jcmVhc2UgdGltZW91dCBmb3IgcmV0cmllc1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB3ZWJzaXRlIHBhdGggYmVmb3JlIHN0YXJ0aW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2Vic2l0ZU5hbWUgPSAndGVzdC1zaXRlJztcbiAgICAgIGNvbnN0IHdlYnNpdGVQYXRoID0gJy9pbnZhbGlkL3BhdGgnO1xuXG4gICAgICAvLyBNb2NrIGZpbGUgc3lzdGVtIHRvIHJldHVybiBmYWxzZSBmb3IgcGF0aCB2YWxpZGF0aW9uXG4gICAgICAobW9ja0ZpbGVTeXN0ZW0uZXhpc3RzIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIod2Vic2l0ZU5hbWUsIHdlYnNpdGVQYXRoKSkucmVqZWN0cy50b1Rocm93KCdJbnZhbGlkIHdlYnNpdGUgcGF0aCcpO1xuICAgICAgZXhwZWN0KG1vY2tTdGFydFdlYnNpdGVTZXJ2ZXIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdG9wU2VydmVyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3RvcCBhIHJ1bm5pbmcgc2VydmVyIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHdlYnNpdGVOYW1lID0gJ3Rlc3Qtc2l0ZSc7XG4gICAgICBjb25zdCB3ZWJzaXRlUGF0aCA9ICcvdGVzdC9wYXRoJztcblxuICAgICAgLy8gU3RhcnQgc2VydmVyIGZpcnN0XG4gICAgICBhd2FpdCBzZXJ2ZXJNYW5hZ2VyLnN0YXJ0U2VydmVyKHdlYnNpdGVOYW1lLCB3ZWJzaXRlUGF0aCk7XG5cbiAgICAgIC8vIFN0b3AgdGhlIHNlcnZlclxuICAgICAgYXdhaXQgc2VydmVyTWFuYWdlci5zdG9wU2VydmVyKHdlYnNpdGVOYW1lKTtcblxuICAgICAgY29uc3QgbWFuYWdlZFNlcnZlciA9IHNlcnZlck1hbmFnZXIuZ2V0U2VydmVyKHdlYnNpdGVOYW1lKTtcbiAgICAgIGV4cGVjdChtYW5hZ2VkU2VydmVyPy5zdGF0ZSkudG9CZShTZXJ2ZXJTdGF0ZS5TVE9QUEVEKTtcbiAgICAgIGV4cGVjdChtYW5hZ2VkU2VydmVyPy5zZXJ2ZXIpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU3RvcFdlYnNpdGVTZXJ2ZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tXZWJzaXRlU2VydmVyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHN0b3BwaW5nIG5vbi1leGlzdGVudCBzZXJ2ZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTaG91bGQgbm90IHRocm93IGVycm9yXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmVyTWFuYWdlci5zdG9wU2VydmVyKCdub24tZXhpc3RlbnQnKSkucmVzb2x2ZXMudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmVyIHN0b3AgZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHdlYnNpdGVOYW1lID0gJ3Rlc3Qtc2l0ZSc7XG4gICAgICBjb25zdCB3ZWJzaXRlUGF0aCA9ICcvdGVzdC9wYXRoJztcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdTZXJ2ZXIgc3RvcCBmYWlsZWQnKTtcblxuICAgICAgbW9ja1N0b3BXZWJzaXRlU2VydmVyLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgLy8gU3RhcnQgc2VydmVyIGZpcnN0XG4gICAgICBhd2FpdCBzZXJ2ZXJNYW5hZ2VyLnN0YXJ0U2VydmVyKHdlYnNpdGVOYW1lLCB3ZWJzaXRlUGF0aCk7XG5cbiAgICAgIC8vIFN0b3Agc2hvdWxkIG5vdCB0aHJvdyBidXQgc2VydmVyIHNob3VsZCBiZSBpbiBlcnJvciBzdGF0ZVxuICAgICAgYXdhaXQgc2VydmVyTWFuYWdlci5zdG9wU2VydmVyKHdlYnNpdGVOYW1lKTtcblxuICAgICAgY29uc3QgbWFuYWdlZFNlcnZlciA9IHNlcnZlck1hbmFnZXIuZ2V0U2VydmVyKHdlYnNpdGVOYW1lKTtcbiAgICAgIGV4cGVjdChtYW5hZ2VkU2VydmVyPy5zdGF0ZSkudG9CZShTZXJ2ZXJTdGF0ZS5FUlJPUik7XG4gICAgICBleHBlY3QobWFuYWdlZFNlcnZlcj8ubGFzdEVycm9yPy5tZXNzYWdlKS50b0JlKCdTZXJ2ZXIgc3RvcCBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Jlc3RhcnRTZXJ2ZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXN0YXJ0IGEgc2VydmVyIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHdlYnNpdGVOYW1lID0gJ3Rlc3Qtc2l0ZSc7XG4gICAgICBjb25zdCB3ZWJzaXRlUGF0aCA9ICcvdGVzdC9wYXRoJztcblxuICAgICAgLy8gU3RhcnQgc2VydmVyIGZpcnN0XG4gICAgICBhd2FpdCBzZXJ2ZXJNYW5hZ2VyLnN0YXJ0U2VydmVyKHdlYnNpdGVOYW1lLCB3ZWJzaXRlUGF0aCk7XG5cbiAgICAgIC8vIFJlc3RhcnQgdGhlIHNlcnZlclxuICAgICAgY29uc3QgcmVzdGFydGVkU2VydmVyID0gYXdhaXQgc2VydmVyTWFuYWdlci5yZXN0YXJ0U2VydmVyKHdlYnNpdGVOYW1lKTtcblxuICAgICAgZXhwZWN0KHJlc3RhcnRlZFNlcnZlci5zdGF0dXMpLnRvQmUoJ3J1bm5pbmcnKTtcbiAgICAgIGV4cGVjdChtb2NrU3RvcFdlYnNpdGVTZXJ2ZXIpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU3RhcnRXZWJzaXRlU2VydmVyKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7IC8vIEluaXRpYWwgc3RhcnQgKyByZXN0YXJ0XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gcmVzdGFydCBub24tZXhpc3RlbnQgc2VydmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZlck1hbmFnZXIucmVzdGFydFNlcnZlcignbm9uLWV4aXN0ZW50JykpLnJlamVjdHMudG9UaHJvdygnTm8gc2VydmVyIGZvdW5kJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZXJ2ZXIgc3RhdGUgbWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRyYWNrIHNlcnZlciBzdGF0ZXMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2Vic2l0ZU5hbWUgPSAndGVzdC1zaXRlJztcbiAgICAgIGNvbnN0IHdlYnNpdGVQYXRoID0gJy90ZXN0L3BhdGgnO1xuXG4gICAgICAvLyBJbml0aWFsbHkgbm8gc2VydmVyc1xuICAgICAgZXhwZWN0KHNlcnZlck1hbmFnZXIuZ2V0UnVubmluZ1NlcnZlcnNDb3VudCgpKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHNlcnZlck1hbmFnZXIuaXNTZXJ2ZXJSdW5uaW5nKHdlYnNpdGVOYW1lKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIC8vIFN0YXJ0IHNlcnZlclxuICAgICAgYXdhaXQgc2VydmVyTWFuYWdlci5zdGFydFNlcnZlcih3ZWJzaXRlTmFtZSwgd2Vic2l0ZVBhdGgpO1xuICAgICAgZXhwZWN0KHNlcnZlck1hbmFnZXIuZ2V0UnVubmluZ1NlcnZlcnNDb3VudCgpKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHNlcnZlck1hbmFnZXIuaXNTZXJ2ZXJSdW5uaW5nKHdlYnNpdGVOYW1lKSkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gU3RvcCBzZXJ2ZXJcbiAgICAgIGF3YWl0IHNlcnZlck1hbmFnZXIuc3RvcFNlcnZlcih3ZWJzaXRlTmFtZSk7XG4gICAgICBleHBlY3Qoc2VydmVyTWFuYWdlci5nZXRSdW5uaW5nU2VydmVyc0NvdW50KCkpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc2VydmVyTWFuYWdlci5pc1NlcnZlclJ1bm5pbmcod2Vic2l0ZU5hbWUpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IHNlcnZlcnMgYnkgc3RhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJzaXRlTmFtZTEgPSAndGVzdC1zaXRlLTEnO1xuICAgICAgY29uc3Qgd2Vic2l0ZU5hbWUyID0gJ3Rlc3Qtc2l0ZS0yJztcbiAgICAgIGNvbnN0IHdlYnNpdGVQYXRoID0gJy90ZXN0L3BhdGgnO1xuXG4gICAgICAvLyBTdGFydCBmaXJzdCBzZXJ2ZXIgc3VjY2Vzc2Z1bGx5XG4gICAgICBtb2NrU3RhcnRXZWJzaXRlU2VydmVyLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrV2Vic2l0ZVNlcnZlcik7XG4gICAgICBhd2FpdCBzZXJ2ZXJNYW5hZ2VyLnN0YXJ0U2VydmVyKHdlYnNpdGVOYW1lMSwgd2Vic2l0ZVBhdGgpO1xuXG4gICAgICAvLyBNYWtlIHNlY29uZCBzZXJ2ZXIgZmFpbCBhbGwgcmV0cnkgYXR0ZW1wdHNcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdGYWlsZWQnKTtcbiAgICAgIG1vY2tTdGFydFdlYnNpdGVTZXJ2ZXIubW9ja1JlamVjdGVkVmFsdWVPbmNlKGVycm9yKS5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UoZXJyb3IpLm1vY2tSZWplY3RlZFZhbHVlT25jZShlcnJvcik7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIod2Vic2l0ZU5hbWUyLCB3ZWJzaXRlUGF0aCk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gRXhwZWN0ZWQgdG8gZmFpbFxuICAgICAgfVxuXG4gICAgICBjb25zdCBydW5uaW5nU2VydmVycyA9IHNlcnZlck1hbmFnZXIuZ2V0U2VydmVyc0J5U3RhdGUoU2VydmVyU3RhdGUuUlVOTklORyk7XG4gICAgICBjb25zdCBlcnJvclNlcnZlcnMgPSBzZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcnNCeVN0YXRlKFNlcnZlclN0YXRlLkVSUk9SKTtcblxuICAgICAgZXhwZWN0KHJ1bm5pbmdTZXJ2ZXJzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocnVubmluZ1NlcnZlcnNbMF0ud2Vic2l0ZU5hbWUpLnRvQmUod2Vic2l0ZU5hbWUxKTtcbiAgICAgIGV4cGVjdChlcnJvclNlcnZlcnMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChlcnJvclNlcnZlcnNbMF0ud2Vic2l0ZU5hbWUpLnRvQmUod2Vic2l0ZU5hbWUyKTtcbiAgICB9LCAxMDAwMCk7IC8vIEluY3JlYXNlIHRpbWVvdXRcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0b3BBbGxTZXJ2ZXJzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3RvcCBhbGwgcnVubmluZyBzZXJ2ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2Vic2l0ZU5hbWUxID0gJ3Rlc3Qtc2l0ZS0xJztcbiAgICAgIGNvbnN0IHdlYnNpdGVOYW1lMiA9ICd0ZXN0LXNpdGUtMic7XG4gICAgICBjb25zdCB3ZWJzaXRlUGF0aCA9ICcvdGVzdC9wYXRoJztcblxuICAgICAgLy8gU3RhcnQgbXVsdGlwbGUgc2VydmVyc1xuICAgICAgYXdhaXQgc2VydmVyTWFuYWdlci5zdGFydFNlcnZlcih3ZWJzaXRlTmFtZTEsIHdlYnNpdGVQYXRoKTtcbiAgICAgIGF3YWl0IHNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIod2Vic2l0ZU5hbWUyLCB3ZWJzaXRlUGF0aCk7XG5cbiAgICAgIGV4cGVjdChzZXJ2ZXJNYW5hZ2VyLmdldFJ1bm5pbmdTZXJ2ZXJzQ291bnQoKSkudG9CZSgyKTtcblxuICAgICAgLy8gU3RvcCBhbGwgc2VydmVyc1xuICAgICAgYXdhaXQgc2VydmVyTWFuYWdlci5zdG9wQWxsU2VydmVycygpO1xuXG4gICAgICBleHBlY3Qoc2VydmVyTWFuYWdlci5nZXRSdW5uaW5nU2VydmVyc0NvdW50KCkpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc2VydmVyTWFuYWdlci5nZXRBbGxTZXJ2ZXJzKCkuc2l6ZSkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGFjY3VyYXRlIHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJzaXRlTmFtZTEgPSAndGVzdC1zaXRlLTEnO1xuICAgICAgY29uc3Qgd2Vic2l0ZU5hbWUyID0gJ3Rlc3Qtc2l0ZS0yJztcbiAgICAgIGNvbnN0IHdlYnNpdGVQYXRoID0gJy90ZXN0L3BhdGgnO1xuXG4gICAgICAvLyBTdGFydCBzZXJ2ZXJzXG4gICAgICBhd2FpdCBzZXJ2ZXJNYW5hZ2VyLnN0YXJ0U2VydmVyKHdlYnNpdGVOYW1lMSwgd2Vic2l0ZVBhdGgpO1xuICAgICAgYXdhaXQgc2VydmVyTWFuYWdlci5zdGFydFNlcnZlcih3ZWJzaXRlTmFtZTIsIHdlYnNpdGVQYXRoKTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2ZXJNYW5hZ2VyLmdldFN0YXRpc3RpY3MoKTtcblxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsU2VydmVycykudG9CZSgyKTtcbiAgICAgIGV4cGVjdChzdGF0cy5ydW5uaW5nU2VydmVycykudG9CZSgyKTtcbiAgICAgIGV4cGVjdChzdGF0cy5zdG9wcGVkU2VydmVycykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdGF0cy5lcnJvclNlcnZlcnMpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuYWxsb2NhdGVkUG9ydHMpLnRvRXF1YWwoWzkwMDAsIDkwMDFdKTtcbiAgICAgIGV4cGVjdChPYmplY3Qua2V5cyhzdGF0cy51cHRpbWUpKS50b0hhdmVMZW5ndGgoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmVudCBlbWlzc2lvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVtaXQgc2VydmVyIGxpZmVjeWNsZSBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJzaXRlTmFtZSA9ICd0ZXN0LXNpdGUnO1xuICAgICAgY29uc3Qgd2Vic2l0ZVBhdGggPSAnL3Rlc3QvcGF0aCc7XG4gICAgICBjb25zdCBldmVudHM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgIHNlcnZlck1hbmFnZXIub24oJ3NlcnZlci1zdGFydGluZycsICgpID0+IGV2ZW50cy5wdXNoKCdzdGFydGluZycpKTtcbiAgICAgIHNlcnZlck1hbmFnZXIub24oJ3NlcnZlci1zdGFydGVkJywgKCkgPT4gZXZlbnRzLnB1c2goJ3N0YXJ0ZWQnKSk7XG4gICAgICBzZXJ2ZXJNYW5hZ2VyLm9uKCdzZXJ2ZXItc3RvcHBpbmcnLCAoKSA9PiBldmVudHMucHVzaCgnc3RvcHBpbmcnKSk7XG4gICAgICBzZXJ2ZXJNYW5hZ2VyLm9uKCdzZXJ2ZXItc3RvcHBlZCcsICgpID0+IGV2ZW50cy5wdXNoKCdzdG9wcGVkJykpO1xuXG4gICAgICAvLyBTdGFydCBhbmQgc3RvcCBzZXJ2ZXJcbiAgICAgIGF3YWl0IHNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIod2Vic2l0ZU5hbWUsIHdlYnNpdGVQYXRoKTtcbiAgICAgIGF3YWl0IHNlcnZlck1hbmFnZXIuc3RvcFNlcnZlcih3ZWJzaXRlTmFtZSk7XG5cbiAgICAgIGV4cGVjdChldmVudHMpLnRvRXF1YWwoWydzdGFydGluZycsICdzdGFydGVkJywgJ3N0b3BwaW5nJywgJ3N0b3BwZWQnXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVtaXQgZXJyb3IgZXZlbnRzIG9uIGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWJzaXRlTmFtZSA9ICd0ZXN0LXNpdGUnO1xuICAgICAgY29uc3Qgd2Vic2l0ZVBhdGggPSAnL3Rlc3QvcGF0aCc7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignU2VydmVyIHN0YXJ0IGZhaWxlZCcpO1xuICAgICAgbGV0IGVtaXR0ZWRFcnJvcjogRXJyb3IgfCBudWxsID0gbnVsbDtcblxuICAgICAgLy8gTW9jayBhbGwgcmV0cnkgYXR0ZW1wdHMgdG8gZmFpbFxuICAgICAgbW9ja1N0YXJ0V2Vic2l0ZVNlcnZlci5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UoZXJyb3IpLm1vY2tSZWplY3RlZFZhbHVlT25jZShlcnJvcikubW9ja1JlamVjdGVkVmFsdWVPbmNlKGVycm9yKTtcblxuICAgICAgc2VydmVyTWFuYWdlci5vbignc2VydmVyLWVycm9yJywgKG5hbWUsIGVycikgPT4ge1xuICAgICAgICBlbWl0dGVkRXJyb3IgPSBlcnI7XG4gICAgICB9KTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgc2VydmVyTWFuYWdlci5zdGFydFNlcnZlcih3ZWJzaXRlTmFtZSwgd2Vic2l0ZVBhdGgpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIEV4cGVjdGVkIHRvIGZhaWxcbiAgICAgIH1cblxuICAgICAgZXhwZWN0KGVtaXR0ZWRFcnJvcikudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KGVtaXR0ZWRFcnJvciEubWVzc2FnZSkudG9CZSgnU2VydmVyIHN0YXJ0IGZhaWxlZCcpO1xuICAgIH0sIDE1MDAwKTsgLy8gSW5jcmVhc2UgdGltZW91dCBmb3IgcmV0cmllc1xuICB9KTtcblxuICBkZXNjcmliZSgnZGVwcmVjYXRlZCBzaW5nbGV0b24gaW5zdGFuY2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgYSBkZXByZWNhdGVkIHNpbmdsZXRvbiB0aGF0IHRocm93cyBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3Qod2Vic2l0ZVNlcnZlck1hbmFnZXIpLnRvQmVJbnN0YW5jZU9mKE9iamVjdCk7XG4gICAgICBleHBlY3QoKCkgPT4gd2Vic2l0ZVNlcnZlck1hbmFnZXIuc3RhcnRTZXJ2ZXIoKSkudG9UaHJvdyhcbiAgICAgICAgJ3dlYnNpdGVTZXJ2ZXJNYW5hZ2VyIGlzIGRlcHJlY2F0ZWQuIFVzZSBESSBjb250YWluZXIgaW5zdGVhZC4nXG4gICAgICApO1xuICAgICAgZXhwZWN0KCgpID0+IHdlYnNpdGVTZXJ2ZXJNYW5hZ2VyLnN0b3BTZXJ2ZXIoKSkudG9UaHJvdyhcbiAgICAgICAgJ3dlYnNpdGVTZXJ2ZXJNYW5hZ2VyIGlzIGRlcHJlY2F0ZWQuIFVzZSBESSBjb250YWluZXIgaW5zdGVhZC4nXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9