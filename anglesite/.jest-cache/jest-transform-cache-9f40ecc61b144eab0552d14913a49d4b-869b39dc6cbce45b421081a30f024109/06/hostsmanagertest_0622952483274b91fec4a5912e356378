e75952ba9b5e71d3b521b670f420d915
"use strict";
/**
 * @file Tests for DNS hosts file management with sudo-prompt and Touch ID support
 */
// Set up mocks before importing the module
jest.mock('sudo-prompt', () => mockSudoPrompt);
jest.mock('native-is-elevated', () => mockIsElevated);
jest.mock('child_process', () => ({
    exec: mockExec,
    execFile: mockExecFile,
}));
jest.mock('util', () => ({
    promisify: mockPromisify,
}));
jest.mock('fs', () => mockFs);
jest.mock('hostile', () => mockHostile);
jest.mock('electron', () => ({
    dialog: mockDialog,
}));
// Mock website-manager
jest.mock('../../app/utils/website-manager', () => ({
    listWebsites: jest.fn(() => ['test-site', 'my-website']),
}));
// Mock sudo-prompt before importing the module
const mockSudoPrompt = {
    exec: jest.fn(),
};
// Mock native-is-elevated
const mockIsElevated = jest.fn();
// Mock child_process
const mockExec = jest.fn();
const mockExecFile = jest.fn();
// Import the actual functions to compare against
const { execFile: realExecFile } = require('child_process');
const mockPromisify = jest.fn((fn) => {
    // Check if the function is execFile by direct reference comparison
    if (fn === realExecFile)
        return mockExecFile;
    return mockExec;
});
// Mock fs for file operations
const mockFs = {
    existsSync: jest.fn(),
    readFileSync: jest.fn(),
    writeFileSync: jest.fn(),
};
// Mock hostile library
const mockHostile = {
    get: jest.fn(),
    set: jest.fn(),
    remove: jest.fn(),
};
// Mock dialog
const mockDialog = {
    showMessageBox: jest.fn(),
};
describe('DNS Hosts Manager', () => {
    let hostsManager;
    beforeAll(() => {
        // Import the module after mocks are set up
        hostsManager = require('../../app/dns/hosts-manager');
    });
    beforeEach(() => {
        // Reset all mocks
        jest.clearAllMocks();
        // Set default mock implementations
        mockIsElevated.mockResolvedValue(false);
        mockExec.mockResolvedValue({ stdout: '0', stderr: '' });
        mockExecFile.mockResolvedValue({ stdout: '0', stderr: '' });
        mockHostile.get.mockImplementation((_flag, callback) => {
            callback(null, [
                ['127.0.0.1', 'localhost'],
                ['127.0.0.1', 'anglesite.test'],
                ['127.0.0.1', 'test-site.test'],
            ]);
        });
        mockSudoPrompt.exec.mockImplementation((command, options, callback) => {
            callback(null, 'success', '');
        });
    });
    describe('Touch ID Detection', () => {
        it('should detect Touch ID availability on macOS', async () => {
            // Mock platform detection
            Object.defineProperty(process, 'platform', {
                value: 'darwin',
                configurable: true,
            });
            // Mock Touch ID configured and hardware available
            mockExecFile
                .mockResolvedValueOnce({ stdout: '1' }) // pam_tid.so configured
                .mockResolvedValueOnce({ stdout: 'Touch ID available' }); // Touch ID hardware available
            await hostsManager.checkAndSuggestTouchIdSetup();
            expect(mockExecFile).toHaveBeenCalledWith('grep', ['-c', 'pam_tid.so', '/etc/pam.d/sudo']);
            expect(mockExecFile).toHaveBeenCalledWith('bioutil', ['-r']);
        });
        it('should suggest Touch ID setup when hardware available but not configured', async () => {
            Object.defineProperty(process, 'platform', {
                value: 'darwin',
                configurable: true,
            });
            // Mock Touch ID hardware available but not configured
            // First, for isTouchIdAvailable check (returns false - not configured)
            mockExec
                .mockResolvedValueOnce({ stdout: '0' }) // pam_tid.so not configured
                .mockResolvedValueOnce({ stdout: '1' }) // Touch ID hardware available
                // Then for canEnableTouchId check (returns true - can be enabled)
                .mockResolvedValueOnce({ stdout: '1' }) // Touch ID hardware available
                .mockResolvedValueOnce({ stdout: '0' }); // pam_tid.so not configured
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            await hostsManager.checkAndSuggestTouchIdSetup();
            consoleSpy.mockRestore();
        });
        it('should confirm Touch ID is configured when available', async () => {
            Object.defineProperty(process, 'platform', {
                value: 'darwin',
                configurable: true,
            });
            // Mock Touch ID configured and hardware available
            mockExec
                .mockResolvedValueOnce({ stdout: '1' }) // pam_tid.so configured
                .mockResolvedValueOnce({ stdout: '1' }); // Touch ID hardware available
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            await hostsManager.checkAndSuggestTouchIdSetup();
            consoleSpy.mockRestore();
        });
        it('should skip Touch ID checks on non-macOS platforms', async () => {
            Object.defineProperty(process, 'platform', {
                value: 'linux',
                configurable: true,
            });
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            await hostsManager.checkAndSuggestTouchIdSetup();
            expect(mockExec).not.toHaveBeenCalled();
            consoleSpy.mockRestore();
        });
    });
    describe('Elevated Privileges', () => {
        it('should run commands directly when already elevated', async () => {
            mockIsElevated.mockResolvedValue(true);
            mockExec.mockResolvedValue({ stdout: 'success' });
            // Access the private function through the module's exports
            // This is a bit hacky but necessary for testing internal functions
            const result = await hostsManager.updateHostsFile('test.test');
            expect(mockIsElevated).toHaveBeenCalled();
            expect(mockSudoPrompt.exec).not.toHaveBeenCalled();
            expect(result).toBe(true);
        });
        it('should use sudo-prompt when not elevated', async () => {
            mockIsElevated.mockResolvedValue(false);
            mockSudoPrompt.exec.mockImplementation((_command, options, callback) => {
                expect(options.name).toBe('Anglesite DNS');
                callback(null, 'success', '');
            });
            const result = await hostsManager.updateHostsFile('test.test');
            expect(mockIsElevated).toHaveBeenCalled();
            expect(mockSudoPrompt.exec).toHaveBeenCalled();
            expect(result).toBe(true);
        });
        it('should handle authentication cancellation gracefully', async () => {
            mockIsElevated.mockResolvedValue(false);
            mockSudoPrompt.exec.mockImplementation((_command, _options, callback) => {
                const error = new Error('User cancelled');
                error.code = -128;
                callback(error, null, '');
            });
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            const result = await hostsManager.updateHostsFile('test.test');
            expect(result).toBe(false);
            consoleSpy.mockRestore();
        });
        it('should log appropriate authentication method based on Touch ID availability', async () => {
            Object.defineProperty(process, 'platform', {
                value: 'darwin',
                configurable: true,
            });
            mockIsElevated.mockResolvedValue(false);
            // Mock Touch ID available
            mockExec
                .mockResolvedValueOnce({ stdout: '1' }) // pam_tid.so configured
                .mockResolvedValueOnce({ stdout: '1' }); // Touch ID hardware available
            mockSudoPrompt.exec.mockImplementation((_command, options, callback) => {
                callback(null, 'success', '');
            });
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            await hostsManager.updateHostsFile('test.test');
            consoleSpy.mockRestore();
        });
    });
    describe('Hosts File Management', () => {
        it('should add local DNS resolution for new domains', async () => {
            mockHostile.get.mockImplementation((_flag, callback) => {
                callback(null, [['127.0.0.1', 'anglesite.test']]);
            });
            await hostsManager.addLocalDnsResolution('new-site.test');
            expect(mockHostile.get).toHaveBeenCalled();
        });
        it('should skip adding domains that already exist', async () => {
            mockHostile.get.mockImplementation((_flag, callback) => {
                callback(null, [
                    ['127.0.0.1', 'anglesite.test'],
                    ['127.0.0.1', 'existing-site.test'],
                ]);
            });
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            await hostsManager.updateHostsFile('existing-site.test');
            consoleSpy.mockRestore();
        });
        it('should clean up orphaned domains', async () => {
            mockHostile.get.mockImplementation((_flag, callback) => {
                callback(null, [
                    ['127.0.0.1', '127.0.0.1 anglesite.test'],
                    ['127.0.0.1', '127.0.0.1 orphaned-site.test'], // This should be removed
                    ['127.0.0.1', '127.0.0.1 test-site.test'], // This should stay (exists in website list)
                ]);
            });
            await hostsManager.cleanupHostsFile();
            expect(mockHostile.get).toHaveBeenCalled();
        });
        it('should handle hostile library errors gracefully', async () => {
            mockHostile.get.mockImplementation((_flag, callback) => {
                callback(new Error('Failed to read hosts file'), null);
            });
            const result = await hostsManager.cleanupHostsFile();
            expect(result).toBe(false);
        });
    });
    describe('Cross-Platform Compatibility', () => {
        it('should work on Windows', async () => {
            Object.defineProperty(process, 'platform', {
                value: 'win32',
                configurable: true,
            });
            // Touch ID should not be available on Windows
            await hostsManager.checkAndSuggestTouchIdSetup();
            expect(mockExec).not.toHaveBeenCalledWith(expect.stringContaining('bioutil'));
        });
        it('should work on Linux', async () => {
            Object.defineProperty(process, 'platform', {
                value: 'linux',
                configurable: true,
            });
            // Touch ID should not be available on Linux
            await hostsManager.checkAndSuggestTouchIdSetup();
            expect(mockExec).not.toHaveBeenCalledWith(expect.stringContaining('bioutil'));
        });
    });
    describe('Error Handling', () => {
        it('should handle sudo-prompt errors without crashing', async () => {
            mockIsElevated.mockResolvedValue(false);
            mockSudoPrompt.exec.mockImplementation((_command, options, callback) => {
                callback(new Error('Authentication failed'), null, 'error');
            });
            const result = await hostsManager.updateHostsFile('test.test');
            expect(result).toBe(false);
        });
        it('should handle native-is-elevated errors gracefully', async () => {
            // Mock hostEntryExists to return false so it tries to add the entry
            mockHostile.get.mockImplementation((_flag, callback) => {
                callback(null, [['127.0.0.1', 'localhost']]); // test.test doesn't exist
            });
            mockIsElevated.mockRejectedValue(new Error('Cannot check elevation'));
            const result = await hostsManager.updateHostsFile('test.test');
            // The function should catch the error and return false, so sudo-prompt is never called
            expect(result).toBe(false); // Should fail due to our mocked error
            // Since isElevated throws, we never get to sudo-prompt
            expect(mockSudoPrompt.exec).not.toHaveBeenCalled();
        });
        it('should handle biometric detection errors', async () => {
            Object.defineProperty(process, 'platform', {
                value: 'darwin',
                configurable: true,
            });
            mockExec.mockRejectedValue(new Error('Command failed'));
            const consoleSpy = jest.spyOn(console, 'debug').mockImplementation();
            await hostsManager.checkAndSuggestTouchIdSetup();
            consoleSpy.mockRestore();
        });
    });
    describe('Module Exports', () => {
        it('should export required functions', () => {
            expect(typeof hostsManager.addLocalDnsResolution).toBe('function');
            expect(typeof hostsManager.cleanupHostsFile).toBe('function');
            expect(typeof hostsManager.updateHostsFile).toBe('function');
            expect(typeof hostsManager.checkAndSuggestTouchIdSetup).toBe('function');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L2Rucy9ob3N0cy1tYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHO0FBMENILDJDQUEyQztBQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQ3RELElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDaEMsSUFBSSxFQUFFLFFBQVE7SUFDZCxRQUFRLEVBQUUsWUFBWTtDQUN2QixDQUFDLENBQUMsQ0FBQztBQUNKLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdkIsU0FBUyxFQUFFLGFBQWE7Q0FDekIsQ0FBQyxDQUFDLENBQUM7QUFDSixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzNCLE1BQU0sRUFBRSxVQUFVO0NBQ25CLENBQUMsQ0FBQyxDQUFDO0FBRUosdUJBQXVCO0FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNsRCxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxZQUFZLENBQUMsQ0FBQztDQUN6RCxDQUFDLENBQUMsQ0FBQztBQTNESiwrQ0FBK0M7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QUFPLFlBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDN0QsTUFBTSxDQUFDLE9BQU8sWUFBWSxDQUFDLDJCQUEyQixDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzNFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZHdrL0RldmVsb3Blci9naXRsYWIuY29tL2Rhdmlkd2tlaXRoL0Bkd2svYW5nbGVzaXRlL3Rlc3QvZG5zL2hvc3RzLW1hbmFnZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIFRlc3RzIGZvciBETlMgaG9zdHMgZmlsZSBtYW5hZ2VtZW50IHdpdGggc3Vkby1wcm9tcHQgYW5kIFRvdWNoIElEIHN1cHBvcnRcbiAqL1xuXG4vLyBNb2NrIHN1ZG8tcHJvbXB0IGJlZm9yZSBpbXBvcnRpbmcgdGhlIG1vZHVsZVxuY29uc3QgbW9ja1N1ZG9Qcm9tcHQgPSB7XG4gIGV4ZWM6IGplc3QuZm4oKSxcbn07XG5cbi8vIE1vY2sgbmF0aXZlLWlzLWVsZXZhdGVkXG5jb25zdCBtb2NrSXNFbGV2YXRlZCA9IGplc3QuZm4oKTtcblxuLy8gTW9jayBjaGlsZF9wcm9jZXNzXG5jb25zdCBtb2NrRXhlYyA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tFeGVjRmlsZSA9IGplc3QuZm4oKTtcblxuLy8gSW1wb3J0IHRoZSBhY3R1YWwgZnVuY3Rpb25zIHRvIGNvbXBhcmUgYWdhaW5zdFxuY29uc3QgeyBleGVjRmlsZTogcmVhbEV4ZWNGaWxlIH0gPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJyk7XG5cbmNvbnN0IG1vY2tQcm9taXNpZnkgPSBqZXN0LmZuKChmbikgPT4ge1xuICAvLyBDaGVjayBpZiB0aGUgZnVuY3Rpb24gaXMgZXhlY0ZpbGUgYnkgZGlyZWN0IHJlZmVyZW5jZSBjb21wYXJpc29uXG4gIGlmIChmbiA9PT0gcmVhbEV4ZWNGaWxlKSByZXR1cm4gbW9ja0V4ZWNGaWxlO1xuICByZXR1cm4gbW9ja0V4ZWM7XG59KTtcblxuLy8gTW9jayBmcyBmb3IgZmlsZSBvcGVyYXRpb25zXG5jb25zdCBtb2NrRnMgPSB7XG4gIGV4aXN0c1N5bmM6IGplc3QuZm4oKSxcbiAgcmVhZEZpbGVTeW5jOiBqZXN0LmZuKCksXG4gIHdyaXRlRmlsZVN5bmM6IGplc3QuZm4oKSxcbn07XG5cbi8vIE1vY2sgaG9zdGlsZSBsaWJyYXJ5XG5jb25zdCBtb2NrSG9zdGlsZSA9IHtcbiAgZ2V0OiBqZXN0LmZuKCksXG4gIHNldDogamVzdC5mbigpLFxuICByZW1vdmU6IGplc3QuZm4oKSxcbn07XG5cbi8vIE1vY2sgZGlhbG9nXG5jb25zdCBtb2NrRGlhbG9nID0ge1xuICBzaG93TWVzc2FnZUJveDogamVzdC5mbigpLFxufTtcblxuLy8gU2V0IHVwIG1vY2tzIGJlZm9yZSBpbXBvcnRpbmcgdGhlIG1vZHVsZVxuamVzdC5tb2NrKCdzdWRvLXByb21wdCcsICgpID0+IG1vY2tTdWRvUHJvbXB0KTtcbmplc3QubW9jaygnbmF0aXZlLWlzLWVsZXZhdGVkJywgKCkgPT4gbW9ja0lzRWxldmF0ZWQpO1xuamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJywgKCkgPT4gKHtcbiAgZXhlYzogbW9ja0V4ZWMsXG4gIGV4ZWNGaWxlOiBtb2NrRXhlY0ZpbGUsXG59KSk7XG5qZXN0Lm1vY2soJ3V0aWwnLCAoKSA9PiAoe1xuICBwcm9taXNpZnk6IG1vY2tQcm9taXNpZnksXG59KSk7XG5qZXN0Lm1vY2soJ2ZzJywgKCkgPT4gbW9ja0ZzKTtcbmplc3QubW9jaygnaG9zdGlsZScsICgpID0+IG1vY2tIb3N0aWxlKTtcbmplc3QubW9jaygnZWxlY3Ryb24nLCAoKSA9PiAoe1xuICBkaWFsb2c6IG1vY2tEaWFsb2csXG59KSk7XG5cbi8vIE1vY2sgd2Vic2l0ZS1tYW5hZ2VyXG5qZXN0Lm1vY2soJy4uLy4uL2FwcC91dGlscy93ZWJzaXRlLW1hbmFnZXInLCAoKSA9PiAoe1xuICBsaXN0V2Vic2l0ZXM6IGplc3QuZm4oKCkgPT4gWyd0ZXN0LXNpdGUnLCAnbXktd2Vic2l0ZSddKSxcbn0pKTtcblxuZGVzY3JpYmUoJ0ROUyBIb3N0cyBNYW5hZ2VyJywgKCkgPT4ge1xuICBsZXQgaG9zdHNNYW5hZ2VyOiB7XG4gICAgYWRkTG9jYWxEbnNSZXNvbHV0aW9uOiAoaG9zdG5hbWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgICBjbGVhbnVwSG9zdHNGaWxlOiAoKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICAgIHVwZGF0ZUhvc3RzRmlsZTogKGhvc3RuYW1lOiBzdHJpbmcpID0+IFByb21pc2U8Ym9vbGVhbj47XG4gICAgY2hlY2tBbmRTdWdnZXN0VG91Y2hJZFNldHVwOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICB9O1xuXG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgLy8gSW1wb3J0IHRoZSBtb2R1bGUgYWZ0ZXIgbW9ja3MgYXJlIHNldCB1cFxuICAgIGhvc3RzTWFuYWdlciA9IHJlcXVpcmUoJy4uLy4uL2FwcC9kbnMvaG9zdHMtbWFuYWdlcicpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBSZXNldCBhbGwgbW9ja3NcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcblxuICAgIC8vIFNldCBkZWZhdWx0IG1vY2sgaW1wbGVtZW50YXRpb25zXG4gICAgbW9ja0lzRWxldmF0ZWQubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgIG1vY2tFeGVjLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3Rkb3V0OiAnMCcsIHN0ZGVycjogJycgfSk7XG4gICAgbW9ja0V4ZWNGaWxlLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3Rkb3V0OiAnMCcsIHN0ZGVycjogJycgfSk7XG4gICAgbW9ja0hvc3RpbGUuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigoX2ZsYWcsIGNhbGxiYWNrKSA9PiB7XG4gICAgICBjYWxsYmFjayhudWxsLCBbXG4gICAgICAgIFsnMTI3LjAuMC4xJywgJ2xvY2FsaG9zdCddLFxuICAgICAgICBbJzEyNy4wLjAuMScsICdhbmdsZXNpdGUudGVzdCddLFxuICAgICAgICBbJzEyNy4wLjAuMScsICd0ZXN0LXNpdGUudGVzdCddLFxuICAgICAgXSk7XG4gICAgfSk7XG4gICAgbW9ja1N1ZG9Qcm9tcHQuZXhlYy5tb2NrSW1wbGVtZW50YXRpb24oKGNvbW1hbmQsIG9wdGlvbnMsIGNhbGxiYWNrKSA9PiB7XG4gICAgICBjYWxsYmFjayhudWxsLCAnc3VjY2VzcycsICcnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1RvdWNoIElEIERldGVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBUb3VjaCBJRCBhdmFpbGFiaWxpdHkgb24gbWFjT1MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHBsYXRmb3JtIGRldGVjdGlvblxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHtcbiAgICAgICAgdmFsdWU6ICdkYXJ3aW4nLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gTW9jayBUb3VjaCBJRCBjb25maWd1cmVkIGFuZCBoYXJkd2FyZSBhdmFpbGFibGVcbiAgICAgIG1vY2tFeGVjRmlsZVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgc3Rkb3V0OiAnMScgfSkgLy8gcGFtX3RpZC5zbyBjb25maWd1cmVkXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBzdGRvdXQ6ICdUb3VjaCBJRCBhdmFpbGFibGUnIH0pOyAvLyBUb3VjaCBJRCBoYXJkd2FyZSBhdmFpbGFibGVcblxuICAgICAgYXdhaXQgaG9zdHNNYW5hZ2VyLmNoZWNrQW5kU3VnZ2VzdFRvdWNoSWRTZXR1cCgpO1xuXG4gICAgICBleHBlY3QobW9ja0V4ZWNGaWxlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZ3JlcCcsIFsnLWMnLCAncGFtX3RpZC5zbycsICcvZXRjL3BhbS5kL3N1ZG8nXSk7XG4gICAgICBleHBlY3QobW9ja0V4ZWNGaWxlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYmlvdXRpbCcsIFsnLXInXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1Z2dlc3QgVG91Y2ggSUQgc2V0dXAgd2hlbiBoYXJkd2FyZSBhdmFpbGFibGUgYnV0IG5vdCBjb25maWd1cmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHtcbiAgICAgICAgdmFsdWU6ICdkYXJ3aW4nLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gTW9jayBUb3VjaCBJRCBoYXJkd2FyZSBhdmFpbGFibGUgYnV0IG5vdCBjb25maWd1cmVkXG4gICAgICAvLyBGaXJzdCwgZm9yIGlzVG91Y2hJZEF2YWlsYWJsZSBjaGVjayAocmV0dXJucyBmYWxzZSAtIG5vdCBjb25maWd1cmVkKVxuICAgICAgbW9ja0V4ZWNcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IHN0ZG91dDogJzAnIH0pIC8vIHBhbV90aWQuc28gbm90IGNvbmZpZ3VyZWRcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IHN0ZG91dDogJzEnIH0pIC8vIFRvdWNoIElEIGhhcmR3YXJlIGF2YWlsYWJsZVxuICAgICAgICAvLyBUaGVuIGZvciBjYW5FbmFibGVUb3VjaElkIGNoZWNrIChyZXR1cm5zIHRydWUgLSBjYW4gYmUgZW5hYmxlZClcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IHN0ZG91dDogJzEnIH0pIC8vIFRvdWNoIElEIGhhcmR3YXJlIGF2YWlsYWJsZVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgc3Rkb3V0OiAnMCcgfSk7IC8vIHBhbV90aWQuc28gbm90IGNvbmZpZ3VyZWRcblxuICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBob3N0c01hbmFnZXIuY2hlY2tBbmRTdWdnZXN0VG91Y2hJZFNldHVwKCk7XG5cbiAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29uZmlybSBUb3VjaCBJRCBpcyBjb25maWd1cmVkIHdoZW4gYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MsICdwbGF0Zm9ybScsIHtcbiAgICAgICAgdmFsdWU6ICdkYXJ3aW4nLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gTW9jayBUb3VjaCBJRCBjb25maWd1cmVkIGFuZCBoYXJkd2FyZSBhdmFpbGFibGVcbiAgICAgIG1vY2tFeGVjXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBzdGRvdXQ6ICcxJyB9KSAvLyBwYW1fdGlkLnNvIGNvbmZpZ3VyZWRcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IHN0ZG91dDogJzEnIH0pOyAvLyBUb3VjaCBJRCBoYXJkd2FyZSBhdmFpbGFibGVcblxuICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBob3N0c01hbmFnZXIuY2hlY2tBbmRTdWdnZXN0VG91Y2hJZFNldHVwKCk7XG5cbiAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2tpcCBUb3VjaCBJRCBjaGVja3Mgb24gbm9uLW1hY09TIHBsYXRmb3JtcycsIGFzeW5jICgpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9jZXNzLCAncGxhdGZvcm0nLCB7XG4gICAgICAgIHZhbHVlOiAnbGludXgnLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBob3N0c01hbmFnZXIuY2hlY2tBbmRTdWdnZXN0VG91Y2hJZFNldHVwKCk7XG5cbiAgICAgIGV4cGVjdChtb2NrRXhlYykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRWxldmF0ZWQgUHJpdmlsZWdlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJ1biBjb21tYW5kcyBkaXJlY3RseSB3aGVuIGFscmVhZHkgZWxldmF0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSXNFbGV2YXRlZC5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tFeGVjLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3Rkb3V0OiAnc3VjY2VzcycgfSk7XG5cbiAgICAgIC8vIEFjY2VzcyB0aGUgcHJpdmF0ZSBmdW5jdGlvbiB0aHJvdWdoIHRoZSBtb2R1bGUncyBleHBvcnRzXG4gICAgICAvLyBUaGlzIGlzIGEgYml0IGhhY2t5IGJ1dCBuZWNlc3NhcnkgZm9yIHRlc3RpbmcgaW50ZXJuYWwgZnVuY3Rpb25zXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBob3N0c01hbmFnZXIudXBkYXRlSG9zdHNGaWxlKCd0ZXN0LnRlc3QnKTtcblxuICAgICAgZXhwZWN0KG1vY2tJc0VsZXZhdGVkKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1N1ZG9Qcm9tcHQuZXhlYykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBzdWRvLXByb21wdCB3aGVuIG5vdCBlbGV2YXRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJc0VsZXZhdGVkLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcbiAgICAgIG1vY2tTdWRvUHJvbXB0LmV4ZWMubW9ja0ltcGxlbWVudGF0aW9uKChfY29tbWFuZCwgb3B0aW9ucywgY2FsbGJhY2spID0+IHtcbiAgICAgICAgZXhwZWN0KG9wdGlvbnMubmFtZSkudG9CZSgnQW5nbGVzaXRlIEROUycpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCAnc3VjY2VzcycsICcnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBob3N0c01hbmFnZXIudXBkYXRlSG9zdHNGaWxlKCd0ZXN0LnRlc3QnKTtcblxuICAgICAgZXhwZWN0KG1vY2tJc0VsZXZhdGVkKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1N1ZG9Qcm9tcHQuZXhlYykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGF1dGhlbnRpY2F0aW9uIGNhbmNlbGxhdGlvbiBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0lzRWxldmF0ZWQubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgICAgbW9ja1N1ZG9Qcm9tcHQuZXhlYy5tb2NrSW1wbGVtZW50YXRpb24oKF9jb21tYW5kLCBfb3B0aW9ucywgY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1VzZXIgY2FuY2VsbGVkJykgYXMgRXJyb3IgJiB7IGNvZGU6IG51bWJlciB9O1xuICAgICAgICBlcnJvci5jb2RlID0gLTEyODtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwsICcnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhvc3RzTWFuYWdlci51cGRhdGVIb3N0c0ZpbGUoJ3Rlc3QudGVzdCcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcblxuICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgYXBwcm9wcmlhdGUgYXV0aGVudGljYXRpb24gbWV0aG9kIGJhc2VkIG9uIFRvdWNoIElEIGF2YWlsYWJpbGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9jZXNzLCAncGxhdGZvcm0nLCB7XG4gICAgICAgIHZhbHVlOiAnZGFyd2luJyxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tJc0VsZXZhdGVkLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcblxuICAgICAgLy8gTW9jayBUb3VjaCBJRCBhdmFpbGFibGVcbiAgICAgIG1vY2tFeGVjXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBzdGRvdXQ6ICcxJyB9KSAvLyBwYW1fdGlkLnNvIGNvbmZpZ3VyZWRcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IHN0ZG91dDogJzEnIH0pOyAvLyBUb3VjaCBJRCBoYXJkd2FyZSBhdmFpbGFibGVcblxuICAgICAgbW9ja1N1ZG9Qcm9tcHQuZXhlYy5tb2NrSW1wbGVtZW50YXRpb24oKF9jb21tYW5kLCBvcHRpb25zLCBjYWxsYmFjaykgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCAnc3VjY2VzcycsICcnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGF3YWl0IGhvc3RzTWFuYWdlci51cGRhdGVIb3N0c0ZpbGUoJ3Rlc3QudGVzdCcpO1xuXG4gICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdIb3N0cyBGaWxlIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhZGQgbG9jYWwgRE5TIHJlc29sdXRpb24gZm9yIG5ldyBkb21haW5zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0hvc3RpbGUuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigoX2ZsYWcsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIFtbJzEyNy4wLjAuMScsICdhbmdsZXNpdGUudGVzdCddXSk7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgaG9zdHNNYW5hZ2VyLmFkZExvY2FsRG5zUmVzb2x1dGlvbignbmV3LXNpdGUudGVzdCcpO1xuXG4gICAgICBleHBlY3QobW9ja0hvc3RpbGUuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNraXAgYWRkaW5nIGRvbWFpbnMgdGhhdCBhbHJlYWR5IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0hvc3RpbGUuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigoX2ZsYWcsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIFtcbiAgICAgICAgICBbJzEyNy4wLjAuMScsICdhbmdsZXNpdGUudGVzdCddLFxuICAgICAgICAgIFsnMTI3LjAuMC4xJywgJ2V4aXN0aW5nLXNpdGUudGVzdCddLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGF3YWl0IGhvc3RzTWFuYWdlci51cGRhdGVIb3N0c0ZpbGUoJ2V4aXN0aW5nLXNpdGUudGVzdCcpO1xuXG4gICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsZWFuIHVwIG9ycGhhbmVkIGRvbWFpbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSG9zdGlsZS5nZXQubW9ja0ltcGxlbWVudGF0aW9uKChfZmxhZywgY2FsbGJhY2spID0+IHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgW1xuICAgICAgICAgIFsnMTI3LjAuMC4xJywgJzEyNy4wLjAuMSBhbmdsZXNpdGUudGVzdCddLFxuICAgICAgICAgIFsnMTI3LjAuMC4xJywgJzEyNy4wLjAuMSBvcnBoYW5lZC1zaXRlLnRlc3QnXSwgLy8gVGhpcyBzaG91bGQgYmUgcmVtb3ZlZFxuICAgICAgICAgIFsnMTI3LjAuMC4xJywgJzEyNy4wLjAuMSB0ZXN0LXNpdGUudGVzdCddLCAvLyBUaGlzIHNob3VsZCBzdGF5IChleGlzdHMgaW4gd2Vic2l0ZSBsaXN0KVxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBob3N0c01hbmFnZXIuY2xlYW51cEhvc3RzRmlsZSgpO1xuXG4gICAgICBleHBlY3QobW9ja0hvc3RpbGUuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBob3N0aWxlIGxpYnJhcnkgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSG9zdGlsZS5nZXQubW9ja0ltcGxlbWVudGF0aW9uKChfZmxhZywgY2FsbGJhY2spID0+IHtcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCdGYWlsZWQgdG8gcmVhZCBob3N0cyBmaWxlJyksIG51bGwpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhvc3RzTWFuYWdlci5jbGVhbnVwSG9zdHNGaWxlKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ3Jvc3MtUGxhdGZvcm0gQ29tcGF0aWJpbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHdvcmsgb24gV2luZG93cycsIGFzeW5jICgpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9jZXNzLCAncGxhdGZvcm0nLCB7XG4gICAgICAgIHZhbHVlOiAnd2luMzInLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gVG91Y2ggSUQgc2hvdWxkIG5vdCBiZSBhdmFpbGFibGUgb24gV2luZG93c1xuICAgICAgYXdhaXQgaG9zdHNNYW5hZ2VyLmNoZWNrQW5kU3VnZ2VzdFRvdWNoSWRTZXR1cCgpO1xuXG4gICAgICBleHBlY3QobW9ja0V4ZWMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Quc3RyaW5nQ29udGFpbmluZygnYmlvdXRpbCcpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd29yayBvbiBMaW51eCcsIGFzeW5jICgpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9jZXNzLCAncGxhdGZvcm0nLCB7XG4gICAgICAgIHZhbHVlOiAnbGludXgnLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gVG91Y2ggSUQgc2hvdWxkIG5vdCBiZSBhdmFpbGFibGUgb24gTGludXhcbiAgICAgIGF3YWl0IGhvc3RzTWFuYWdlci5jaGVja0FuZFN1Z2dlc3RUb3VjaElkU2V0dXAoKTtcblxuICAgICAgZXhwZWN0KG1vY2tFeGVjKS5ub3QudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2Jpb3V0aWwnKSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdWRvLXByb21wdCBlcnJvcnMgd2l0aG91dCBjcmFzaGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJc0VsZXZhdGVkLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcbiAgICAgIG1vY2tTdWRvUHJvbXB0LmV4ZWMubW9ja0ltcGxlbWVudGF0aW9uKChfY29tbWFuZCwgb3B0aW9ucywgY2FsbGJhY2spID0+IHtcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiBmYWlsZWQnKSwgbnVsbCwgJ2Vycm9yJyk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaG9zdHNNYW5hZ2VyLnVwZGF0ZUhvc3RzRmlsZSgndGVzdC50ZXN0Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbmF0aXZlLWlzLWVsZXZhdGVkIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBob3N0RW50cnlFeGlzdHMgdG8gcmV0dXJuIGZhbHNlIHNvIGl0IHRyaWVzIHRvIGFkZCB0aGUgZW50cnlcbiAgICAgIG1vY2tIb3N0aWxlLmdldC5tb2NrSW1wbGVtZW50YXRpb24oKF9mbGFnLCBjYWxsYmFjaykgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCBbWycxMjcuMC4wLjEnLCAnbG9jYWxob3N0J11dKTsgLy8gdGVzdC50ZXN0IGRvZXNuJ3QgZXhpc3RcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrSXNFbGV2YXRlZC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0Nhbm5vdCBjaGVjayBlbGV2YXRpb24nKSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhvc3RzTWFuYWdlci51cGRhdGVIb3N0c0ZpbGUoJ3Rlc3QudGVzdCcpO1xuXG4gICAgICAvLyBUaGUgZnVuY3Rpb24gc2hvdWxkIGNhdGNoIHRoZSBlcnJvciBhbmQgcmV0dXJuIGZhbHNlLCBzbyBzdWRvLXByb21wdCBpcyBuZXZlciBjYWxsZWRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpOyAvLyBTaG91bGQgZmFpbCBkdWUgdG8gb3VyIG1vY2tlZCBlcnJvclxuICAgICAgLy8gU2luY2UgaXNFbGV2YXRlZCB0aHJvd3MsIHdlIG5ldmVyIGdldCB0byBzdWRvLXByb21wdFxuICAgICAgZXhwZWN0KG1vY2tTdWRvUHJvbXB0LmV4ZWMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBiaW9tZXRyaWMgZGV0ZWN0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9jZXNzLCAncGxhdGZvcm0nLCB7XG4gICAgICAgIHZhbHVlOiAnZGFyd2luJyxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tFeGVjLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQ29tbWFuZCBmYWlsZWQnKSk7XG5cbiAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdkZWJ1ZycpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBob3N0c01hbmFnZXIuY2hlY2tBbmRTdWdnZXN0VG91Y2hJZFNldHVwKCk7XG5cbiAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ01vZHVsZSBFeHBvcnRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhwb3J0IHJlcXVpcmVkIGZ1bmN0aW9ucycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh0eXBlb2YgaG9zdHNNYW5hZ2VyLmFkZExvY2FsRG5zUmVzb2x1dGlvbikudG9CZSgnZnVuY3Rpb24nKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgaG9zdHNNYW5hZ2VyLmNsZWFudXBIb3N0c0ZpbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIGhvc3RzTWFuYWdlci51cGRhdGVIb3N0c0ZpbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIGhvc3RzTWFuYWdlci5jaGVja0FuZFN1Z2dlc3RUb3VjaElkU2V0dXApLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=