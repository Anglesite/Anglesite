7cb3d9c1e4ab07aaf412f3c78b870222
"use strict";
/**
 * @file Tests for the Eleventy configuration.
 */
// Mock the dependencies that .eleventy.js requires
jest.mock('@11ty/eleventy-plugin-webc', () => ({}));
jest.mock('@dwk/anglesite-11ty', () => jest.fn(() => ({ name: '@dwk/anglesite-11ty' })));
jest.mock('fs', () => ({
    existsSync: jest.fn((path) => {
        // Mock that the base layout exists
        return path.includes('base.webc');
    }),
}));
jest.mock('path', () => ({
    join: jest.fn((...args) => args.join('/')),
}));
// Now require the module
const eleventyConfig = require('../app/eleventy/.eleventy.js');
/**
 * Describes the Eleventy configuration tests.
 */
describe('Eleventy Configuration', () => {
    let mockConfig;
    let consoleLogSpy;
    let consoleErrorSpy;
    beforeEach(() => {
        // Mock console methods to prevent noise in test output
        consoleLogSpy = jest.spyOn(console, 'log').mockImplementation();
        consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
        // Create a mock Eleventy config object with all required methods
        mockConfig = {
            addBundle: jest.fn(),
            addPlugin: jest.fn(),
            setDataFileBaseName: jest.fn(),
            setFreezeReservedData: jest.fn(),
            addGlobalData: jest.fn(),
        };
    });
    afterEach(() => {
        consoleLogSpy.mockRestore();
        consoleErrorSpy.mockRestore();
    });
    it('should configure plugins correctly', () => {
        eleventyConfig(mockConfig);
        expect(mockConfig.addPlugin).toHaveBeenCalledTimes(2);
        expect(mockConfig.setFreezeReservedData).toHaveBeenCalledWith(false);
    });
    it('should add the anglesite-11ty plugin', () => {
        const anglesitePlugin = require('@dwk/anglesite-11ty');
        eleventyConfig(mockConfig);
        expect(mockConfig.addPlugin).toHaveBeenCalledWith(anglesitePlugin);
    });
    it('should add WebC plugin with correct component paths', () => {
        eleventyConfig(mockConfig);
        // Check that WebC plugin was added (it's the second call to addPlugin)
        expect(mockConfig.addPlugin).toHaveBeenCalledTimes(2);
        // Find the WebC plugin call (not the anglesite plugin)
        const webCCall = mockConfig.addPlugin.mock.calls.find((call) => call[1] && typeof call[1] === 'object' && call[1] !== null && 'components' in call[1]);
        expect(webCCall).toBeDefined();
        expect(webCCall?.[1]).toEqual({
            components: 'src/_includes/**/*.webc',
        });
    });
    it('should set data file base name to anglesite when base layout exists', () => {
        const mockFs = require('fs');
        mockFs.existsSync.mockReturnValue(true);
        eleventyConfig(mockConfig);
        expect(mockConfig.setDataFileBaseName).toHaveBeenCalledWith('anglesite');
    });
    it('should return correct configuration object', () => {
        const config = eleventyConfig(mockConfig);
        expect(config).toEqual({
            templateFormats: ['11ty.js', 'webc', 'md', 'html'],
            markdownTemplateEngine: 'webc',
            htmlTemplateEngine: 'webc',
            dir: {
                input: 'src',
                output: '_site',
                includes: '_includes',
                layouts: '_includes',
            },
        });
    });
    it('should define correct directory structure', () => {
        const config = eleventyConfig(mockConfig);
        expect(config.dir).toBeDefined();
        expect(config.dir.includes).toBe('_includes');
        expect(config.dir.layouts).toBe('_includes');
        expect(config.dir.input).toBe('src');
        expect(config.dir.output).toBe('_site');
    });
    it('should configure WebC as the template engine for markdown and HTML', () => {
        const config = eleventyConfig(mockConfig);
        expect(config.markdownTemplateEngine).toBe('webc');
        expect(config.htmlTemplateEngine).toBe('webc');
    });
    it('should support the correct template formats', () => {
        const config = eleventyConfig(mockConfig);
        expect(config.templateFormats).toContain('11ty.js');
        expect(config.templateFormats).toContain('webc');
        expect(config.templateFormats).toContain('md');
        expect(config.templateFormats).toContain('html');
        expect(config.templateFormats).toHaveLength(4);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L2VsZXZlbnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHO0FBRUgsbURBQW1EO0FBQ25ELElBQUksQ0FBQyxJQUFJLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ3BELElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLHFCQUFxQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDekYsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQVksRUFBRSxFQUFFO1FBQ25DLG1DQUFtQztRQUNuQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0NBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDSixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFjLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Q0FDckQsQ0FBQyxDQUFDLENBQUM7QUFFSix5QkFBeUI7QUFDekIsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLDhCQUE4QixDQUFDLENBQUM7QUFFL0Q7O0dBRUc7QUFDSCxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLElBQUksVUFNSCxDQUFDO0lBQ0YsSUFBSSxhQUErQixDQUFDO0lBQ3BDLElBQUksZUFBaUMsQ0FBQztJQUV0QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsdURBQXVEO1FBQ3ZELGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQ2hFLGVBQWUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBRXBFLGlFQUFpRTtRQUNqRSxVQUFVLEdBQUc7WUFDWCxTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNwQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNwQixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzlCLHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDaEMsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDekIsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM1QixlQUFlLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1FBQzVDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUzQixNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RELE1BQU0sQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2RSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7UUFDOUMsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDdkQsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTNCLE1BQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDckUsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMscURBQXFELEVBQUUsR0FBRyxFQUFFO1FBQzdELGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUzQix1RUFBdUU7UUFDdkUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV0RCx1REFBdUQ7UUFDdkQsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FDbkQsQ0FBQyxJQUFlLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxZQUFZLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUMzRyxDQUFDO1FBRUYsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUM1QixVQUFVLEVBQUUseUJBQXlCO1NBQ3RDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHFFQUFxRSxFQUFFLEdBQUcsRUFBRTtRQUM3RSxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsTUFBTSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFeEMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTNCLE1BQU0sQ0FBQyxVQUFVLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUMzRSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxHQUFHLEVBQUU7UUFDcEQsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDckIsZUFBZSxFQUFFLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDO1lBQ2xELHNCQUFzQixFQUFFLE1BQU07WUFDOUIsa0JBQWtCLEVBQUUsTUFBTTtZQUMxQixHQUFHLEVBQUU7Z0JBQ0gsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osTUFBTSxFQUFFLE9BQU87Z0JBQ2YsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLE9BQU8sRUFBRSxXQUFXO2FBQ3JCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1FBQ25ELE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUxQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM5QyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDN0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMxQyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxvRUFBb0UsRUFBRSxHQUFHLEVBQUU7UUFDNUUsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7UUFDckQsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L2VsZXZlbnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBUZXN0cyBmb3IgdGhlIEVsZXZlbnR5IGNvbmZpZ3VyYXRpb24uXG4gKi9cblxuLy8gTW9jayB0aGUgZGVwZW5kZW5jaWVzIHRoYXQgLmVsZXZlbnR5LmpzIHJlcXVpcmVzXG5qZXN0Lm1vY2soJ0AxMXR5L2VsZXZlbnR5LXBsdWdpbi13ZWJjJywgKCkgPT4gKHt9KSk7XG5qZXN0Lm1vY2soJ0Bkd2svYW5nbGVzaXRlLTExdHknLCAoKSA9PiBqZXN0LmZuKCgpID0+ICh7IG5hbWU6ICdAZHdrL2FuZ2xlc2l0ZS0xMXR5JyB9KSkpO1xuamVzdC5tb2NrKCdmcycsICgpID0+ICh7XG4gIGV4aXN0c1N5bmM6IGplc3QuZm4oKHBhdGg6IHN0cmluZykgPT4ge1xuICAgIC8vIE1vY2sgdGhhdCB0aGUgYmFzZSBsYXlvdXQgZXhpc3RzXG4gICAgcmV0dXJuIHBhdGguaW5jbHVkZXMoJ2Jhc2Uud2ViYycpO1xuICB9KSxcbn0pKTtcbmplc3QubW9jaygncGF0aCcsICgpID0+ICh7XG4gIGpvaW46IGplc3QuZm4oKC4uLmFyZ3M6IHN0cmluZ1tdKSA9PiBhcmdzLmpvaW4oJy8nKSksXG59KSk7XG5cbi8vIE5vdyByZXF1aXJlIHRoZSBtb2R1bGVcbmNvbnN0IGVsZXZlbnR5Q29uZmlnID0gcmVxdWlyZSgnLi4vYXBwL2VsZXZlbnR5Ly5lbGV2ZW50eS5qcycpO1xuXG4vKipcbiAqIERlc2NyaWJlcyB0aGUgRWxldmVudHkgY29uZmlndXJhdGlvbiB0ZXN0cy5cbiAqL1xuZGVzY3JpYmUoJ0VsZXZlbnR5IENvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gIGxldCBtb2NrQ29uZmlnOiB7XG4gICAgYWRkQnVuZGxlOiBqZXN0Lk1vY2s7XG4gICAgYWRkUGx1Z2luOiBqZXN0Lk1vY2s7XG4gICAgc2V0RGF0YUZpbGVCYXNlTmFtZTogamVzdC5Nb2NrO1xuICAgIHNldEZyZWV6ZVJlc2VydmVkRGF0YTogamVzdC5Nb2NrO1xuICAgIGFkZEdsb2JhbERhdGE6IGplc3QuTW9jaztcbiAgfTtcbiAgbGV0IGNvbnNvbGVMb2dTcHk6IGplc3QuU3B5SW5zdGFuY2U7XG4gIGxldCBjb25zb2xlRXJyb3JTcHk6IGplc3QuU3B5SW5zdGFuY2U7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgLy8gTW9jayBjb25zb2xlIG1ldGhvZHMgdG8gcHJldmVudCBub2lzZSBpbiB0ZXN0IG91dHB1dFxuICAgIGNvbnNvbGVMb2dTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcbiAgICBjb25zb2xlRXJyb3JTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgLy8gQ3JlYXRlIGEgbW9jayBFbGV2ZW50eSBjb25maWcgb2JqZWN0IHdpdGggYWxsIHJlcXVpcmVkIG1ldGhvZHNcbiAgICBtb2NrQ29uZmlnID0ge1xuICAgICAgYWRkQnVuZGxlOiBqZXN0LmZuKCksXG4gICAgICBhZGRQbHVnaW46IGplc3QuZm4oKSxcbiAgICAgIHNldERhdGFGaWxlQmFzZU5hbWU6IGplc3QuZm4oKSxcbiAgICAgIHNldEZyZWV6ZVJlc2VydmVkRGF0YTogamVzdC5mbigpLFxuICAgICAgYWRkR2xvYmFsRGF0YTogamVzdC5mbigpLFxuICAgIH07XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgY29uc29sZUxvZ1NweS5tb2NrUmVzdG9yZSgpO1xuICAgIGNvbnNvbGVFcnJvclNweS5tb2NrUmVzdG9yZSgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNvbmZpZ3VyZSBwbHVnaW5zIGNvcnJlY3RseScsICgpID0+IHtcbiAgICBlbGV2ZW50eUNvbmZpZyhtb2NrQ29uZmlnKTtcblxuICAgIGV4cGVjdChtb2NrQ29uZmlnLmFkZFBsdWdpbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIGV4cGVjdChtb2NrQ29uZmlnLnNldEZyZWV6ZVJlc2VydmVkRGF0YSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZmFsc2UpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGFkZCB0aGUgYW5nbGVzaXRlLTExdHkgcGx1Z2luJywgKCkgPT4ge1xuICAgIGNvbnN0IGFuZ2xlc2l0ZVBsdWdpbiA9IHJlcXVpcmUoJ0Bkd2svYW5nbGVzaXRlLTExdHknKTtcbiAgICBlbGV2ZW50eUNvbmZpZyhtb2NrQ29uZmlnKTtcblxuICAgIGV4cGVjdChtb2NrQ29uZmlnLmFkZFBsdWdpbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoYW5nbGVzaXRlUGx1Z2luKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBhZGQgV2ViQyBwbHVnaW4gd2l0aCBjb3JyZWN0IGNvbXBvbmVudCBwYXRocycsICgpID0+IHtcbiAgICBlbGV2ZW50eUNvbmZpZyhtb2NrQ29uZmlnKTtcblxuICAgIC8vIENoZWNrIHRoYXQgV2ViQyBwbHVnaW4gd2FzIGFkZGVkIChpdCdzIHRoZSBzZWNvbmQgY2FsbCB0byBhZGRQbHVnaW4pXG4gICAgZXhwZWN0KG1vY2tDb25maWcuYWRkUGx1Z2luKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG5cbiAgICAvLyBGaW5kIHRoZSBXZWJDIHBsdWdpbiBjYWxsIChub3QgdGhlIGFuZ2xlc2l0ZSBwbHVnaW4pXG4gICAgY29uc3Qgd2ViQ0NhbGwgPSBtb2NrQ29uZmlnLmFkZFBsdWdpbi5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAoY2FsbDogdW5rbm93bltdKSA9PiBjYWxsWzFdICYmIHR5cGVvZiBjYWxsWzFdID09PSAnb2JqZWN0JyAmJiBjYWxsWzFdICE9PSBudWxsICYmICdjb21wb25lbnRzJyBpbiBjYWxsWzFdXG4gICAgKTtcblxuICAgIGV4cGVjdCh3ZWJDQ2FsbCkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3Qod2ViQ0NhbGw/LlsxXSkudG9FcXVhbCh7XG4gICAgICBjb21wb25lbnRzOiAnc3JjL19pbmNsdWRlcy8qKi8qLndlYmMnLFxuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHNldCBkYXRhIGZpbGUgYmFzZSBuYW1lIHRvIGFuZ2xlc2l0ZSB3aGVuIGJhc2UgbGF5b3V0IGV4aXN0cycsICgpID0+IHtcbiAgICBjb25zdCBtb2NrRnMgPSByZXF1aXJlKCdmcycpO1xuICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcblxuICAgIGVsZXZlbnR5Q29uZmlnKG1vY2tDb25maWcpO1xuXG4gICAgZXhwZWN0KG1vY2tDb25maWcuc2V0RGF0YUZpbGVCYXNlTmFtZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FuZ2xlc2l0ZScpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0IGNvbmZpZ3VyYXRpb24gb2JqZWN0JywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IGVsZXZlbnR5Q29uZmlnKG1vY2tDb25maWcpO1xuXG4gICAgZXhwZWN0KGNvbmZpZykudG9FcXVhbCh7XG4gICAgICB0ZW1wbGF0ZUZvcm1hdHM6IFsnMTF0eS5qcycsICd3ZWJjJywgJ21kJywgJ2h0bWwnXSxcbiAgICAgIG1hcmtkb3duVGVtcGxhdGVFbmdpbmU6ICd3ZWJjJyxcbiAgICAgIGh0bWxUZW1wbGF0ZUVuZ2luZTogJ3dlYmMnLFxuICAgICAgZGlyOiB7XG4gICAgICAgIGlucHV0OiAnc3JjJyxcbiAgICAgICAgb3V0cHV0OiAnX3NpdGUnLFxuICAgICAgICBpbmNsdWRlczogJ19pbmNsdWRlcycsXG4gICAgICAgIGxheW91dHM6ICdfaW5jbHVkZXMnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBkZWZpbmUgY29ycmVjdCBkaXJlY3Rvcnkgc3RydWN0dXJlJywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IGVsZXZlbnR5Q29uZmlnKG1vY2tDb25maWcpO1xuXG4gICAgZXhwZWN0KGNvbmZpZy5kaXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KGNvbmZpZy5kaXIuaW5jbHVkZXMpLnRvQmUoJ19pbmNsdWRlcycpO1xuICAgIGV4cGVjdChjb25maWcuZGlyLmxheW91dHMpLnRvQmUoJ19pbmNsdWRlcycpO1xuICAgIGV4cGVjdChjb25maWcuZGlyLmlucHV0KS50b0JlKCdzcmMnKTtcbiAgICBleHBlY3QoY29uZmlnLmRpci5vdXRwdXQpLnRvQmUoJ19zaXRlJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY29uZmlndXJlIFdlYkMgYXMgdGhlIHRlbXBsYXRlIGVuZ2luZSBmb3IgbWFya2Rvd24gYW5kIEhUTUwnLCAoKSA9PiB7XG4gICAgY29uc3QgY29uZmlnID0gZWxldmVudHlDb25maWcobW9ja0NvbmZpZyk7XG5cbiAgICBleHBlY3QoY29uZmlnLm1hcmtkb3duVGVtcGxhdGVFbmdpbmUpLnRvQmUoJ3dlYmMnKTtcbiAgICBleHBlY3QoY29uZmlnLmh0bWxUZW1wbGF0ZUVuZ2luZSkudG9CZSgnd2ViYycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHN1cHBvcnQgdGhlIGNvcnJlY3QgdGVtcGxhdGUgZm9ybWF0cycsICgpID0+IHtcbiAgICBjb25zdCBjb25maWcgPSBlbGV2ZW50eUNvbmZpZyhtb2NrQ29uZmlnKTtcblxuICAgIGV4cGVjdChjb25maWcudGVtcGxhdGVGb3JtYXRzKS50b0NvbnRhaW4oJzExdHkuanMnKTtcbiAgICBleHBlY3QoY29uZmlnLnRlbXBsYXRlRm9ybWF0cykudG9Db250YWluKCd3ZWJjJyk7XG4gICAgZXhwZWN0KGNvbmZpZy50ZW1wbGF0ZUZvcm1hdHMpLnRvQ29udGFpbignbWQnKTtcbiAgICBleHBlY3QoY29uZmlnLnRlbXBsYXRlRm9ybWF0cykudG9Db250YWluKCdodG1sJyk7XG4gICAgZXhwZWN0KGNvbmZpZy50ZW1wbGF0ZUZvcm1hdHMpLnRvSGF2ZUxlbmd0aCg0KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==