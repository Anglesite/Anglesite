80eca8a80e8f4738faae196e8d983ac5
"use strict";
/**
 * @file Tests for per-website server management
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('fs');
jest.mock('path');
jest.mock('@11ty/eleventy');
jest.mock('@11ty/eleventy-dev-server');
jest.mock('../../app/server/eleventy-url-resolver');
jest.mock('../../app/ui/multi-window-manager', () => ({
    sendLogToWebsite: jest.fn(),
}));
// Mock Eleventy
jest.mock('@11ty/eleventy', () => {
    return jest.fn().mockImplementation(() => ({
        write: jest.fn(),
    }));
});
// Mock EleventyDevServer
jest.mock('@11ty/eleventy-dev-server', () => {
    return jest.fn().mockImplementation(() => ({
        serve: jest.fn(),
        watcher: {
            on: jest.fn(),
            close: jest.fn(),
        },
        watchFiles: jest.fn(),
        close: jest.fn(),
    }));
});
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const per_website_server_1 = require("../../app/server/per-website-server");
const eleventy_url_resolver_1 = require("../../app/server/eleventy-url-resolver");
const logging_test_utils_1 = require("../utils/logging-test-utils");
const mockFs = fs;
const mockPath = path;
const mockEleventy = require('@11ty/eleventy');
const mockEleventyDevServer = require('@11ty/eleventy-dev-server');
const mockEleventyUrlResolver = eleventy_url_resolver_1.EleventyUrlResolver;
describe('Per-Website Server', () => {
    let originalConsole;
    let loggingHelper;
    let mockMultiWindowManager;
    beforeEach(() => {
        jest.clearAllMocks();
        // Setup logging helper
        loggingHelper = (0, logging_test_utils_1.createLoggingTestHelper)();
        // Store original console
        originalConsole = { ...console };
        // Setup default path mocks
        mockPath.join.mockImplementation((...args) => args.join('/'));
        // Setup multi-window-manager mock
        mockMultiWindowManager = require('../../app/ui/multi-window-manager');
        mockMultiWindowManager.sendLogToWebsite = jest.fn();
        // Mock URL resolver
        mockEleventyUrlResolver.prototype.initialize = jest.fn().mockResolvedValue(undefined);
        // Reset Eleventy mock
        mockEleventy.mockClear();
        mockEleventyDevServer.mockClear();
    });
    afterEach(() => {
        // Clean up test helpers
        loggingHelper.restore();
        // Restore console
        Object.assign(console, originalConsole);
    });
    describe('sendLogToWindow', () => {
        it('should handle missing sendLogToWebsite function', async () => {
            // Test by temporarily removing the function
            const originalFunction = mockMultiWindowManager.sendLogToWebsite;
            delete mockMultiWindowManager.sendLogToWebsite;
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            mockFs.existsSync.mockReturnValue(false);
            try {
                await (0, per_website_server_1.startWebsiteServer)('/test/path', 'test-site', 3000);
            }
            catch {
                // Expected to fail, we're testing the log function
            }
            // Restore the function
            if (originalFunction) {
                mockMultiWindowManager.sendLogToWebsite = originalFunction;
            }
            consoleSpy.mockRestore();
        });
    });
    describe('startWebsiteServer', () => {
        beforeEach(() => {
            // Setup successful path and directory mocks
            mockFs.existsSync.mockImplementation((filePath) => {
                const pathStr = String(filePath);
                if (pathStr.includes('_site'))
                    return false; // output dir doesn't exist initially
                if (pathStr.includes('/src'))
                    return true; // src directory exists
                return false;
            });
            mockFs.mkdirSync.mockImplementation(() => undefined);
            mockFs.rmSync.mockImplementation(() => { });
            // Mock successful Eleventy instance
            const mockEleventyInstance = {
                write: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            // Mock successful dev server
            const mockDevServerInstance = {
                serve: jest.fn(),
                watcher: {
                    on: jest.fn(),
                    close: jest.fn().mockResolvedValue(undefined),
                },
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockReturnValue(mockDevServerInstance);
            // Mock console methods
            jest.spyOn(console, 'log').mockImplementation(() => { });
            jest.spyOn(console, 'error').mockImplementation(() => { });
            jest.spyOn(console, 'warn').mockImplementation(() => { });
        });
        it('should successfully start a website server', async () => {
            const server = await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            expect(server).toBeDefined();
            expect(server.eleventy).toBeDefined();
            expect(server.devServer).toBeDefined();
            expect(server.inputDir).toBe('/test/website/src');
            expect(server.outputDir).toBe('/test/website/_site');
            expect(server.port).toBe(3000);
            expect(server.urlResolver).toBeDefined();
            expect(server.restoreConsole).toBeDefined();
            expect(mockFs.mkdirSync).toHaveBeenCalledWith('/test/website/_site', { recursive: true });
            expect(mockEleventy).toHaveBeenCalledWith('/test/website/src', '/test/website/_site', expect.any(Object));
        });
        it('should handle missing source directory', async () => {
            mockFs.existsSync.mockImplementation((filePath) => {
                const pathStr = String(filePath);
                if (pathStr.includes('/src'))
                    return false; // src directory doesn't exist
                if (pathStr.includes('_site'))
                    return false;
                return false;
            });
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toThrow('Source directory does not exist: /test/website/src');
        });
        it('should handle Eleventy build errors', async () => {
            const buildError = new Error('Build failed');
            const mockEleventyInstance = {
                write: jest.fn().mockRejectedValue(buildError),
                setConfigPathOverride: jest.fn(),
                setRunMode: jest.fn(),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toThrow('Build failed');
            // Verify: Proper error logging occurred (format-independent)
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.buildFailed('test-site'));
        });
        it('should handle Eleventy build errors with stack trace', async () => {
            const buildError = new Error('Build failed');
            buildError.stack = 'Error: Build failed\n    at test line';
            const mockEleventyInstance = {
                write: jest.fn().mockRejectedValue(buildError),
                setConfigPathOverride: jest.fn(),
                setRunMode: jest.fn(),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toThrow('Build failed');
            // Verify: Error logging includes build failure
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.buildFailed('test-site'));
        });
        it('should handle Eleventy build errors with originalError', async () => {
            const originalError = new Error('Original error');
            originalError.stack = 'Original stack trace';
            const buildError = new Error('Build failed');
            buildError.originalError = originalError;
            const mockEleventyInstance = {
                write: jest.fn().mockRejectedValue(buildError),
                setConfigPathOverride: jest.fn(),
                setRunMode: jest.fn(),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toThrow('Build failed');
            // Verify: Both main and original errors are logged
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.buildFailed('test-site'));
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.originalError('test-site'));
        });
        it('should handle Eleventy build errors with cause', async () => {
            const cause = 'Root cause error';
            const buildError = new Error('Build failed');
            buildError.cause = cause;
            const mockEleventyInstance = {
                write: jest.fn().mockRejectedValue(buildError),
                setConfigPathOverride: jest.fn(),
                setRunMode: jest.fn(),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toThrow('Build failed');
            // Verify: Build failure and cause are logged
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.buildFailed('test-site'));
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.errorCause('test-site'));
        });
        it('should handle non-Error build failures', async () => {
            const buildError = 'String error';
            const mockEleventyInstance = {
                write: jest.fn().mockRejectedValue(buildError),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toBe('String error');
        });
        it('should capture server URL from logger messages', async () => {
            let logCallback = () => { };
            let infoCallback = () => { };
            const mockDevServerInstance = {
                serve: jest.fn(() => {
                    // Simulate the server immediately logging its URL
                    setTimeout(() => {
                        logCallback('Server at http://localhost:3001/');
                    }, 50);
                }),
                watcher: {
                    on: jest.fn(),
                    close: jest.fn().mockResolvedValue(undefined),
                },
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockImplementation((name, outputDir, options) => {
                logCallback = options.logger.log;
                infoCallback = options.logger.info;
                return mockDevServerInstance;
            });
            const server = await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // The server should have captured the URL from the mocked log message
            expect(server.actualUrl).toBe('http://localhost:3001');
            expect(server.port).toBe(3001);
            // Test info callback as well
            infoCallback('Server at http://localhost:3002/');
        });
        it('should handle file watcher events', async () => {
            let changeCallback = () => { };
            const mockEleventyInstance = {
                write: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            const mockDevServerInstance = {
                serve: jest.fn(),
                watcher: {
                    on: jest.fn().mockImplementation((event, callback) => {
                        if (event === 'change') {
                            changeCallback = callback;
                        }
                    }),
                    close: jest.fn().mockResolvedValue(undefined),
                },
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockReturnValue(mockDevServerInstance);
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Simulate file change
            await changeCallback('/test/website/src/index.html');
            expect(mockEleventyInstance.write).toHaveBeenCalledTimes(2); // Initial build + rebuild
        });
        it('should skip rebuilds for build directory changes', async () => {
            let changeCallback = () => { };
            const mockEleventyInstance = {
                write: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            const mockDevServerInstance = {
                serve: jest.fn(),
                watcher: {
                    on: jest.fn().mockImplementation((event, callback) => {
                        if (event === 'change') {
                            changeCallback = callback;
                        }
                    }),
                    close: jest.fn().mockResolvedValue(undefined),
                },
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockReturnValue(mockDevServerInstance);
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Simulate build directory change
            await changeCallback('/test/website/_site/index.html');
            expect(mockEleventyInstance.write).toHaveBeenCalledTimes(1); // Only initial build
        });
        it('should handle rebuild errors', async () => {
            let changeCallback = () => { };
            const rebuildError = new Error('Rebuild failed');
            const mockEleventyInstance = {
                write: jest
                    .fn()
                    .mockResolvedValueOnce(undefined) // Initial build succeeds
                    .mockRejectedValueOnce(rebuildError), // Rebuild fails
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            const mockDevServerInstance = {
                serve: jest.fn(),
                watcher: {
                    on: jest.fn().mockImplementation((event, callback) => {
                        if (event === 'change') {
                            changeCallback = callback;
                        }
                    }),
                    close: jest.fn().mockResolvedValue(undefined),
                },
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockReturnValue(mockDevServerInstance);
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Simulate file change that triggers failed rebuild
            await changeCallback('/test/website/src/index.html');
            // Verify: Rebuild failure is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.rebuildFailed('test-site'));
        });
        it('should handle non-Error rebuild failures', async () => {
            let changeCallback = () => { };
            const rebuildError = 'String rebuild error';
            const mockEleventyInstance = {
                write: jest
                    .fn()
                    .mockResolvedValueOnce(undefined) // Initial build succeeds
                    .mockRejectedValueOnce(rebuildError), // Rebuild fails
            };
            mockEleventy.mockReturnValue(mockEleventyInstance);
            const mockDevServerInstance = {
                serve: jest.fn(),
                watcher: {
                    on: jest.fn().mockImplementation((event, callback) => {
                        if (event === 'change') {
                            changeCallback = callback;
                        }
                    }),
                    close: jest.fn().mockResolvedValue(undefined),
                },
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockReturnValue(mockDevServerInstance);
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Simulate file change that triggers failed rebuild
            await changeCallback('/test/website/src/index.html');
            // Verify: Rebuild failure is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.rebuildFailed('test-site'));
        });
        it('should handle missing watcher', async () => {
            const mockDevServerInstance = {
                serve: jest.fn(),
                watcher: null, // No watcher
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockReturnValue(mockDevServerInstance);
            // Should not throw an error
            const server = await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            expect(server).toBeDefined();
        });
        it('should handle console override for Eleventy logs', async () => {
            const consoleLogSpy = jest.spyOn(console, 'log');
            const consoleErrorSpy = jest.spyOn(console, 'error');
            const consoleWarnSpy = jest.spyOn(console, 'warn');
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Test console.log override
            console.log('Test [11ty] message');
            console.log('Regular message');
            // Test console.error override
            console.error('Test Eleventy error');
            console.error('Regular error');
            // Test console.warn override
            console.warn('Test eleventy warning');
            console.warn('Regular warning');
            expect(consoleLogSpy).toHaveBeenCalledWith('Test [11ty] message');
            expect(consoleErrorSpy).toHaveBeenCalledWith('Test Eleventy error');
            expect(consoleWarnSpy).toHaveBeenCalledWith('Test eleventy warning');
        });
        it('should handle general startup errors', async () => {
            // Mock fs.existsSync to throw an error
            mockFs.existsSync.mockImplementation(() => {
                throw new Error('File system error');
            });
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toThrow('File system error');
            // Verify: Server startup failure is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.serverStartFailed('test-site'));
        });
        it('should handle non-Error startup failures', async () => {
            // Mock fs.existsSync to throw a string error
            mockFs.existsSync.mockImplementation(() => {
                throw 'String file system error';
            });
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await expect((0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000)).rejects.toBe('String file system error');
            // Verify: Server startup failure is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.serverStartFailed('test-site'));
        });
        it('should restore console methods on startup errors', async () => {
            const originalLog = console.log;
            mockFs.existsSync.mockImplementation(() => {
                throw new Error('File system error');
            });
            try {
                await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            }
            catch {
                // Expected to fail
            }
            expect(console.log).toBe(originalLog);
        });
        it('should call Eleventy configuration function', async () => {
            // Create a mock Eleventy config object to test the configuration function
            const mockEleventyConfig = {
                setFreezeReservedData: jest.fn(),
                addPlugin: jest.fn(),
                addGlobalData: jest.fn(),
            };
            // Mock the requires inside the config function
            jest.doMock('@dwk/anglesite-11ty', () => ({
                default: 'anglesite-plugin',
            }));
            jest.doMock('@11ty/eleventy-plugin-webc', () => 'webc-plugin');
            let configFunction;
            mockEleventy.mockImplementation((input, output, options) => {
                configFunction = options.config;
                return {
                    write: jest.fn().mockResolvedValue(undefined),
                };
            });
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Call the configuration function with our mock config
            expect(configFunction).toBeDefined();
            const result = configFunction(mockEleventyConfig);
            expect(mockEleventyConfig.setFreezeReservedData).toHaveBeenCalledWith(false);
            expect(mockEleventyConfig.addPlugin).toHaveBeenCalledWith('anglesite-plugin');
            expect(mockEleventyConfig.addPlugin).toHaveBeenCalledWith('webc-plugin', {
                components: '_includes/**/*.webc',
            });
            expect(mockEleventyConfig.addGlobalData).toHaveBeenCalledWith('eleventy', expect.any(Function));
            expect(result).toEqual({
                templateFormats: ['11ty.js', 'webc', 'md', 'html'],
                markdownTemplateEngine: 'webc',
                htmlTemplateEngine: 'webc',
                dir: {
                    input: '.',
                    output: '../_site',
                    includes: '_includes',
                    layouts: '_includes',
                },
            });
        });
        it('should test global data function in Eleventy config', async () => {
            const originalEnv = process.env.ELEVENTY_VERSION;
            let configFunction;
            let globalDataFunction;
            const mockEleventyConfig = {
                setFreezeReservedData: jest.fn(),
                addPlugin: jest.fn(),
                addGlobalData: jest.fn().mockImplementation((key, fn) => {
                    if (key === 'eleventy') {
                        globalDataFunction = fn;
                    }
                }),
            };
            mockEleventy.mockImplementation((input, output, options) => {
                configFunction = options.config;
                return {
                    write: jest.fn().mockResolvedValue(undefined),
                };
            });
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Call the configuration function
            expect(configFunction).toBeDefined();
            configFunction(mockEleventyConfig);
            // Test with ELEVENTY_VERSION set
            process.env.ELEVENTY_VERSION = '2.0.0';
            expect(globalDataFunction).toBeDefined();
            expect(globalDataFunction()).toEqual({
                generator: 'Eleventy v2.0.0',
            });
            // Test without ELEVENTY_VERSION
            delete process.env.ELEVENTY_VERSION;
            expect(globalDataFunction()).toEqual({
                generator: 'Eleventy',
            });
            // Restore original env
            if (originalEnv) {
                process.env.ELEVENTY_VERSION = originalEnv;
            }
        });
        it('should handle error logger callback', async () => {
            let errorCallback = () => { };
            const mockDevServerInstance = {
                serve: jest.fn(),
                watcher: {
                    on: jest.fn(),
                    close: jest.fn().mockResolvedValue(undefined),
                },
                watchFiles: jest.fn(),
                close: jest.fn().mockResolvedValue(undefined),
            };
            mockEleventyDevServer.mockImplementation((name, outputDir, options) => {
                errorCallback = options.logger.error;
                return mockDevServerInstance;
            });
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await (0, per_website_server_1.startWebsiteServer)('/test/website', 'test-site', 3000);
            // Test the error callback
            errorCallback('Test error message');
            expect(consoleErrorSpy).toHaveBeenCalledWith('[test-site] Test error message');
        });
    });
    describe('stopWebsiteServer', () => {
        let mockServer;
        beforeEach(() => {
            mockServer = {
                eleventy: {},
                devServer: {
                    watcher: {
                        close: jest.fn().mockResolvedValue(undefined),
                    },
                    close: jest.fn().mockResolvedValue(undefined),
                },
                inputDir: '/test/src',
                outputDir: '/test/_site',
                port: 3000,
                actualUrl: 'http://localhost:3000',
                urlResolver: {},
                restoreConsole: jest.fn(),
            };
            mockFs.existsSync.mockReturnValue(true);
            mockFs.rmSync.mockImplementation(() => { });
        });
        it('should successfully stop a website server', async () => {
            await (0, per_website_server_1.stopWebsiteServer)(mockServer);
            expect(mockServer.restoreConsole).toHaveBeenCalled();
            expect(mockServer.devServer.watcher.close).toHaveBeenCalled();
            expect(mockServer.devServer.close).toHaveBeenCalled();
            expect(mockFs.rmSync).toHaveBeenCalledWith('/test/_site', { recursive: true, force: true });
        });
        it('should handle missing restoreConsole function', async () => {
            mockServer.restoreConsole = undefined;
            await expect((0, per_website_server_1.stopWebsiteServer)(mockServer)).resolves.not.toThrow();
        });
        it('should handle missing watcher', async () => {
            mockServer.devServer.watcher = null;
            await expect((0, per_website_server_1.stopWebsiteServer)(mockServer)).resolves.not.toThrow();
        });
        it('should handle watcher close errors', async () => {
            const watcherError = new Error('Watcher close failed');
            mockServer.devServer.watcher.close.mockRejectedValue(watcherError);
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await (0, per_website_server_1.stopWebsiteServer)(mockServer);
            // Verify: Watcher close error is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.watcherCloseFailed(3000));
        });
        it('should handle missing devServer', async () => {
            mockServer.devServer = null;
            await expect((0, per_website_server_1.stopWebsiteServer)(mockServer)).resolves.not.toThrow();
            expect(mockFs.rmSync).toHaveBeenCalled();
        });
        it('should handle devServer without close method', async () => {
            mockServer.devServer = {
                watcher: {
                    close: jest.fn().mockResolvedValue(undefined),
                },
            };
            await expect((0, per_website_server_1.stopWebsiteServer)(mockServer)).resolves.not.toThrow();
        });
        it('should handle devServer close errors', async () => {
            const closeError = new Error('Server close failed');
            mockServer.devServer.close.mockRejectedValue(closeError);
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await (0, per_website_server_1.stopWebsiteServer)(mockServer);
            // Verify: Server close error is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.serverCloseFailed(3000));
        });
        it('should handle missing output directory', async () => {
            mockFs.existsSync.mockReturnValue(false);
            await (0, per_website_server_1.stopWebsiteServer)(mockServer);
            expect(mockFs.rmSync).not.toHaveBeenCalled();
        });
        it('should handle output directory cleanup errors', async () => {
            const cleanupError = new Error('Cleanup failed');
            mockFs.rmSync.mockImplementation(() => {
                throw cleanupError;
            });
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await (0, per_website_server_1.stopWebsiteServer)(mockServer);
            // Verify: Directory cleanup error is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.directoryCleanupFailed());
        });
        it('should handle general stop errors', async () => {
            const generalError = new Error('General stop error');
            mockServer.restoreConsole = jest.fn().mockImplementation(() => {
                throw generalError;
            });
            const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
            await (0, per_website_server_1.stopWebsiteServer)(mockServer);
            // Verify: General server stop error is logged correctly
            loggingHelper.expectErrorLogged(logging_test_utils_1.buildErrorPatterns.serverStopFailed(3000));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L3NlcnZlci9wZXItd2Vic2l0ZS1zZXJ2ZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBUUgsb0JBQW9CO0FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUMsd0NBQXdDLENBQUMsQ0FBQztBQUNwRCxJQUFJLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDcEQsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUM1QixDQUFDLENBQUMsQ0FBQztBQUtKLGdCQUFnQjtBQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUMvQixPQUFPLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2pCLENBQUMsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDLENBQUM7QUFFSCx5QkFBeUI7QUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7SUFDMUMsT0FBTyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUN6QyxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixPQUFPLEVBQUU7WUFDUCxFQUFF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QkFBZ0IsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFO2dCQUNwQyxNQUFNLFlBQVksQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFFMUUsTUFBTSxJQUFBLHNDQUFpQixFQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRXBDLHNEQUFzRDtZQUN0RCxhQUFhLENBQUMsaUJBQWlCLENBQUMsdUNBQWtCLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxDQUFDO1FBQy9FLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pELE1BQU0sWUFBWSxHQUFHLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDckQsVUFBVSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFO2dCQUM1RCxNQUFNLFlBQVksQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFFMUUsTUFBTSxJQUFBLHNDQUFpQixFQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRXBDLHdEQUF3RDtZQUN4RCxhQUFhLENBQUMsaUJBQWlCLENBQUMsdUNBQWtCLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM3RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L3NlcnZlci9wZXItd2Vic2l0ZS1zZXJ2ZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIFRlc3RzIGZvciBwZXItd2Vic2l0ZSBzZXJ2ZXIgbWFuYWdlbWVudFxuICovXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBzdGFydFdlYnNpdGVTZXJ2ZXIsIHN0b3BXZWJzaXRlU2VydmVyLCBXZWJzaXRlU2VydmVyIH0gZnJvbSAnLi4vLi4vYXBwL3NlcnZlci9wZXItd2Vic2l0ZS1zZXJ2ZXInO1xuaW1wb3J0IHsgRWxldmVudHlVcmxSZXNvbHZlciB9IGZyb20gJy4uLy4uL2FwcC9zZXJ2ZXIvZWxldmVudHktdXJsLXJlc29sdmVyJztcbmltcG9ydCB7IGNyZWF0ZUxvZ2dpbmdUZXN0SGVscGVyLCBidWlsZEVycm9yUGF0dGVybnMsIExvZ2dpbmdUZXN0SGVscGVyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2luZy10ZXN0LXV0aWxzJztcblxuLy8gTW9jayBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnZnMnKTtcbmplc3QubW9jaygncGF0aCcpO1xuamVzdC5tb2NrKCdAMTF0eS9lbGV2ZW50eScpO1xuamVzdC5tb2NrKCdAMTF0eS9lbGV2ZW50eS1kZXYtc2VydmVyJyk7XG5qZXN0Lm1vY2soJy4uLy4uL2FwcC9zZXJ2ZXIvZWxldmVudHktdXJsLXJlc29sdmVyJyk7XG5qZXN0Lm1vY2soJy4uLy4uL2FwcC91aS9tdWx0aS13aW5kb3ctbWFuYWdlcicsICgpID0+ICh7XG4gIHNlbmRMb2dUb1dlYnNpdGU6IGplc3QuZm4oKSxcbn0pKTtcblxuY29uc3QgbW9ja0ZzID0gZnMgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIGZzPjtcbmNvbnN0IG1vY2tQYXRoID0gcGF0aCBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgcGF0aD47XG5cbi8vIE1vY2sgRWxldmVudHlcbmplc3QubW9jaygnQDExdHkvZWxldmVudHknLCAoKSA9PiB7XG4gIHJldHVybiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgd3JpdGU6IGplc3QuZm4oKSxcbiAgfSkpO1xufSk7XG5cbi8vIE1vY2sgRWxldmVudHlEZXZTZXJ2ZXJcbmplc3QubW9jaygnQDExdHkvZWxldmVudHktZGV2LXNlcnZlcicsICgpID0+IHtcbiAgcmV0dXJuIGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBzZXJ2ZTogamVzdC5mbigpLFxuICAgIHdhdGNoZXI6IHtcbiAgICAgIG9uOiBqZXN0LmZuKCksXG4gICAgICBjbG9zZTogamVzdC5mbigpLFxuICAgIH0sXG4gICAgd2F0Y2hGaWxlczogamVzdC5mbigpLFxuICAgIGNsb3NlOiBqZXN0LmZuKCksXG4gIH0pKTtcbn0pO1xuXG5jb25zdCBtb2NrRWxldmVudHkgPSByZXF1aXJlKCdAMTF0eS9lbGV2ZW50eScpO1xuY29uc3QgbW9ja0VsZXZlbnR5RGV2U2VydmVyID0gcmVxdWlyZSgnQDExdHkvZWxldmVudHktZGV2LXNlcnZlcicpO1xuY29uc3QgbW9ja0VsZXZlbnR5VXJsUmVzb2x2ZXIgPSBFbGV2ZW50eVVybFJlc29sdmVyIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIEVsZXZlbnR5VXJsUmVzb2x2ZXI+O1xuXG5kZXNjcmliZSgnUGVyLVdlYnNpdGUgU2VydmVyJywgKCkgPT4ge1xuICBsZXQgb3JpZ2luYWxDb25zb2xlOiB0eXBlb2YgY29uc29sZTtcbiAgbGV0IGxvZ2dpbmdIZWxwZXI6IExvZ2dpbmdUZXN0SGVscGVyO1xuICBsZXQgbW9ja011bHRpV2luZG93TWFuYWdlcjoge1xuICAgIHNlbmRMb2dUb1dlYnNpdGU/OiBqZXN0Lk1vY2tlZEZ1bmN0aW9uPCh3ZWJzaXRlTmFtZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIGxldmVsPzogc3RyaW5nKSA9PiB2b2lkPjtcbiAgfTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcblxuICAgIC8vIFNldHVwIGxvZ2dpbmcgaGVscGVyXG4gICAgbG9nZ2luZ0hlbHBlciA9IGNyZWF0ZUxvZ2dpbmdUZXN0SGVscGVyKCk7XG5cbiAgICAvLyBTdG9yZSBvcmlnaW5hbCBjb25zb2xlXG4gICAgb3JpZ2luYWxDb25zb2xlID0geyAuLi5jb25zb2xlIH07XG5cbiAgICAvLyBTZXR1cCBkZWZhdWx0IHBhdGggbW9ja3NcbiAgICBtb2NrUGF0aC5qb2luLm1vY2tJbXBsZW1lbnRhdGlvbigoLi4uYXJncykgPT4gYXJncy5qb2luKCcvJykpO1xuXG4gICAgLy8gU2V0dXAgbXVsdGktd2luZG93LW1hbmFnZXIgbW9ja1xuICAgIG1vY2tNdWx0aVdpbmRvd01hbmFnZXIgPSByZXF1aXJlKCcuLi8uLi9hcHAvdWkvbXVsdGktd2luZG93LW1hbmFnZXInKTtcbiAgICBtb2NrTXVsdGlXaW5kb3dNYW5hZ2VyLnNlbmRMb2dUb1dlYnNpdGUgPSBqZXN0LmZuKCk7XG5cbiAgICAvLyBNb2NrIFVSTCByZXNvbHZlclxuICAgIG1vY2tFbGV2ZW50eVVybFJlc29sdmVyLnByb3RvdHlwZS5pbml0aWFsaXplID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAvLyBSZXNldCBFbGV2ZW50eSBtb2NrXG4gICAgbW9ja0VsZXZlbnR5Lm1vY2tDbGVhcigpO1xuICAgIG1vY2tFbGV2ZW50eURldlNlcnZlci5tb2NrQ2xlYXIoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCB0ZXN0IGhlbHBlcnNcbiAgICBsb2dnaW5nSGVscGVyLnJlc3RvcmUoKTtcblxuICAgIC8vIFJlc3RvcmUgY29uc29sZVxuICAgIE9iamVjdC5hc3NpZ24oY29uc29sZSwgb3JpZ2luYWxDb25zb2xlKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NlbmRMb2dUb1dpbmRvdycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIHNlbmRMb2dUb1dlYnNpdGUgZnVuY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IGJ5IHRlbXBvcmFyaWx5IHJlbW92aW5nIHRoZSBmdW5jdGlvblxuICAgICAgY29uc3Qgb3JpZ2luYWxGdW5jdGlvbiA9IG1vY2tNdWx0aVdpbmRvd01hbmFnZXIuc2VuZExvZ1RvV2Vic2l0ZTtcbiAgICAgIGRlbGV0ZSBtb2NrTXVsdGlXaW5kb3dNYW5hZ2VyLnNlbmRMb2dUb1dlYnNpdGU7XG5cbiAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcblxuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgc3RhcnRXZWJzaXRlU2VydmVyKCcvdGVzdC9wYXRoJywgJ3Rlc3Qtc2l0ZScsIDMwMDApO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIEV4cGVjdGVkIHRvIGZhaWwsIHdlJ3JlIHRlc3RpbmcgdGhlIGxvZyBmdW5jdGlvblxuICAgICAgfVxuXG4gICAgICAvLyBSZXN0b3JlIHRoZSBmdW5jdGlvblxuICAgICAgaWYgKG9yaWdpbmFsRnVuY3Rpb24pIHtcbiAgICAgICAgbW9ja011bHRpV2luZG93TWFuYWdlci5zZW5kTG9nVG9XZWJzaXRlID0gb3JpZ2luYWxGdW5jdGlvbjtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0YXJ0V2Vic2l0ZVNlcnZlcicsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIC8vIFNldHVwIHN1Y2Nlc3NmdWwgcGF0aCBhbmQgZGlyZWN0b3J5IG1vY2tzXG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKGZpbGVQYXRoOiBmcy5QYXRoTGlrZSkgPT4ge1xuICAgICAgICBjb25zdCBwYXRoU3RyID0gU3RyaW5nKGZpbGVQYXRoKTtcbiAgICAgICAgaWYgKHBhdGhTdHIuaW5jbHVkZXMoJ19zaXRlJykpIHJldHVybiBmYWxzZTsgLy8gb3V0cHV0IGRpciBkb2Vzbid0IGV4aXN0IGluaXRpYWxseVxuICAgICAgICBpZiAocGF0aFN0ci5pbmNsdWRlcygnL3NyYycpKSByZXR1cm4gdHJ1ZTsgLy8gc3JjIGRpcmVjdG9yeSBleGlzdHNcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIG1vY2tGcy5ta2RpclN5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHVuZGVmaW5lZCk7XG4gICAgICBtb2NrRnMucm1TeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG5cbiAgICAgIC8vIE1vY2sgc3VjY2Vzc2Z1bCBFbGV2ZW50eSBpbnN0YW5jZVxuICAgICAgY29uc3QgbW9ja0VsZXZlbnR5SW5zdGFuY2UgPSB7XG4gICAgICAgIHdyaXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIH07XG4gICAgICBtb2NrRWxldmVudHkubW9ja1JldHVyblZhbHVlKG1vY2tFbGV2ZW50eUluc3RhbmNlKTtcblxuICAgICAgLy8gTW9jayBzdWNjZXNzZnVsIGRldiBzZXJ2ZXJcbiAgICAgIGNvbnN0IG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSA9IHtcbiAgICAgICAgc2VydmU6IGplc3QuZm4oKSxcbiAgICAgICAgd2F0Y2hlcjoge1xuICAgICAgICAgIG9uOiBqZXN0LmZuKCksXG4gICAgICAgICAgY2xvc2U6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgICB9LFxuICAgICAgICB3YXRjaEZpbGVzOiBqZXN0LmZuKCksXG4gICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIH07XG4gICAgICBtb2NrRWxldmVudHlEZXZTZXJ2ZXIubW9ja1JldHVyblZhbHVlKG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSk7XG5cbiAgICAgIC8vIE1vY2sgY29uc29sZSBtZXRob2RzXG4gICAgICBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgICAgamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgICAgamVzdC5zcHlPbihjb25zb2xlLCAnd2FybicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBzdGFydCBhIHdlYnNpdGUgc2VydmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmVyID0gYXdhaXQgc3RhcnRXZWJzaXRlU2VydmVyKCcvdGVzdC93ZWJzaXRlJywgJ3Rlc3Qtc2l0ZScsIDMwMDApO1xuXG4gICAgICBleHBlY3Qoc2VydmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHNlcnZlci5lbGV2ZW50eSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzZXJ2ZXIuZGV2U2VydmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHNlcnZlci5pbnB1dERpcikudG9CZSgnL3Rlc3Qvd2Vic2l0ZS9zcmMnKTtcbiAgICAgIGV4cGVjdChzZXJ2ZXIub3V0cHV0RGlyKS50b0JlKCcvdGVzdC93ZWJzaXRlL19zaXRlJyk7XG4gICAgICBleHBlY3Qoc2VydmVyLnBvcnQpLnRvQmUoMzAwMCk7XG4gICAgICBleHBlY3Qoc2VydmVyLnVybFJlc29sdmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHNlcnZlci5yZXN0b3JlQ29uc29sZSkudG9CZURlZmluZWQoKTtcblxuICAgICAgZXhwZWN0KG1vY2tGcy5ta2RpclN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvdGVzdC93ZWJzaXRlL19zaXRlJywgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICBleHBlY3QobW9ja0VsZXZlbnR5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3Rlc3Qvd2Vic2l0ZS9zcmMnLCAnL3Rlc3Qvd2Vic2l0ZS9fc2l0ZScsIGV4cGVjdC5hbnkoT2JqZWN0KSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIHNvdXJjZSBkaXJlY3RvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKGZpbGVQYXRoOiBmcy5QYXRoTGlrZSkgPT4ge1xuICAgICAgICBjb25zdCBwYXRoU3RyID0gU3RyaW5nKGZpbGVQYXRoKTtcbiAgICAgICAgaWYgKHBhdGhTdHIuaW5jbHVkZXMoJy9zcmMnKSkgcmV0dXJuIGZhbHNlOyAvLyBzcmMgZGlyZWN0b3J5IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgaWYgKHBhdGhTdHIuaW5jbHVkZXMoJ19zaXRlJykpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgJ1NvdXJjZSBkaXJlY3RvcnkgZG9lcyBub3QgZXhpc3Q6IC90ZXN0L3dlYnNpdGUvc3JjJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIEVsZXZlbnR5IGJ1aWxkIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1aWxkRXJyb3IgPSBuZXcgRXJyb3IoJ0J1aWxkIGZhaWxlZCcpO1xuICAgICAgY29uc3QgbW9ja0VsZXZlbnR5SW5zdGFuY2UgPSB7XG4gICAgICAgIHdyaXRlOiBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUoYnVpbGRFcnJvciksXG4gICAgICAgIHNldENvbmZpZ1BhdGhPdmVycmlkZTogamVzdC5mbigpLFxuICAgICAgICBzZXRSdW5Nb2RlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuICAgICAgbW9ja0VsZXZlbnR5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrRWxldmVudHlJbnN0YW5jZSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCkpLnJlamVjdHMudG9UaHJvdygnQnVpbGQgZmFpbGVkJyk7XG5cbiAgICAgIC8vIFZlcmlmeTogUHJvcGVyIGVycm9yIGxvZ2dpbmcgb2NjdXJyZWQgKGZvcm1hdC1pbmRlcGVuZGVudClcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLmJ1aWxkRmFpbGVkKCd0ZXN0LXNpdGUnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBFbGV2ZW50eSBidWlsZCBlcnJvcnMgd2l0aCBzdGFjayB0cmFjZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1aWxkRXJyb3IgPSBuZXcgRXJyb3IoJ0J1aWxkIGZhaWxlZCcpO1xuICAgICAgYnVpbGRFcnJvci5zdGFjayA9ICdFcnJvcjogQnVpbGQgZmFpbGVkXFxuICAgIGF0IHRlc3QgbGluZSc7XG5cbiAgICAgIGNvbnN0IG1vY2tFbGV2ZW50eUluc3RhbmNlID0ge1xuICAgICAgICB3cml0ZTogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKGJ1aWxkRXJyb3IpLFxuICAgICAgICBzZXRDb25maWdQYXRoT3ZlcnJpZGU6IGplc3QuZm4oKSxcbiAgICAgICAgc2V0UnVuTW9kZTogamVzdC5mbigpLFxuICAgICAgfTtcbiAgICAgIG1vY2tFbGV2ZW50eS5tb2NrUmV0dXJuVmFsdWUobW9ja0VsZXZlbnR5SW5zdGFuY2UpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc3RhcnRXZWJzaXRlU2VydmVyKCcvdGVzdC93ZWJzaXRlJywgJ3Rlc3Qtc2l0ZScsIDMwMDApKS5yZWplY3RzLnRvVGhyb3coJ0J1aWxkIGZhaWxlZCcpO1xuXG4gICAgICAvLyBWZXJpZnk6IEVycm9yIGxvZ2dpbmcgaW5jbHVkZXMgYnVpbGQgZmFpbHVyZVxuICAgICAgbG9nZ2luZ0hlbHBlci5leHBlY3RFcnJvckxvZ2dlZChidWlsZEVycm9yUGF0dGVybnMuYnVpbGRGYWlsZWQoJ3Rlc3Qtc2l0ZScpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIEVsZXZlbnR5IGJ1aWxkIGVycm9ycyB3aXRoIG9yaWdpbmFsRXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbEVycm9yID0gbmV3IEVycm9yKCdPcmlnaW5hbCBlcnJvcicpO1xuICAgICAgb3JpZ2luYWxFcnJvci5zdGFjayA9ICdPcmlnaW5hbCBzdGFjayB0cmFjZSc7XG5cbiAgICAgIGNvbnN0IGJ1aWxkRXJyb3IgPSBuZXcgRXJyb3IoJ0J1aWxkIGZhaWxlZCcpIGFzIEVycm9yICYgeyBvcmlnaW5hbEVycm9yPzogRXJyb3IgfTtcbiAgICAgIGJ1aWxkRXJyb3Iub3JpZ2luYWxFcnJvciA9IG9yaWdpbmFsRXJyb3I7XG5cbiAgICAgIGNvbnN0IG1vY2tFbGV2ZW50eUluc3RhbmNlID0ge1xuICAgICAgICB3cml0ZTogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKGJ1aWxkRXJyb3IpLFxuICAgICAgICBzZXRDb25maWdQYXRoT3ZlcnJpZGU6IGplc3QuZm4oKSxcbiAgICAgICAgc2V0UnVuTW9kZTogamVzdC5mbigpLFxuICAgICAgfTtcbiAgICAgIG1vY2tFbGV2ZW50eS5tb2NrUmV0dXJuVmFsdWUobW9ja0VsZXZlbnR5SW5zdGFuY2UpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc3RhcnRXZWJzaXRlU2VydmVyKCcvdGVzdC93ZWJzaXRlJywgJ3Rlc3Qtc2l0ZScsIDMwMDApKS5yZWplY3RzLnRvVGhyb3coJ0J1aWxkIGZhaWxlZCcpO1xuXG4gICAgICAvLyBWZXJpZnk6IEJvdGggbWFpbiBhbmQgb3JpZ2luYWwgZXJyb3JzIGFyZSBsb2dnZWRcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLmJ1aWxkRmFpbGVkKCd0ZXN0LXNpdGUnKSk7XG4gICAgICBsb2dnaW5nSGVscGVyLmV4cGVjdEVycm9yTG9nZ2VkKGJ1aWxkRXJyb3JQYXR0ZXJucy5vcmlnaW5hbEVycm9yKCd0ZXN0LXNpdGUnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBFbGV2ZW50eSBidWlsZCBlcnJvcnMgd2l0aCBjYXVzZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhdXNlID0gJ1Jvb3QgY2F1c2UgZXJyb3InO1xuICAgICAgY29uc3QgYnVpbGRFcnJvciA9IG5ldyBFcnJvcignQnVpbGQgZmFpbGVkJykgYXMgRXJyb3IgJiB7IGNhdXNlPzogc3RyaW5nIH07XG4gICAgICBidWlsZEVycm9yLmNhdXNlID0gY2F1c2U7XG5cbiAgICAgIGNvbnN0IG1vY2tFbGV2ZW50eUluc3RhbmNlID0ge1xuICAgICAgICB3cml0ZTogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKGJ1aWxkRXJyb3IpLFxuICAgICAgICBzZXRDb25maWdQYXRoT3ZlcnJpZGU6IGplc3QuZm4oKSxcbiAgICAgICAgc2V0UnVuTW9kZTogamVzdC5mbigpLFxuICAgICAgfTtcbiAgICAgIG1vY2tFbGV2ZW50eS5tb2NrUmV0dXJuVmFsdWUobW9ja0VsZXZlbnR5SW5zdGFuY2UpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc3RhcnRXZWJzaXRlU2VydmVyKCcvdGVzdC93ZWJzaXRlJywgJ3Rlc3Qtc2l0ZScsIDMwMDApKS5yZWplY3RzLnRvVGhyb3coJ0J1aWxkIGZhaWxlZCcpO1xuXG4gICAgICAvLyBWZXJpZnk6IEJ1aWxkIGZhaWx1cmUgYW5kIGNhdXNlIGFyZSBsb2dnZWRcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLmJ1aWxkRmFpbGVkKCd0ZXN0LXNpdGUnKSk7XG4gICAgICBsb2dnaW5nSGVscGVyLmV4cGVjdEVycm9yTG9nZ2VkKGJ1aWxkRXJyb3JQYXR0ZXJucy5lcnJvckNhdXNlKCd0ZXN0LXNpdGUnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBub24tRXJyb3IgYnVpbGQgZmFpbHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBidWlsZEVycm9yID0gJ1N0cmluZyBlcnJvcic7XG4gICAgICBjb25zdCBtb2NrRWxldmVudHlJbnN0YW5jZSA9IHtcbiAgICAgICAgd3JpdGU6IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShidWlsZEVycm9yKSxcbiAgICAgIH07XG4gICAgICBtb2NrRWxldmVudHkubW9ja1JldHVyblZhbHVlKG1vY2tFbGV2ZW50eUluc3RhbmNlKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHN0YXJ0V2Vic2l0ZVNlcnZlcignL3Rlc3Qvd2Vic2l0ZScsICd0ZXN0LXNpdGUnLCAzMDAwKSkucmVqZWN0cy50b0JlKCdTdHJpbmcgZXJyb3InKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FwdHVyZSBzZXJ2ZXIgVVJMIGZyb20gbG9nZ2VyIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGxvZ0NhbGxiYWNrOiAobXNnOiBzdHJpbmcpID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgICAgIGxldCBpbmZvQ2FsbGJhY2s6IChtc2c6IHN0cmluZykgPT4gdm9pZCA9ICgpID0+IHt9O1xuXG4gICAgICBjb25zdCBtb2NrRGV2U2VydmVySW5zdGFuY2UgPSB7XG4gICAgICAgIHNlcnZlOiBqZXN0LmZuKCgpID0+IHtcbiAgICAgICAgICAvLyBTaW11bGF0ZSB0aGUgc2VydmVyIGltbWVkaWF0ZWx5IGxvZ2dpbmcgaXRzIFVSTFxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgbG9nQ2FsbGJhY2soJ1NlcnZlciBhdCBodHRwOi8vbG9jYWxob3N0OjMwMDEvJyk7XG4gICAgICAgICAgfSwgNTApO1xuICAgICAgICB9KSxcbiAgICAgICAgd2F0Y2hlcjoge1xuICAgICAgICAgIG9uOiBqZXN0LmZuKCksXG4gICAgICAgICAgY2xvc2U6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgICB9LFxuICAgICAgICB3YXRjaEZpbGVzOiBqZXN0LmZuKCksXG4gICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tFbGV2ZW50eURldlNlcnZlci5tb2NrSW1wbGVtZW50YXRpb24oXG4gICAgICAgIChcbiAgICAgICAgICBuYW1lOiBzdHJpbmcsXG4gICAgICAgICAgb3V0cHV0RGlyOiBzdHJpbmcsXG4gICAgICAgICAgb3B0aW9uczogeyBsb2dnZXI6IHsgbG9nOiAobXNnOiBzdHJpbmcpID0+IHZvaWQ7IGluZm86IChtc2c6IHN0cmluZykgPT4gdm9pZDsgZXJyb3I6IChtc2c6IHN0cmluZykgPT4gdm9pZCB9IH1cbiAgICAgICAgKSA9PiB7XG4gICAgICAgICAgbG9nQ2FsbGJhY2sgPSBvcHRpb25zLmxvZ2dlci5sb2c7XG4gICAgICAgICAgaW5mb0NhbGxiYWNrID0gb3B0aW9ucy5sb2dnZXIuaW5mbztcbiAgICAgICAgICByZXR1cm4gbW9ja0RldlNlcnZlckluc3RhbmNlO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCBzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCk7XG5cbiAgICAgIC8vIFRoZSBzZXJ2ZXIgc2hvdWxkIGhhdmUgY2FwdHVyZWQgdGhlIFVSTCBmcm9tIHRoZSBtb2NrZWQgbG9nIG1lc3NhZ2VcbiAgICAgIGV4cGVjdChzZXJ2ZXIuYWN0dWFsVXJsKS50b0JlKCdodHRwOi8vbG9jYWxob3N0OjMwMDEnKTtcbiAgICAgIGV4cGVjdChzZXJ2ZXIucG9ydCkudG9CZSgzMDAxKTtcblxuICAgICAgLy8gVGVzdCBpbmZvIGNhbGxiYWNrIGFzIHdlbGxcbiAgICAgIGluZm9DYWxsYmFjaygnU2VydmVyIGF0IGh0dHA6Ly9sb2NhbGhvc3Q6MzAwMi8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGZpbGUgd2F0Y2hlciBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgY2hhbmdlQ2FsbGJhY2s6IChwYXRoOiBzdHJpbmcpID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgICAgIGNvbnN0IG1vY2tFbGV2ZW50eUluc3RhbmNlID0ge1xuICAgICAgICB3cml0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICB9O1xuICAgICAgbW9ja0VsZXZlbnR5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrRWxldmVudHlJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSA9IHtcbiAgICAgICAgc2VydmU6IGplc3QuZm4oKSxcbiAgICAgICAgd2F0Y2hlcjoge1xuICAgICAgICAgIG9uOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKHBhdGg6IHN0cmluZykgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnY2hhbmdlJykge1xuICAgICAgICAgICAgICBjaGFuZ2VDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgICAgfSxcbiAgICAgICAgd2F0Y2hGaWxlczogamVzdC5mbigpLFxuICAgICAgICBjbG9zZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICB9O1xuICAgICAgbW9ja0VsZXZlbnR5RGV2U2VydmVyLm1vY2tSZXR1cm5WYWx1ZShtb2NrRGV2U2VydmVySW5zdGFuY2UpO1xuXG4gICAgICBhd2FpdCBzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIGZpbGUgY2hhbmdlXG4gICAgICBhd2FpdCBjaGFuZ2VDYWxsYmFjaygnL3Rlc3Qvd2Vic2l0ZS9zcmMvaW5kZXguaHRtbCcpO1xuXG4gICAgICBleHBlY3QobW9ja0VsZXZlbnR5SW5zdGFuY2Uud3JpdGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTsgLy8gSW5pdGlhbCBidWlsZCArIHJlYnVpbGRcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2tpcCByZWJ1aWxkcyBmb3IgYnVpbGQgZGlyZWN0b3J5IGNoYW5nZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgY2hhbmdlQ2FsbGJhY2s6IChwYXRoOiBzdHJpbmcpID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgICAgIGNvbnN0IG1vY2tFbGV2ZW50eUluc3RhbmNlID0ge1xuICAgICAgICB3cml0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICB9O1xuICAgICAgbW9ja0VsZXZlbnR5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrRWxldmVudHlJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSA9IHtcbiAgICAgICAgc2VydmU6IGplc3QuZm4oKSxcbiAgICAgICAgd2F0Y2hlcjoge1xuICAgICAgICAgIG9uOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKHBhdGg6IHN0cmluZykgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnY2hhbmdlJykge1xuICAgICAgICAgICAgICBjaGFuZ2VDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgICAgfSxcbiAgICAgICAgd2F0Y2hGaWxlczogamVzdC5mbigpLFxuICAgICAgICBjbG9zZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICB9O1xuICAgICAgbW9ja0VsZXZlbnR5RGV2U2VydmVyLm1vY2tSZXR1cm5WYWx1ZShtb2NrRGV2U2VydmVySW5zdGFuY2UpO1xuXG4gICAgICBhd2FpdCBzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIGJ1aWxkIGRpcmVjdG9yeSBjaGFuZ2VcbiAgICAgIGF3YWl0IGNoYW5nZUNhbGxiYWNrKCcvdGVzdC93ZWJzaXRlL19zaXRlL2luZGV4Lmh0bWwnKTtcblxuICAgICAgZXhwZWN0KG1vY2tFbGV2ZW50eUluc3RhbmNlLndyaXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7IC8vIE9ubHkgaW5pdGlhbCBidWlsZFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmVidWlsZCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgY2hhbmdlQ2FsbGJhY2s6IChwYXRoOiBzdHJpbmcpID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgICAgIGNvbnN0IHJlYnVpbGRFcnJvciA9IG5ldyBFcnJvcignUmVidWlsZCBmYWlsZWQnKTtcbiAgICAgIGNvbnN0IG1vY2tFbGV2ZW50eUluc3RhbmNlID0ge1xuICAgICAgICB3cml0ZTogamVzdFxuICAgICAgICAgIC5mbigpXG4gICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh1bmRlZmluZWQpIC8vIEluaXRpYWwgYnVpbGQgc3VjY2VlZHNcbiAgICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKHJlYnVpbGRFcnJvciksIC8vIFJlYnVpbGQgZmFpbHNcbiAgICAgIH07XG4gICAgICBtb2NrRWxldmVudHkubW9ja1JldHVyblZhbHVlKG1vY2tFbGV2ZW50eUluc3RhbmNlKTtcblxuICAgICAgY29uc3QgbW9ja0RldlNlcnZlckluc3RhbmNlID0ge1xuICAgICAgICBzZXJ2ZTogamVzdC5mbigpLFxuICAgICAgICB3YXRjaGVyOiB7XG4gICAgICAgICAgb246IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiAocGF0aDogc3RyaW5nKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdjaGFuZ2UnKSB7XG4gICAgICAgICAgICAgIGNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgY2xvc2U6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgICB9LFxuICAgICAgICB3YXRjaEZpbGVzOiBqZXN0LmZuKCksXG4gICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIH07XG4gICAgICBtb2NrRWxldmVudHlEZXZTZXJ2ZXIubW9ja1JldHVyblZhbHVlKG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IGNvbnNvbGVFcnJvclNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGF3YWl0IHN0YXJ0V2Vic2l0ZVNlcnZlcignL3Rlc3Qvd2Vic2l0ZScsICd0ZXN0LXNpdGUnLCAzMDAwKTtcblxuICAgICAgLy8gU2ltdWxhdGUgZmlsZSBjaGFuZ2UgdGhhdCB0cmlnZ2VycyBmYWlsZWQgcmVidWlsZFxuICAgICAgYXdhaXQgY2hhbmdlQ2FsbGJhY2soJy90ZXN0L3dlYnNpdGUvc3JjL2luZGV4Lmh0bWwnKTtcblxuICAgICAgLy8gVmVyaWZ5OiBSZWJ1aWxkIGZhaWx1cmUgaXMgbG9nZ2VkIGNvcnJlY3RseVxuICAgICAgbG9nZ2luZ0hlbHBlci5leHBlY3RFcnJvckxvZ2dlZChidWlsZEVycm9yUGF0dGVybnMucmVidWlsZEZhaWxlZCgndGVzdC1zaXRlJykpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbm9uLUVycm9yIHJlYnVpbGQgZmFpbHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgY2hhbmdlQ2FsbGJhY2s6IChwYXRoOiBzdHJpbmcpID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgICAgIGNvbnN0IHJlYnVpbGRFcnJvciA9ICdTdHJpbmcgcmVidWlsZCBlcnJvcic7XG4gICAgICBjb25zdCBtb2NrRWxldmVudHlJbnN0YW5jZSA9IHtcbiAgICAgICAgd3JpdGU6IGplc3RcbiAgICAgICAgICAuZm4oKVxuICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UodW5kZWZpbmVkKSAvLyBJbml0aWFsIGJ1aWxkIHN1Y2NlZWRzXG4gICAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlT25jZShyZWJ1aWxkRXJyb3IpLCAvLyBSZWJ1aWxkIGZhaWxzXG4gICAgICB9O1xuICAgICAgbW9ja0VsZXZlbnR5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrRWxldmVudHlJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSA9IHtcbiAgICAgICAgc2VydmU6IGplc3QuZm4oKSxcbiAgICAgICAgd2F0Y2hlcjoge1xuICAgICAgICAgIG9uOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChldmVudDogc3RyaW5nLCBjYWxsYmFjazogKHBhdGg6IHN0cmluZykgPT4gdm9pZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50ID09PSAnY2hhbmdlJykge1xuICAgICAgICAgICAgICBjaGFuZ2VDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgICAgfSxcbiAgICAgICAgd2F0Y2hGaWxlczogamVzdC5mbigpLFxuICAgICAgICBjbG9zZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICB9O1xuICAgICAgbW9ja0VsZXZlbnR5RGV2U2VydmVyLm1vY2tSZXR1cm5WYWx1ZShtb2NrRGV2U2VydmVySW5zdGFuY2UpO1xuXG4gICAgICBjb25zdCBjb25zb2xlRXJyb3JTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIGZpbGUgY2hhbmdlIHRoYXQgdHJpZ2dlcnMgZmFpbGVkIHJlYnVpbGRcbiAgICAgIGF3YWl0IGNoYW5nZUNhbGxiYWNrKCcvdGVzdC93ZWJzaXRlL3NyYy9pbmRleC5odG1sJyk7XG5cbiAgICAgIC8vIFZlcmlmeTogUmVidWlsZCBmYWlsdXJlIGlzIGxvZ2dlZCBjb3JyZWN0bHlcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLnJlYnVpbGRGYWlsZWQoJ3Rlc3Qtc2l0ZScpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3Npbmcgd2F0Y2hlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSA9IHtcbiAgICAgICAgc2VydmU6IGplc3QuZm4oKSxcbiAgICAgICAgd2F0Y2hlcjogbnVsbCwgLy8gTm8gd2F0Y2hlclxuICAgICAgICB3YXRjaEZpbGVzOiBqZXN0LmZuKCksXG4gICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIH07XG4gICAgICBtb2NrRWxldmVudHlEZXZTZXJ2ZXIubW9ja1JldHVyblZhbHVlKG1vY2tEZXZTZXJ2ZXJJbnN0YW5jZSk7XG5cbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3cgYW4gZXJyb3JcbiAgICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHN0YXJ0V2Vic2l0ZVNlcnZlcignL3Rlc3Qvd2Vic2l0ZScsICd0ZXN0LXNpdGUnLCAzMDAwKTtcbiAgICAgIGV4cGVjdChzZXJ2ZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25zb2xlIG92ZXJyaWRlIGZvciBFbGV2ZW50eSBsb2dzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29uc29sZUxvZ1NweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpO1xuICAgICAgY29uc3QgY29uc29sZUVycm9yU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKTtcbiAgICAgIGNvbnN0IGNvbnNvbGVXYXJuU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnd2FybicpO1xuXG4gICAgICBhd2FpdCBzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCk7XG5cbiAgICAgIC8vIFRlc3QgY29uc29sZS5sb2cgb3ZlcnJpZGVcbiAgICAgIGNvbnNvbGUubG9nKCdUZXN0IFsxMXR5XSBtZXNzYWdlJyk7XG4gICAgICBjb25zb2xlLmxvZygnUmVndWxhciBtZXNzYWdlJyk7XG5cbiAgICAgIC8vIFRlc3QgY29uc29sZS5lcnJvciBvdmVycmlkZVxuICAgICAgY29uc29sZS5lcnJvcignVGVzdCBFbGV2ZW50eSBlcnJvcicpO1xuICAgICAgY29uc29sZS5lcnJvcignUmVndWxhciBlcnJvcicpO1xuXG4gICAgICAvLyBUZXN0IGNvbnNvbGUud2FybiBvdmVycmlkZVxuICAgICAgY29uc29sZS53YXJuKCdUZXN0IGVsZXZlbnR5IHdhcm5pbmcnKTtcbiAgICAgIGNvbnNvbGUud2FybignUmVndWxhciB3YXJuaW5nJyk7XG5cbiAgICAgIGV4cGVjdChjb25zb2xlTG9nU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVGVzdCBbMTF0eV0gbWVzc2FnZScpO1xuICAgICAgZXhwZWN0KGNvbnNvbGVFcnJvclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1Rlc3QgRWxldmVudHkgZXJyb3InKTtcbiAgICAgIGV4cGVjdChjb25zb2xlV2FyblNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1Rlc3QgZWxldmVudHkgd2FybmluZycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZ2VuZXJhbCBzdGFydHVwIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZnMuZXhpc3RzU3luYyB0byB0aHJvdyBhbiBlcnJvclxuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIHN5c3RlbSBlcnJvcicpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNvbnNvbGVFcnJvclNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCkpLnJlamVjdHMudG9UaHJvdygnRmlsZSBzeXN0ZW0gZXJyb3InKTtcblxuICAgICAgLy8gVmVyaWZ5OiBTZXJ2ZXIgc3RhcnR1cCBmYWlsdXJlIGlzIGxvZ2dlZCBjb3JyZWN0bHlcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLnNlcnZlclN0YXJ0RmFpbGVkKCd0ZXN0LXNpdGUnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBub24tRXJyb3Igc3RhcnR1cCBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZnMuZXhpc3RzU3luYyB0byB0aHJvdyBhIHN0cmluZyBlcnJvclxuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgJ1N0cmluZyBmaWxlIHN5c3RlbSBlcnJvcic7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY29uc29sZUVycm9yU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHN0YXJ0V2Vic2l0ZVNlcnZlcignL3Rlc3Qvd2Vic2l0ZScsICd0ZXN0LXNpdGUnLCAzMDAwKSkucmVqZWN0cy50b0JlKCdTdHJpbmcgZmlsZSBzeXN0ZW0gZXJyb3InKTtcblxuICAgICAgLy8gVmVyaWZ5OiBTZXJ2ZXIgc3RhcnR1cCBmYWlsdXJlIGlzIGxvZ2dlZCBjb3JyZWN0bHlcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLnNlcnZlclN0YXJ0RmFpbGVkKCd0ZXN0LXNpdGUnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3RvcmUgY29uc29sZSBtZXRob2RzIG9uIHN0YXJ0dXAgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxMb2cgPSBjb25zb2xlLmxvZztcblxuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIHN5c3RlbSBlcnJvcicpO1xuICAgICAgfSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHN0YXJ0V2Vic2l0ZVNlcnZlcignL3Rlc3Qvd2Vic2l0ZScsICd0ZXN0LXNpdGUnLCAzMDAwKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICAvLyBFeHBlY3RlZCB0byBmYWlsXG4gICAgICB9XG5cbiAgICAgIGV4cGVjdChjb25zb2xlLmxvZykudG9CZShvcmlnaW5hbExvZyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGwgRWxldmVudHkgY29uZmlndXJhdGlvbiBmdW5jdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhIG1vY2sgRWxldmVudHkgY29uZmlnIG9iamVjdCB0byB0ZXN0IHRoZSBjb25maWd1cmF0aW9uIGZ1bmN0aW9uXG4gICAgICBjb25zdCBtb2NrRWxldmVudHlDb25maWcgPSB7XG4gICAgICAgIHNldEZyZWV6ZVJlc2VydmVkRGF0YTogamVzdC5mbigpLFxuICAgICAgICBhZGRQbHVnaW46IGplc3QuZm4oKSxcbiAgICAgICAgYWRkR2xvYmFsRGF0YTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgLy8gTW9jayB0aGUgcmVxdWlyZXMgaW5zaWRlIHRoZSBjb25maWcgZnVuY3Rpb25cbiAgICAgIGplc3QuZG9Nb2NrKCdAZHdrL2FuZ2xlc2l0ZS0xMXR5JywgKCkgPT4gKHtcbiAgICAgICAgZGVmYXVsdDogJ2FuZ2xlc2l0ZS1wbHVnaW4nLFxuICAgICAgfSkpO1xuICAgICAgamVzdC5kb01vY2soJ0AxMXR5L2VsZXZlbnR5LXBsdWdpbi13ZWJjJywgKCkgPT4gJ3dlYmMtcGx1Z2luJyk7XG5cbiAgICAgIGxldCBjb25maWdGdW5jdGlvbjogKChjb25maWc6IHVua25vd24pID0+IHVua25vd24pIHwgdW5kZWZpbmVkO1xuXG4gICAgICBtb2NrRWxldmVudHkubW9ja0ltcGxlbWVudGF0aW9uKFxuICAgICAgICAoaW5wdXQ6IHN0cmluZywgb3V0cHV0OiBzdHJpbmcsIG9wdGlvbnM6IHsgY29uZmlnOiAoY29uZmlnOiB1bmtub3duKSA9PiB1bmtub3duIH0pID0+IHtcbiAgICAgICAgICBjb25maWdGdW5jdGlvbiA9IG9wdGlvbnMuY29uZmlnO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3cml0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgc3RhcnRXZWJzaXRlU2VydmVyKCcvdGVzdC93ZWJzaXRlJywgJ3Rlc3Qtc2l0ZScsIDMwMDApO1xuXG4gICAgICAvLyBDYWxsIHRoZSBjb25maWd1cmF0aW9uIGZ1bmN0aW9uIHdpdGggb3VyIG1vY2sgY29uZmlnXG4gICAgICBleHBlY3QoY29uZmlnRnVuY3Rpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBjb25maWdGdW5jdGlvbiEobW9ja0VsZXZlbnR5Q29uZmlnKTtcblxuICAgICAgZXhwZWN0KG1vY2tFbGV2ZW50eUNvbmZpZy5zZXRGcmVlemVSZXNlcnZlZERhdGEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGZhbHNlKTtcbiAgICAgIGV4cGVjdChtb2NrRWxldmVudHlDb25maWcuYWRkUGx1Z2luKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYW5nbGVzaXRlLXBsdWdpbicpO1xuICAgICAgZXhwZWN0KG1vY2tFbGV2ZW50eUNvbmZpZy5hZGRQbHVnaW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd3ZWJjLXBsdWdpbicsIHtcbiAgICAgICAgY29tcG9uZW50czogJ19pbmNsdWRlcy8qKi8qLndlYmMnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobW9ja0VsZXZlbnR5Q29uZmlnLmFkZEdsb2JhbERhdGEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdlbGV2ZW50eScsIGV4cGVjdC5hbnkoRnVuY3Rpb24pKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHRlbXBsYXRlRm9ybWF0czogWycxMXR5LmpzJywgJ3dlYmMnLCAnbWQnLCAnaHRtbCddLFxuICAgICAgICBtYXJrZG93blRlbXBsYXRlRW5naW5lOiAnd2ViYycsXG4gICAgICAgIGh0bWxUZW1wbGF0ZUVuZ2luZTogJ3dlYmMnLFxuICAgICAgICBkaXI6IHtcbiAgICAgICAgICBpbnB1dDogJy4nLFxuICAgICAgICAgIG91dHB1dDogJy4uL19zaXRlJyxcbiAgICAgICAgICBpbmNsdWRlczogJ19pbmNsdWRlcycsXG4gICAgICAgICAgbGF5b3V0czogJ19pbmNsdWRlcycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGVzdCBnbG9iYWwgZGF0YSBmdW5jdGlvbiBpbiBFbGV2ZW50eSBjb25maWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbEVudiA9IHByb2Nlc3MuZW52LkVMRVZFTlRZX1ZFUlNJT047XG5cbiAgICAgIGxldCBjb25maWdGdW5jdGlvbjogKChjb25maWc6IHVua25vd24pID0+IHVua25vd24pIHwgdW5kZWZpbmVkO1xuICAgICAgbGV0IGdsb2JhbERhdGFGdW5jdGlvbjogKCgpID0+IHsgZ2VuZXJhdG9yOiBzdHJpbmcgfSkgfCB1bmRlZmluZWQ7XG5cbiAgICAgIGNvbnN0IG1vY2tFbGV2ZW50eUNvbmZpZyA9IHtcbiAgICAgICAgc2V0RnJlZXplUmVzZXJ2ZWREYXRhOiBqZXN0LmZuKCksXG4gICAgICAgIGFkZFBsdWdpbjogamVzdC5mbigpLFxuICAgICAgICBhZGRHbG9iYWxEYXRhOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChrZXk6IHN0cmluZywgZm46ICgpID0+IHsgZ2VuZXJhdG9yOiBzdHJpbmcgfSkgPT4ge1xuICAgICAgICAgIGlmIChrZXkgPT09ICdlbGV2ZW50eScpIHtcbiAgICAgICAgICAgIGdsb2JhbERhdGFGdW5jdGlvbiA9IGZuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICB9O1xuXG4gICAgICBtb2NrRWxldmVudHkubW9ja0ltcGxlbWVudGF0aW9uKFxuICAgICAgICAoaW5wdXQ6IHN0cmluZywgb3V0cHV0OiBzdHJpbmcsIG9wdGlvbnM6IHsgY29uZmlnOiAoY29uZmlnOiB1bmtub3duKSA9PiB1bmtub3duIH0pID0+IHtcbiAgICAgICAgICBjb25maWdGdW5jdGlvbiA9IG9wdGlvbnMuY29uZmlnO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3cml0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgc3RhcnRXZWJzaXRlU2VydmVyKCcvdGVzdC93ZWJzaXRlJywgJ3Rlc3Qtc2l0ZScsIDMwMDApO1xuXG4gICAgICAvLyBDYWxsIHRoZSBjb25maWd1cmF0aW9uIGZ1bmN0aW9uXG4gICAgICBleHBlY3QoY29uZmlnRnVuY3Rpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBjb25maWdGdW5jdGlvbiEobW9ja0VsZXZlbnR5Q29uZmlnKTtcblxuICAgICAgLy8gVGVzdCB3aXRoIEVMRVZFTlRZX1ZFUlNJT04gc2V0XG4gICAgICBwcm9jZXNzLmVudi5FTEVWRU5UWV9WRVJTSU9OID0gJzIuMC4wJztcbiAgICAgIGV4cGVjdChnbG9iYWxEYXRhRnVuY3Rpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZ2xvYmFsRGF0YUZ1bmN0aW9uISgpKS50b0VxdWFsKHtcbiAgICAgICAgZ2VuZXJhdG9yOiAnRWxldmVudHkgdjIuMC4wJyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBUZXN0IHdpdGhvdXQgRUxFVkVOVFlfVkVSU0lPTlxuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LkVMRVZFTlRZX1ZFUlNJT047XG4gICAgICBleHBlY3QoZ2xvYmFsRGF0YUZ1bmN0aW9uISgpKS50b0VxdWFsKHtcbiAgICAgICAgZ2VuZXJhdG9yOiAnRWxldmVudHknLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgZW52XG4gICAgICBpZiAob3JpZ2luYWxFbnYpIHtcbiAgICAgICAgcHJvY2Vzcy5lbnYuRUxFVkVOVFlfVkVSU0lPTiA9IG9yaWdpbmFsRW52O1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZXJyb3IgbG9nZ2VyIGNhbGxiYWNrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVycm9yQ2FsbGJhY2s6IChtc2c6IHN0cmluZykgPT4gdm9pZCA9ICgpID0+IHt9O1xuXG4gICAgICBjb25zdCBtb2NrRGV2U2VydmVySW5zdGFuY2UgPSB7XG4gICAgICAgIHNlcnZlOiBqZXN0LmZuKCksXG4gICAgICAgIHdhdGNoZXI6IHtcbiAgICAgICAgICBvbjogamVzdC5mbigpLFxuICAgICAgICAgIGNsb3NlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgICAgfSxcbiAgICAgICAgd2F0Y2hGaWxlczogamVzdC5mbigpLFxuICAgICAgICBjbG9zZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrRWxldmVudHlEZXZTZXJ2ZXIubW9ja0ltcGxlbWVudGF0aW9uKFxuICAgICAgICAoXG4gICAgICAgICAgbmFtZTogc3RyaW5nLFxuICAgICAgICAgIG91dHB1dERpcjogc3RyaW5nLFxuICAgICAgICAgIG9wdGlvbnM6IHsgbG9nZ2VyOiB7IGxvZzogKG1zZzogc3RyaW5nKSA9PiB2b2lkOyBpbmZvOiAobXNnOiBzdHJpbmcpID0+IHZvaWQ7IGVycm9yOiAobXNnOiBzdHJpbmcpID0+IHZvaWQgfSB9XG4gICAgICAgICkgPT4ge1xuICAgICAgICAgIGVycm9yQ2FsbGJhY2sgPSBvcHRpb25zLmxvZ2dlci5lcnJvcjtcbiAgICAgICAgICByZXR1cm4gbW9ja0RldlNlcnZlckluc3RhbmNlO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBjb25zdCBjb25zb2xlRXJyb3JTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBzdGFydFdlYnNpdGVTZXJ2ZXIoJy90ZXN0L3dlYnNpdGUnLCAndGVzdC1zaXRlJywgMzAwMCk7XG5cbiAgICAgIC8vIFRlc3QgdGhlIGVycm9yIGNhbGxiYWNrXG4gICAgICBlcnJvckNhbGxiYWNrKCdUZXN0IGVycm9yIG1lc3NhZ2UnKTtcblxuICAgICAgZXhwZWN0KGNvbnNvbGVFcnJvclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1t0ZXN0LXNpdGVdIFRlc3QgZXJyb3IgbWVzc2FnZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RvcFdlYnNpdGVTZXJ2ZXInLCAoKSA9PiB7XG4gICAgbGV0IG1vY2tTZXJ2ZXI6IFdlYnNpdGVTZXJ2ZXI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIG1vY2tTZXJ2ZXIgPSB7XG4gICAgICAgIGVsZXZlbnR5OiB7fSxcbiAgICAgICAgZGV2U2VydmVyOiB7XG4gICAgICAgICAgd2F0Y2hlcjoge1xuICAgICAgICAgICAgY2xvc2U6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xvc2U6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgICB9LFxuICAgICAgICBpbnB1dERpcjogJy90ZXN0L3NyYycsXG4gICAgICAgIG91dHB1dERpcjogJy90ZXN0L19zaXRlJyxcbiAgICAgICAgcG9ydDogMzAwMCxcbiAgICAgICAgYWN0dWFsVXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyxcbiAgICAgICAgdXJsUmVzb2x2ZXI6IHt9IGFzIEVsZXZlbnR5VXJsUmVzb2x2ZXIsXG4gICAgICAgIHJlc3RvcmVDb25zb2xlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrRnMucm1TeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBzdG9wIGEgd2Vic2l0ZSBzZXJ2ZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzdG9wV2Vic2l0ZVNlcnZlcihtb2NrU2VydmVyKTtcblxuICAgICAgZXhwZWN0KG1vY2tTZXJ2ZXIucmVzdG9yZUNvbnNvbGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU2VydmVyLmRldlNlcnZlci53YXRjaGVyLmNsb3NlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1NlcnZlci5kZXZTZXJ2ZXIuY2xvc2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrRnMucm1TeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3Rlc3QvX3NpdGUnLCB7IHJlY3Vyc2l2ZTogdHJ1ZSwgZm9yY2U6IHRydWUgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIHJlc3RvcmVDb25zb2xlIGZ1bmN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1NlcnZlci5yZXN0b3JlQ29uc29sZSA9IHVuZGVmaW5lZDtcblxuICAgICAgYXdhaXQgZXhwZWN0KHN0b3BXZWJzaXRlU2VydmVyKG1vY2tTZXJ2ZXIpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyB3YXRjaGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1NlcnZlci5kZXZTZXJ2ZXIud2F0Y2hlciA9IG51bGw7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzdG9wV2Vic2l0ZVNlcnZlcihtb2NrU2VydmVyKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHdhdGNoZXIgY2xvc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2F0Y2hlckVycm9yID0gbmV3IEVycm9yKCdXYXRjaGVyIGNsb3NlIGZhaWxlZCcpO1xuICAgICAgbW9ja1NlcnZlci5kZXZTZXJ2ZXIud2F0Y2hlci5jbG9zZS5tb2NrUmVqZWN0ZWRWYWx1ZSh3YXRjaGVyRXJyb3IpO1xuXG4gICAgICBjb25zdCBjb25zb2xlRXJyb3JTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBzdG9wV2Vic2l0ZVNlcnZlcihtb2NrU2VydmVyKTtcblxuICAgICAgLy8gVmVyaWZ5OiBXYXRjaGVyIGNsb3NlIGVycm9yIGlzIGxvZ2dlZCBjb3JyZWN0bHlcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLndhdGNoZXJDbG9zZUZhaWxlZCgzMDAwKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIGRldlNlcnZlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTZXJ2ZXIuZGV2U2VydmVyID0gbnVsbDtcblxuICAgICAgYXdhaXQgZXhwZWN0KHN0b3BXZWJzaXRlU2VydmVyKG1vY2tTZXJ2ZXIpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgICAgZXhwZWN0KG1vY2tGcy5ybVN5bmMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRldlNlcnZlciB3aXRob3V0IGNsb3NlIG1ldGhvZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTZXJ2ZXIuZGV2U2VydmVyID0ge1xuICAgICAgICB3YXRjaGVyOiB7XG4gICAgICAgICAgY2xvc2U6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHN0b3BXZWJzaXRlU2VydmVyKG1vY2tTZXJ2ZXIpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGV2U2VydmVyIGNsb3NlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsb3NlRXJyb3IgPSBuZXcgRXJyb3IoJ1NlcnZlciBjbG9zZSBmYWlsZWQnKTtcbiAgICAgIG1vY2tTZXJ2ZXIuZGV2U2VydmVyLmNsb3NlLm1vY2tSZWplY3RlZFZhbHVlKGNsb3NlRXJyb3IpO1xuXG4gICAgICBjb25zdCBjb25zb2xlRXJyb3JTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBzdG9wV2Vic2l0ZVNlcnZlcihtb2NrU2VydmVyKTtcblxuICAgICAgLy8gVmVyaWZ5OiBTZXJ2ZXIgY2xvc2UgZXJyb3IgaXMgbG9nZ2VkIGNvcnJlY3RseVxuICAgICAgbG9nZ2luZ0hlbHBlci5leHBlY3RFcnJvckxvZ2dlZChidWlsZEVycm9yUGF0dGVybnMuc2VydmVyQ2xvc2VGYWlsZWQoMzAwMCkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBvdXRwdXQgZGlyZWN0b3J5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcblxuICAgICAgYXdhaXQgc3RvcFdlYnNpdGVTZXJ2ZXIobW9ja1NlcnZlcik7XG5cbiAgICAgIGV4cGVjdChtb2NrRnMucm1TeW5jKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgb3V0cHV0IGRpcmVjdG9yeSBjbGVhbnVwIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsZWFudXBFcnJvciA9IG5ldyBFcnJvcignQ2xlYW51cCBmYWlsZWQnKTtcbiAgICAgIG1vY2tGcy5ybVN5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgY2xlYW51cEVycm9yO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNvbnNvbGVFcnJvclNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGF3YWl0IHN0b3BXZWJzaXRlU2VydmVyKG1vY2tTZXJ2ZXIpO1xuXG4gICAgICAvLyBWZXJpZnk6IERpcmVjdG9yeSBjbGVhbnVwIGVycm9yIGlzIGxvZ2dlZCBjb3JyZWN0bHlcbiAgICAgIGxvZ2dpbmdIZWxwZXIuZXhwZWN0RXJyb3JMb2dnZWQoYnVpbGRFcnJvclBhdHRlcm5zLmRpcmVjdG9yeUNsZWFudXBGYWlsZWQoKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBnZW5lcmFsIHN0b3AgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhbEVycm9yID0gbmV3IEVycm9yKCdHZW5lcmFsIHN0b3AgZXJyb3InKTtcbiAgICAgIG1vY2tTZXJ2ZXIucmVzdG9yZUNvbnNvbGUgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgZ2VuZXJhbEVycm9yO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNvbnNvbGVFcnJvclNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGF3YWl0IHN0b3BXZWJzaXRlU2VydmVyKG1vY2tTZXJ2ZXIpO1xuXG4gICAgICAvLyBWZXJpZnk6IEdlbmVyYWwgc2VydmVyIHN0b3AgZXJyb3IgaXMgbG9nZ2VkIGNvcnJlY3RseVxuICAgICAgbG9nZ2luZ0hlbHBlci5leHBlY3RFcnJvckxvZ2dlZChidWlsZEVycm9yUGF0dGVybnMuc2VydmVyU3RvcEZhaWxlZCgzMDAwKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=