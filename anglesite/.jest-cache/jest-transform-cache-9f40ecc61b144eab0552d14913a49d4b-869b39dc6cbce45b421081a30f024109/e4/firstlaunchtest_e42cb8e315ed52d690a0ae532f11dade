078959767ee23b4be3493e48b18c791d
"use strict";
/**
 * @file Tests for first launch setup flow utilities
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('electron', () => ({
    app: {
        quit: jest.fn(),
    },
    dialog: {
        showMessageBoxSync: jest.fn(),
    },
    nativeTheme: {
        themeSource: 'system',
        on: jest.fn(),
        shouldUseDarkColors: false,
    },
}));
// Store class removed - now using DI with StoreService
jest.mock('../../app/certificates');
jest.mock('../../app/ui/window-manager');
const electron_1 = require("electron");
const first_launch_1 = require("../../app/utils/first-launch");
const certificates_1 = require("../../app/certificates");
const window_manager_1 = require("../../app/ui/window-manager");
const mockApp = electron_1.app;
const mockDialog = electron_1.dialog;
const mockIsCAInstalledInSystem = certificates_1.isCAInstalledInSystem;
const mockInstallCAInSystem = certificates_1.installCAInSystem;
const mockShowFirstLaunchAssistant = window_manager_1.showFirstLaunchAssistant;
describe('First Launch', () => {
    let mockStore;
    let consoleErrorSpy;
    beforeEach(() => {
        jest.clearAllMocks();
        mockStore = {
            get: jest.fn(),
            set: jest.fn(),
            dispose: jest.fn(),
        };
        consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
    });
    afterEach(() => {
        consoleErrorSpy.mockRestore();
    });
    describe('handleFirstLaunch', () => {
        it('should skip setup if CA is already installed and set HTTPS mode', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(true);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalled();
            expect(mockShowFirstLaunchAssistant).not.toHaveBeenCalled();
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'https');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
            expect(mockStore.set).toHaveBeenCalledTimes(2);
        });
        it('should quit app if user cancels first launch assistant', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue(null);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalled();
            expect(mockShowFirstLaunchAssistant).toHaveBeenCalled();
            expect(mockApp.quit).toHaveBeenCalled();
            expect(mockStore.set).not.toHaveBeenCalled();
        });
        it('should set HTTPS mode when user chooses HTTPS and CA installation succeeds', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue('https');
            mockInstallCAInSystem.mockResolvedValue(true);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalled();
            expect(mockShowFirstLaunchAssistant).toHaveBeenCalled();
            expect(mockInstallCAInSystem).toHaveBeenCalled();
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'https');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
            expect(mockStore.set).toHaveBeenCalledTimes(2);
            expect(mockDialog.showMessageBoxSync).not.toHaveBeenCalled();
        });
        it('should fall back to HTTP mode when CA installation fails', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue('https');
            mockInstallCAInSystem.mockResolvedValue(false);
            mockDialog.showMessageBoxSync.mockReturnValue(0);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalled();
            expect(mockShowFirstLaunchAssistant).toHaveBeenCalled();
            expect(mockInstallCAInSystem).toHaveBeenCalled();
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'http');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
            expect(mockStore.set).toHaveBeenCalledTimes(2);
            expect(mockDialog.showMessageBoxSync).toHaveBeenCalledWith({
                type: 'warning',
                title: 'Certificate Installation Failed',
                message: 'Failed to install the security certificate.',
                detail: 'Anglesite will continue in HTTP mode. You can retry HTTPS setup in the settings.',
                buttons: ['Continue'],
            });
        });
        it('should handle CA installation errors and fall back to HTTP mode', async () => {
            const testError = new Error('Installation error');
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue('https');
            mockInstallCAInSystem.mockRejectedValue(testError);
            mockDialog.showMessageBoxSync.mockReturnValue(0);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalled();
            expect(mockShowFirstLaunchAssistant).toHaveBeenCalled();
            expect(mockInstallCAInSystem).toHaveBeenCalled();
            expect(consoleErrorSpy).toHaveBeenCalledWith('Error during CA installation:', testError);
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'http');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
            expect(mockStore.set).toHaveBeenCalledTimes(2);
            expect(mockDialog.showMessageBoxSync).toHaveBeenCalledWith({
                type: 'error',
                title: 'Setup Error',
                message: 'An error occurred during setup.',
                detail: 'Anglesite will continue in HTTP mode.',
                buttons: ['Continue'],
            });
        });
        it('should set HTTP mode when user explicitly chooses HTTP', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue('http');
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalled();
            expect(mockShowFirstLaunchAssistant).toHaveBeenCalled();
            expect(mockInstallCAInSystem).not.toHaveBeenCalled();
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'http');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
            expect(mockStore.set).toHaveBeenCalledTimes(2);
            expect(mockDialog.showMessageBoxSync).not.toHaveBeenCalled();
        });
        it('should handle unexpected user choice values', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue('unexpected'); // eslint-disable-line @typescript-eslint/no-explicit-any
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalled();
            expect(mockShowFirstLaunchAssistant).toHaveBeenCalled();
            expect(mockInstallCAInSystem).not.toHaveBeenCalled();
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'http');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
            expect(mockStore.set).toHaveBeenCalledTimes(2);
        });
        it('should handle CA installation throwing non-Error objects', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue('https');
            mockInstallCAInSystem.mockRejectedValue('String error');
            mockDialog.showMessageBoxSync.mockReturnValue(0);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(consoleErrorSpy).toHaveBeenCalledWith('Error during CA installation:', 'String error');
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'http');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
            expect(mockDialog.showMessageBoxSync).toHaveBeenCalledWith({
                type: 'error',
                title: 'Setup Error',
                message: 'An error occurred during setup.',
                detail: 'Anglesite will continue in HTTP mode.',
                buttons: ['Continue'],
            });
        });
        it('should handle undefined store properly', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(false);
            mockShowFirstLaunchAssistant.mockResolvedValue('http');
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockStore.set).toHaveBeenCalledWith('httpsMode', 'http');
            expect(mockStore.set).toHaveBeenCalledWith('firstLaunchCompleted', true);
        });
        it('should handle multiple consecutive calls correctly', async () => {
            mockIsCAInstalledInSystem.mockResolvedValue(true);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            await (0, first_launch_1.handleFirstLaunch)(mockStore);
            expect(mockIsCAInstalledInSystem).toHaveBeenCalledTimes(2);
            expect(mockStore.set).toHaveBeenCalledTimes(4);
            expect(mockStore.set).toHaveBeenNthCalledWith(1, 'httpsMode', 'https');
            expect(mockStore.set).toHaveBeenNthCalledWith(2, 'firstLaunchCompleted', true);
            expect(mockStore.set).toHaveBeenNthCalledWith(3, 'httpsMode', 'https');
            expect(mockStore.set).toHaveBeenNthCalledWith(4, 'firstLaunchCompleted', true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L3V0aWxzL2ZpcnN0LWxhdW5jaC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFRSCxvQkFBb0I7QUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMzQixHQUFHLEVBQUU7UUFDSCxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNoQjtJQUNELE1BQU0sRUFBRTtRQUNOLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDOUI7SUFDRCxXQUFXLEVBQUU7UUFDWCxXQUFXLEVBQUUsUUFBUTtRQUNyQixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNiLG1CQUFtQixFQUFFLEtBQUs7S0FDM0I7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLHVEQUF1RDtBQUN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0FBdkJ6Qyx1Q0FBdUM7QUFDdkMsK0RBQWlFO0FBRWpFLHlEQUFrRjtBQUNsRixnRUFBdUU7QUFxQnZFLE1BQU0sT0FBTyxHQUFHLGNBQThCLENBQUM7QUFDL0MsTUFBTSxVQUFVLEdBQUcsaUJBQW9DLENBQUM7QUFDeEQsTUFBTSx5QkFBeUIsR0FBRyxvQ0FBMEUsQ0FBQztBQUM3RyxNQUFNLHFCQUFxQixHQUFHLGdDQUFrRSxDQUFDO0FBQ2pHLE1BQU0sNEJBQTRCLEdBQUcseUNBQWdGLENBQUM7QUFFdEgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDNUIsSUFBSSxTQUF1QyxDQUFDO0lBQzVDLElBQUksZUFBaUMsQ0FBQztJQUV0QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLFNBQVMsR0FB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Q0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNELE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLEVBQUUsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3ZFLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxFQUFFLHNCQUFzQixFQUFFLElBQUksQ0FBQyxDQUFDO1lBQy9FLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxFQUFFLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUN2RSxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsRUFBRSxzQkFBc0IsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNqRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2R3ay9EZXZlbG9wZXIvZ2l0bGFiLmNvbS9kYXZpZHdrZWl0aC9AZHdrL2FuZ2xlc2l0ZS90ZXN0L3V0aWxzL2ZpcnN0LWxhdW5jaC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgVGVzdHMgZm9yIGZpcnN0IGxhdW5jaCBzZXR1cCBmbG93IHV0aWxpdGllc1xuICovXG5cbmltcG9ydCB7IGFwcCwgZGlhbG9nIH0gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IHsgaGFuZGxlRmlyc3RMYXVuY2ggfSBmcm9tICcuLi8uLi9hcHAvdXRpbHMvZmlyc3QtbGF1bmNoJztcbmltcG9ydCB7IElTdG9yZSB9IGZyb20gJy4uLy4uL2FwcC9jb3JlL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgaXNDQUluc3RhbGxlZEluU3lzdGVtLCBpbnN0YWxsQ0FJblN5c3RlbSB9IGZyb20gJy4uLy4uL2FwcC9jZXJ0aWZpY2F0ZXMnO1xuaW1wb3J0IHsgc2hvd0ZpcnN0TGF1bmNoQXNzaXN0YW50IH0gZnJvbSAnLi4vLi4vYXBwL3VpL3dpbmRvdy1tYW5hZ2VyJztcblxuLy8gTW9jayBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnZWxlY3Ryb24nLCAoKSA9PiAoe1xuICBhcHA6IHtcbiAgICBxdWl0OiBqZXN0LmZuKCksXG4gIH0sXG4gIGRpYWxvZzoge1xuICAgIHNob3dNZXNzYWdlQm94U3luYzogamVzdC5mbigpLFxuICB9LFxuICBuYXRpdmVUaGVtZToge1xuICAgIHRoZW1lU291cmNlOiAnc3lzdGVtJyxcbiAgICBvbjogamVzdC5mbigpLFxuICAgIHNob3VsZFVzZURhcmtDb2xvcnM6IGZhbHNlLFxuICB9LFxufSkpO1xuXG4vLyBTdG9yZSBjbGFzcyByZW1vdmVkIC0gbm93IHVzaW5nIERJIHdpdGggU3RvcmVTZXJ2aWNlXG5qZXN0Lm1vY2soJy4uLy4uL2FwcC9jZXJ0aWZpY2F0ZXMnKTtcbmplc3QubW9jaygnLi4vLi4vYXBwL3VpL3dpbmRvdy1tYW5hZ2VyJyk7XG5cbmNvbnN0IG1vY2tBcHAgPSBhcHAgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIGFwcD47XG5jb25zdCBtb2NrRGlhbG9nID0gZGlhbG9nIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBkaWFsb2c+O1xuY29uc3QgbW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbSA9IGlzQ0FJbnN0YWxsZWRJblN5c3RlbSBhcyBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBpc0NBSW5zdGFsbGVkSW5TeXN0ZW0+O1xuY29uc3QgbW9ja0luc3RhbGxDQUluU3lzdGVtID0gaW5zdGFsbENBSW5TeXN0ZW0gYXMgamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgaW5zdGFsbENBSW5TeXN0ZW0+O1xuY29uc3QgbW9ja1Nob3dGaXJzdExhdW5jaEFzc2lzdGFudCA9IHNob3dGaXJzdExhdW5jaEFzc2lzdGFudCBhcyBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBzaG93Rmlyc3RMYXVuY2hBc3Npc3RhbnQ+O1xuXG5kZXNjcmliZSgnRmlyc3QgTGF1bmNoJywgKCkgPT4ge1xuICBsZXQgbW9ja1N0b3JlOiBqZXN0Lk1vY2tlZDxQYXJ0aWFsPElTdG9yZT4+O1xuICBsZXQgY29uc29sZUVycm9yU3B5OiBqZXN0LlNweUluc3RhbmNlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuXG4gICAgbW9ja1N0b3JlID0ge1xuICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgICBzZXQ6IGplc3QuZm4oKSxcbiAgICAgIGRpc3Bvc2U6IGplc3QuZm4oKSxcbiAgICB9IGFzIGplc3QuTW9ja2VkPFBhcnRpYWw8SVN0b3JlPj47XG5cbiAgICBjb25zb2xlRXJyb3JTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGNvbnNvbGVFcnJvclNweS5tb2NrUmVzdG9yZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGFuZGxlRmlyc3RMYXVuY2gnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBza2lwIHNldHVwIGlmIENBIGlzIGFscmVhZHkgaW5zdGFsbGVkIGFuZCBzZXQgSFRUUFMgbW9kZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJc0NBSW5zdGFsbGVkSW5TeXN0ZW0ubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZUZpcnN0TGF1bmNoKG1vY2tTdG9yZSBhcyBJU3RvcmUpO1xuXG4gICAgICBleHBlY3QobW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tTaG93Rmlyc3RMYXVuY2hBc3Npc3RhbnQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHBzTW9kZScsICdodHRwcycpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdmaXJzdExhdW5jaENvbXBsZXRlZCcsIHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcXVpdCBhcHAgaWYgdXNlciBjYW5jZWxzIGZpcnN0IGxhdW5jaCBhc3Npc3RhbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSXNDQUluc3RhbGxlZEluU3lzdGVtLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcbiAgICAgIG1vY2tTaG93Rmlyc3RMYXVuY2hBc3Npc3RhbnQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZUZpcnN0TGF1bmNoKG1vY2tTdG9yZSBhcyBJU3RvcmUpO1xuXG4gICAgICBleHBlY3QobW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tTaG93Rmlyc3RMYXVuY2hBc3Npc3RhbnQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrQXBwLnF1aXQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU3RvcmUuc2V0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZXQgSFRUUFMgbW9kZSB3aGVuIHVzZXIgY2hvb3NlcyBIVFRQUyBhbmQgQ0EgaW5zdGFsbGF0aW9uIHN1Y2NlZWRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG4gICAgICBtb2NrU2hvd0ZpcnN0TGF1bmNoQXNzaXN0YW50Lm1vY2tSZXNvbHZlZFZhbHVlKCdodHRwcycpO1xuICAgICAgbW9ja0luc3RhbGxDQUluU3lzdGVtLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuXG4gICAgICBhd2FpdCBoYW5kbGVGaXJzdExhdW5jaChtb2NrU3RvcmUgYXMgSVN0b3JlKTtcblxuICAgICAgZXhwZWN0KG1vY2tJc0NBSW5zdGFsbGVkSW5TeXN0ZW0pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU2hvd0ZpcnN0TGF1bmNoQXNzaXN0YW50KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0luc3RhbGxDQUluU3lzdGVtKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHBzTW9kZScsICdodHRwcycpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdmaXJzdExhdW5jaENvbXBsZXRlZCcsIHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIGV4cGVjdChtb2NrRGlhbG9nLnNob3dNZXNzYWdlQm94U3luYykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFsbCBiYWNrIHRvIEhUVFAgbW9kZSB3aGVuIENBIGluc3RhbGxhdGlvbiBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJc0NBSW5zdGFsbGVkSW5TeXN0ZW0ubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgICAgbW9ja1Nob3dGaXJzdExhdW5jaEFzc2lzdGFudC5tb2NrUmVzb2x2ZWRWYWx1ZSgnaHR0cHMnKTtcbiAgICAgIG1vY2tJbnN0YWxsQ0FJblN5c3RlbS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG4gICAgICBtb2NrRGlhbG9nLnNob3dNZXNzYWdlQm94U3luYy5tb2NrUmV0dXJuVmFsdWUoMCk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZUZpcnN0TGF1bmNoKG1vY2tTdG9yZSBhcyBJU3RvcmUpO1xuXG4gICAgICBleHBlY3QobW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tTaG93Rmlyc3RMYXVuY2hBc3Npc3RhbnQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrSW5zdGFsbENBSW5TeXN0ZW0pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU3RvcmUuc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cHNNb2RlJywgJ2h0dHAnKTtcbiAgICAgIGV4cGVjdChtb2NrU3RvcmUuc2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZmlyc3RMYXVuY2hDb21wbGV0ZWQnLCB0cnVlKTtcbiAgICAgIGV4cGVjdChtb2NrU3RvcmUuc2V0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgICBleHBlY3QobW9ja0RpYWxvZy5zaG93TWVzc2FnZUJveFN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdHlwZTogJ3dhcm5pbmcnLFxuICAgICAgICB0aXRsZTogJ0NlcnRpZmljYXRlIEluc3RhbGxhdGlvbiBGYWlsZWQnLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGluc3RhbGwgdGhlIHNlY3VyaXR5IGNlcnRpZmljYXRlLicsXG4gICAgICAgIGRldGFpbDogJ0FuZ2xlc2l0ZSB3aWxsIGNvbnRpbnVlIGluIEhUVFAgbW9kZS4gWW91IGNhbiByZXRyeSBIVFRQUyBzZXR1cCBpbiB0aGUgc2V0dGluZ3MuJyxcbiAgICAgICAgYnV0dG9uczogWydDb250aW51ZSddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBDQSBpbnN0YWxsYXRpb24gZXJyb3JzIGFuZCBmYWxsIGJhY2sgdG8gSFRUUCBtb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdEVycm9yID0gbmV3IEVycm9yKCdJbnN0YWxsYXRpb24gZXJyb3InKTtcbiAgICAgIG1vY2tJc0NBSW5zdGFsbGVkSW5TeXN0ZW0ubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgICAgbW9ja1Nob3dGaXJzdExhdW5jaEFzc2lzdGFudC5tb2NrUmVzb2x2ZWRWYWx1ZSgnaHR0cHMnKTtcbiAgICAgIG1vY2tJbnN0YWxsQ0FJblN5c3RlbS5tb2NrUmVqZWN0ZWRWYWx1ZSh0ZXN0RXJyb3IpO1xuICAgICAgbW9ja0RpYWxvZy5zaG93TWVzc2FnZUJveFN5bmMubW9ja1JldHVyblZhbHVlKDApO1xuXG4gICAgICBhd2FpdCBoYW5kbGVGaXJzdExhdW5jaChtb2NrU3RvcmUgYXMgSVN0b3JlKTtcblxuICAgICAgZXhwZWN0KG1vY2tJc0NBSW5zdGFsbGVkSW5TeXN0ZW0pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU2hvd0ZpcnN0TGF1bmNoQXNzaXN0YW50KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0luc3RhbGxDQUluU3lzdGVtKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QoY29uc29sZUVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnRXJyb3IgZHVyaW5nIENBIGluc3RhbGxhdGlvbjonLCB0ZXN0RXJyb3IpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwc01vZGUnLCAnaHR0cCcpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdmaXJzdExhdW5jaENvbXBsZXRlZCcsIHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIGV4cGVjdChtb2NrRGlhbG9nLnNob3dNZXNzYWdlQm94U3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICB0aXRsZTogJ1NldHVwIEVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0FuIGVycm9yIG9jY3VycmVkIGR1cmluZyBzZXR1cC4nLFxuICAgICAgICBkZXRhaWw6ICdBbmdsZXNpdGUgd2lsbCBjb250aW51ZSBpbiBIVFRQIG1vZGUuJyxcbiAgICAgICAgYnV0dG9uczogWydDb250aW51ZSddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNldCBIVFRQIG1vZGUgd2hlbiB1c2VyIGV4cGxpY2l0bHkgY2hvb3NlcyBIVFRQJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG4gICAgICBtb2NrU2hvd0ZpcnN0TGF1bmNoQXNzaXN0YW50Lm1vY2tSZXNvbHZlZFZhbHVlKCdodHRwJyk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZUZpcnN0TGF1bmNoKG1vY2tTdG9yZSBhcyBJU3RvcmUpO1xuXG4gICAgICBleHBlY3QobW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tTaG93Rmlyc3RMYXVuY2hBc3Npc3RhbnQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrSW5zdGFsbENBSW5TeXN0ZW0pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHBzTW9kZScsICdodHRwJyk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ZpcnN0TGF1bmNoQ29tcGxldGVkJywgdHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgZXhwZWN0KG1vY2tEaWFsb2cuc2hvd01lc3NhZ2VCb3hTeW5jKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5leHBlY3RlZCB1c2VyIGNob2ljZSB2YWx1ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSXNDQUluc3RhbGxlZEluU3lzdGVtLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcbiAgICAgIG1vY2tTaG93Rmlyc3RMYXVuY2hBc3Npc3RhbnQubW9ja1Jlc29sdmVkVmFsdWUoJ3VuZXhwZWN0ZWQnIGFzIGFueSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuXG4gICAgICBhd2FpdCBoYW5kbGVGaXJzdExhdW5jaChtb2NrU3RvcmUgYXMgSVN0b3JlKTtcblxuICAgICAgZXhwZWN0KG1vY2tJc0NBSW5zdGFsbGVkSW5TeXN0ZW0pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrU2hvd0ZpcnN0TGF1bmNoQXNzaXN0YW50KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0luc3RhbGxDQUluU3lzdGVtKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwc01vZGUnLCAnaHR0cCcpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdmaXJzdExhdW5jaENvbXBsZXRlZCcsIHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIENBIGluc3RhbGxhdGlvbiB0aHJvd2luZyBub24tRXJyb3Igb2JqZWN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJc0NBSW5zdGFsbGVkSW5TeXN0ZW0ubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgICAgbW9ja1Nob3dGaXJzdExhdW5jaEFzc2lzdGFudC5tb2NrUmVzb2x2ZWRWYWx1ZSgnaHR0cHMnKTtcbiAgICAgIG1vY2tJbnN0YWxsQ0FJblN5c3RlbS5tb2NrUmVqZWN0ZWRWYWx1ZSgnU3RyaW5nIGVycm9yJyk7XG4gICAgICBtb2NrRGlhbG9nLnNob3dNZXNzYWdlQm94U3luYy5tb2NrUmV0dXJuVmFsdWUoMCk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZUZpcnN0TGF1bmNoKG1vY2tTdG9yZSBhcyBJU3RvcmUpO1xuXG4gICAgICBleHBlY3QoY29uc29sZUVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnRXJyb3IgZHVyaW5nIENBIGluc3RhbGxhdGlvbjonLCAnU3RyaW5nIGVycm9yJyk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHBzTW9kZScsICdodHRwJyk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ZpcnN0TGF1bmNoQ29tcGxldGVkJywgdHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja0RpYWxvZy5zaG93TWVzc2FnZUJveFN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgdGl0bGU6ICdTZXR1cCBFcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgc2V0dXAuJyxcbiAgICAgICAgZGV0YWlsOiAnQW5nbGVzaXRlIHdpbGwgY29udGludWUgaW4gSFRUUCBtb2RlLicsXG4gICAgICAgIGJ1dHRvbnM6IFsnQ29udGludWUnXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5kZWZpbmVkIHN0b3JlIHByb3Blcmx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG4gICAgICBtb2NrU2hvd0ZpcnN0TGF1bmNoQXNzaXN0YW50Lm1vY2tSZXNvbHZlZFZhbHVlKCdodHRwJyk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZUZpcnN0TGF1bmNoKG1vY2tTdG9yZSBhcyBJU3RvcmUpO1xuXG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHBzTW9kZScsICdodHRwJyk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ZpcnN0TGF1bmNoQ29tcGxldGVkJywgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtdWx0aXBsZSBjb25zZWN1dGl2ZSBjYWxscyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSXNDQUluc3RhbGxlZEluU3lzdGVtLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuXG4gICAgICBhd2FpdCBoYW5kbGVGaXJzdExhdW5jaChtb2NrU3RvcmUgYXMgSVN0b3JlKTtcbiAgICAgIGF3YWl0IGhhbmRsZUZpcnN0TGF1bmNoKG1vY2tTdG9yZSBhcyBJU3RvcmUpO1xuXG4gICAgICBleHBlY3QobW9ja0lzQ0FJbnN0YWxsZWRJblN5c3RlbSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcyg0KTtcbiAgICAgIGV4cGVjdChtb2NrU3RvcmUuc2V0KS50b0hhdmVCZWVuTnRoQ2FsbGVkV2l0aCgxLCAnaHR0cHNNb2RlJywgJ2h0dHBzJyk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMiwgJ2ZpcnN0TGF1bmNoQ29tcGxldGVkJywgdHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja1N0b3JlLnNldCkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMywgJ2h0dHBzTW9kZScsICdodHRwcycpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZXQpLnRvSGF2ZUJlZW5OdGhDYWxsZWRXaXRoKDQsICdmaXJzdExhdW5jaENvbXBsZXRlZCcsIHRydWUpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9