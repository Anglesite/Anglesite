{"version":3,"names":["cov_1r1m50ndb1","actualCoverage","s","exports","handleFirstLaunch","electron_1","require","certificates_1","window_manager_1","store","f","caInstalled","isCAInstalledInSystem","b","set","userChoice","showFirstLaunchAssistant","app","quit","installed","installCAInSystem","dialog","showMessageBoxSync","type","title","message","detail","buttons","error","console"],"sources":["/Users/dwk/Developer/gitlab.com/davidwkeith/@dwk/anglesite/app/utils/first-launch.ts"],"sourcesContent":["/**\n * @file First launch setup flow utilities\n */\nimport { app, dialog } from 'electron';\nimport { IStore } from '../core/interfaces';\nimport { isCAInstalledInSystem, installCAInSystem } from '../certificates';\nimport { showFirstLaunchAssistant } from '../ui/window-manager';\n\n/**\n * Handle first launch setup flow.\n * Checks if CA is already installed, otherwise shows setup assistant.\n * Handles HTTPS mode setup including CA certificate installation.\n * Falls back to HTTP mode if CA installation fails or user chooses HTTP.\n * @param store Application settings store\n */\nexport async function handleFirstLaunch(store: IStore): Promise<void> {\n  // Check if CA is already installed\n  const caInstalled = await isCAInstalledInSystem();\n\n  if (caInstalled) {\n    // CA is already installed, default to HTTPS mode\n    store.set('httpsMode', 'https');\n    store.set('firstLaunchCompleted', true);\n    return;\n  }\n\n  // Show first launch assistant\n  const userChoice = await showFirstLaunchAssistant();\n\n  if (!userChoice) {\n    // User cancelled, exit the app\n    app.quit();\n    return;\n  }\n\n  if (userChoice === 'https') {\n    try {\n      const installed = await installCAInSystem();\n\n      if (installed) {\n        store.set('httpsMode', 'https');\n      } else {\n        // Installation failed, fall back to HTTP\n        store.set('httpsMode', 'http');\n\n        // Show error message\n        dialog.showMessageBoxSync({\n          type: 'warning',\n          title: 'Certificate Installation Failed',\n          message: 'Failed to install the security certificate.',\n          detail: 'Anglesite will continue in HTTP mode. You can retry HTTPS setup in the settings.',\n          buttons: ['Continue'],\n        });\n      }\n    } catch (error) {\n      console.error('Error during CA installation:', error);\n      store.set('httpsMode', 'http');\n\n      dialog.showMessageBoxSync({\n        type: 'error',\n        title: 'Setup Error',\n        message: 'An error occurred during setup.',\n        detail: 'Anglesite will continue in HTTP mode.',\n        buttons: ['Continue'],\n      });\n    }\n  } else {\n    // User chose HTTP mode\n    store.set('httpsMode', 'http');\n  }\n\n  // Mark first launch as completed\n  store.set('firstLaunchCompleted', true);\n}\n"],"mappings":"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","ignoreList":[]}